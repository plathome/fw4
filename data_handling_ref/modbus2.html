
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>PD Handler Modbus 2 &#8212; OpenBlocks FW4 1.0.0 ドキュメント</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="PD Handler SW4x" href="sw4x.html" />
    <link rel="prev" title="PD Handler Modbus" href="modbus.html" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="ja" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta name="description" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="keywords" content="OpenBlocks,IoT,AirManage,WEB UI,PD,Repeater,Handler" />
    <meta http-equiv="Content-Script-Type" content="text/JavaScript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="subject" content="OpenBlocks FW4の各種ドキュメントです。" />
    <meta name="abstract" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="owner" content="ぷらっとホーム株式会社" />
    <meta name="copyright" content="2020 Plat'Home Co., Ltd. All rights reserved." />
    <meta name="robots" content="INDEX,FOLLOW" />
  </head><body>
<div class="header">
	<div class="header_container">
		<a href="https://www.plathome.co.jp">
			<!-- <img src="/_static/logo_plathome_technology.png" width="137.5" alt="Plat'Home"> -->
			<img src="/_static/logo_plathome_white.png" width="137.5" alt="Plat'Home">
		</a>
		<div class="right">
			<a class="headlink" href="https://www.plathome.co.jp">
				会社TOP
			</a>
		</div>
		<div class="right">
			<a class="headlink" href="https://docs.plathome.co.jp">
				HOME
			</a>
		</div>
	</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="sw4x.html" title="PD Handler SW4x"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="modbus.html" title="PD Handler Modbus"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenBlocks FW4 1.0.0 ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="data_handling_ref.html" accesskey="U">データハンドリング設定リファレンスガイド</a> &#187;</li> 
      </ul>
    </div>
</div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pd-handler-modbus-2">
<span id="data-handler-reference-modbus2"></span><h1>PD Handler Modbus 2<a class="headerlink" href="#pd-handler-modbus-2" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="modbus">
<h2>Modbus モデリングファイル<a class="headerlink" href="#modbus" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>従来の PD Handler Modbus では、
Modbus のファンクションコードと共にデータのタイプとレジスタのアドレスと個数を直接指定することで、
データを整数配列として読み書きしていたのに対し、PD Handler Modbus 2 では、
モデリングファイルを用意することで、
そのインデックスとなるメーカー／プロダクト／モデル／SKUを指定することにより、
モデルリングファイルの定義に従いデータの読み書きを行います。</p>
<div class="figure align-default" id="id22">
<a class="reference internal image-reference" href="../_images/modeling.png"><img alt="../_images/modeling.png" src="../_images/modeling.png" style="width: 591.75px; height: 588.0px;" /></a>
<p class="caption"><span class="caption-text">PD Handler Modbus と PD Handler Modbus 2 の比較</span><a class="headerlink" href="#id22" title="この画像へのパーマリンク">¶</a></p>
</div>
<p>PD Handler Modbus 2 を使用するためには、
モデリングファイルを用意しなくてはなりませんが、
複数のレジスタセットや混在するデータタイプに対するアクセスを一つのインデックスを読み出すことで処理でき、
また、JSONキーを自由に割り当てることができ、
データの書式も幾つか選択できるようになりました。</p>
<div class="section" id="id1">
<h3>インデックスの階層<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>モデリングファイルのインデックスは、以下の JSON 文字列に示すようにメーカー名、
プロダクト名、モデル名、SKU名の 4 階層で構成され、各階層が JSON オブジェクトの配列となっており、
各配列要素を maker オブジェクト、product オブジェクト、model オブジェクト、sku オブジェクトと呼びます。
sku オブジェクトには、レジスタと出力書式を定義する幾つかのオブジェクト配列が含まれています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
     <span class="p">{</span>
         <span class="s2">&quot;maker&quot;</span><span class="p">:</span> <span class="s2">&quot;Maker Name A&quot;</span><span class="p">,</span>
         <span class="s2">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
             <span class="p">{</span>
                 <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;Product Name&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;models&quot;</span><span class="p">:[</span>
                     <span class="p">{</span>
                         <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Model Name&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;skus&quot;</span><span class="p">:</span> <span class="p">[</span>
                             <span class="p">{</span>
                                 <span class="s2">&quot;sku&quot;</span><span class="p">:</span> <span class="s2">&quot;Sku Name&quot;</span><span class="p">,</span>
                                     <span class="p">:</span>
                             <span class="p">}</span>
                         <span class="p">]</span>
                     <span class="p">}</span>
                 <span class="p">]</span>
             <span class="p">}</span>
         <span class="p">]</span>
     <span class="p">},</span>
     <span class="p">{</span>
         <span class="s2">&quot;maker&quot;</span><span class="p">:</span> <span class="s2">&quot;Maker Name B&quot;</span><span class="p">,</span>
                 <span class="p">:</span>
     <span class="p">}</span>
 <span class="p">]</span>
</pre></div>
</div>
<p>なお、PD Handler Modbus 2 には、複数のモデリングファイルをマージするツールが用意されているため、
モデリングファイルはSKUやモデル毎に分けて作成することも可能です。</p>
</div>
<div class="section" id="id2">
<h3>モデリングファイルの例<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">モデリングファイルの例を示します。</div>
<div class="line">この例では、1 つのファイルに 2 つの SKU が記載されています。</div>
<div class="line">SKU '0001' は、電流と電圧を配列 (ex. &quot;current&quot;:[23.1, 45.2], &quot;voltage&quot;:[100.2, 100.3]) で出力するのに対し、</div>
<div class="line">SKU '0002' は個別 (ex.  &quot;current0&quot;:23.1, &quot;current1&quot;:45.2, &quot;voltage0&quot;:100.2, &quot;voltage1&quot;:100.3) に出力します。 ::</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;maker&quot;</span><span class="p">:</span> <span class="s2">&quot;Example Co.,Ltd.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;Smart Meter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;models&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;ZZZ1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;byteOrder&quot;</span><span class="p">:</span> <span class="s2">&quot;lsb&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;wordOrder&quot;</span><span class="p">:</span> <span class="s2">&quot;lsb&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;bitOrder&quot;</span><span class="p">:</span> <span class="s2">&quot;msb&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                    <span class="s2">&quot;skus&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;sku&quot;</span><span class="p">:</span> <span class="s2">&quot;0001&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                            <span class="s2">&quot;outputBits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0101&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;enable&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                                    <span class="s2">&quot;writeOnly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                                    <span class="s2">&quot;bitsArray&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;switch&quot;</span> <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;inputRegisters&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0001&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;enable&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                                    <span class="s2">&quot;registersArray&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;power&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;reversePower&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;current&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;voltage&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span><span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;instPower&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;serialNumber&quot;</span> <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;infos&quot;</span><span class="p">:</span> <span class="p">{}</span>
                        <span class="p">},</span> 
                        <span class="p">{</span>
                            <span class="s2">&quot;sku&quot;</span><span class="p">:</span> <span class="s2">&quot;0002&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                            <span class="s2">&quot;outputBits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0101&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;enable&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                                    <span class="s2">&quot;writeOnly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                                    <span class="s2">&quot;bitsArray&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;switch&quot;</span> <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;inputRegisters&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="s2">&quot;0x0001&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;enable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
                                    <span class="s2">&quot;registersArray&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;power&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;reversePower&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;current0&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;current1&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;voltage0&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;voltage1&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;instPower&quot;</span> <span class="p">},</span>
                                        <span class="p">{</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32_t&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;serialNumber&quot;</span> <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;infos&quot;</span><span class="p">:</span> <span class="p">{}</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>PD Handler Modbus 2 が読み込むモデリングファイルのルートオブジェクトは、
maker オブジェクトの配列でなければなりませんが、
モデリングファイルをマージするツールは以上の例のようにルートオブジェクトに maker オブジェクトを配置したファイルも処理することができます。</p>
</div>
<div class="section" id="id3">
<h3>Modbusモデリングファイルの書式<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id4">
<h4>構文<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>PD Handler Modbus 2 のモデリングファイルは次の書式で構成されています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="n">maker</span> <span class="n">オブジェクト</span><span class="p">,</span>
         <span class="s2">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
               <span class="p">{</span>
                <span class="n">product</span> <span class="n">オブジェクト</span><span class="p">,</span>
                <span class="n">models</span><span class="s2">&quot;: [</span>
                     <span class="p">{</span>
                         <span class="n">model</span> <span class="n">オブジェクト</span><span class="p">,</span>
                         <span class="n">skus</span><span class="s2">&quot;: [</span>
                            <span class="p">{</span>
                                <span class="n">sku</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                <span class="s2">&quot;outputBits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                   <span class="p">{</span>
                                        <span class="n">bit</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                         <span class="s2">&quot;bitsArray&quot;</span><span class="p">:[</span>
                                            <span class="p">{</span>
                                                <span class="n">bitsArray</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">},</span>
                                            <span class="p">{</span>
                                                <span class="n">bitsArray</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">}</span>
                                        <span class="p">]</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="n">bit</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">:</span>
                                    <span class="p">}</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;inputBits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="n">bit</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">:</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="n">bit</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">:</span>
                                    <span class="p">}</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;outputRegisters&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="n">register</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                        <span class="s2">&quot;registersArray&quot;</span><span class="p">:</span> <span class="p">[</span>
                                            <span class="p">{</span>
                                                <span class="n">registersArray</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">},</span>
                                            <span class="p">{</span>
                                                <span class="n">registersArray</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                            <span class="p">}</span>
                                        <span class="p">]</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="n">register</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                             <span class="p">:</span>
                                    <span class="p">}</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;inputRegisters&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="n">register</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                             <span class="p">:</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="n">register</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                             <span class="p">:</span>
                                    <span class="p">}</span>
                                <span class="p">],</span>
　　　　　　　　　　　　　　　　<span class="s2">&quot;rawRequests&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="n">rawRequest</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                               <span class="p">:</span>
　　　　　　　　　　　　　　　　<span class="p">],</span>
                                <span class="s2">&quot;infos&quot;</span><span class="p">:</span> <span class="n">infos</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                <span class="s2">&quot;infos_poll&quot;</span><span class="p">:</span> <span class="n">infos_poll</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                <span class="s2">&quot;infos_od&quot;</span><span class="p">:</span> <span class="n">infos_od</span> <span class="n">オブジェクト</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="n">sku</span> <span class="n">オブジェクト</span><span class="p">,</span>
                                    <span class="p">:</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                         <span class="n">model</span> <span class="n">オブジェクト</span><span class="p">,</span>
                            <span class="p">:</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="n">product</span> <span class="n">オブジェクト</span><span class="p">,</span>
                    <span class="p">:</span>
             <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="n">maker</span> <span class="n">オブジェクト</span><span class="p">,</span>
            <span class="p">:</span>
    <span class="p">}</span>
<span class="p">]</span>

</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>ルートオブジェクト<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id23">
<caption><span class="caption-text">ルートオブジェクト</span><a class="headerlink" href="#id23" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p>JSON配列</p></td>
<td><p>makerオブジェクトの配列. (最大 32 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="maker">
<h4>maker オブジェクト<a class="headerlink" href="#maker" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id24">
<caption><span class="caption-text">maker オブジェクト</span><a class="headerlink" href="#id24" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>maker</p></td>
<td><p>文字列</p></td>
<td><p>メーカー名. (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>メーカー名を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>products</p></td>
<td><p>JSON配列</p></td>
<td><p>product オブジェクトの配列. (最大 32 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="product">
<h4>product オブジェクト<a class="headerlink" href="#product" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id25">
<caption><span class="caption-text">product オブジェクト</span><a class="headerlink" href="#id25" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>product</p></td>
<td><p>文字列</p></td>
<td><p>プロダクト名. (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>プロダクト名を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>models</p></td>
<td><p>JSON配列</p></td>
<td><p>model オブジェクトの配列. (最大 32 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="model">
<h4>model オブジェクト<a class="headerlink" href="#model" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id26">
<caption><span class="caption-text">model オブジェクト</span><a class="headerlink" href="#id26" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>model</p></td>
<td><p>文字列</p></td>
<td><p>モデル名. (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>モデル名を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>wordOrder</p></td>
<td><p>文字列</p></td>
<td><p>ワードの順列. 'lsb' 又は 'msb'. デフォルト値は 'lsb'.</p></td>
</tr>
<tr class="row-odd"><td><p>byteOrder</p></td>
<td><p>文字列</p></td>
<td><p>バイトの順列. 'lsb' 又は 'msb'. デフォルト値は 'lsb'.</p></td>
</tr>
<tr class="row-even"><td><p>bitOrder</p></td>
<td><p>文字列</p></td>
<td><p>ビットの順列. 'lsb' 又は 'msb'. デフォルト値は 'lsb'.</p></td>
</tr>
<tr class="row-odd"><td><p>wait</p></td>
<td><p>整数値</p></td>
<td><p>シリアル接続 PLC 機器に対する読み書きコマンド後の待ち時間 (μsec). デフォルト値は 0.</p></td>
</tr>
<tr class="row-even"><td><p>precision</p></td>
<td><p>整数値</p></td>
<td><p>送信するデータとしてJSON文字列にダンプされる際のリアル型データの精度(libjanssonに与えるパラメータ) 1〜17. デフォルト値は 17.</p></td>
</tr>
<tr class="row-odd"><td><p>skus</p></td>
<td><p>JSON配列</p></td>
<td><p>skuオブジェクトの配列. (最大 32 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sku">
<h4>sku オブジェクト<a class="headerlink" href="#sku" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id27">
<caption><span class="caption-text">sku オブジェクト</span><a class="headerlink" href="#id27" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sku</p></td>
<td><p>文字列</p></td>
<td><p>sku名. (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>sku名を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>outputBits</p></td>
<td><p>JSON配列</p></td>
<td><p>出力ビットのレジスタ情報. bit オブジェクトの配列  (最大 32 オブジェクト)</p></td>
</tr>
<tr class="row-odd"><td><p>inputBits</p></td>
<td><p>JSON配列</p></td>
<td><p>入力ビットのレジスタ情報. bit オブジェクトの配列  (最大 32 オブジェクト)</p></td>
</tr>
<tr class="row-even"><td><p>outputRegisters</p></td>
<td><p>JSON配列</p></td>
<td><p>出力レジスタのレジスタ情報. register オブジェクトの配列  (最大 32 オブジェクト)</p></td>
</tr>
<tr class="row-odd"><td><p>inputRegisters</p></td>
<td><p>JSON配列</p></td>
<td><p>入力レジスタのレジスタ情報. register オブジェクトの配列</p></td>
</tr>
<tr class="row-even"><td><p>rawRequest</p></td>
<td><p>JSON配列</p></td>
<td><p>RAWリクエストのための情報. rawRequestオブジェクトの配列</p></td>
</tr>
<tr class="row-odd"><td><p>infos</p></td>
<td><p>JSON obj</p></td>
<td><p>sku 固有のユーザー定義オブジェクト.</p></td>
</tr>
<tr class="row-even"><td><p>infos_poll</p></td>
<td><p>JSON obj</p></td>
<td><p>ポーリング処理による出力に付加される sku 固有のユーザー定義オブジェクト.</p></td>
</tr>
<tr class="row-odd"><td><p>infos_od</p></td>
<td><p>JSON obj</p></td>
<td><p>オンデマンド処理にいる出力に付加される sku 固有のユーザー定義オブジェクト.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bit">
<h4>bit オブジェクト<a class="headerlink" href="#bit" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id28">
<caption><span class="caption-text">bit オブジェクト</span><a class="headerlink" href="#id28" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>address</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>レジスタの開始アドレス. 整数値又は '0x' で始まる 16進数表記の文字列.</p></td>
</tr>
<tr class="row-odd"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>このオブジェクトに基づくポーリングによるデータの読み込みを行うか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>single</p></td>
<td><p>論理値</p></td>
<td><p>単一レジスタの書き込みに Modbus ファンクション 0x05 を用いる.  false の場合は 0x0F を用いる. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>writeOnly</p></td>
<td><p>論理値</p></td>
<td><p>書き込み専用のレジスタ. デフォルト値は false.</p></td>
</tr>
<tr class="row-even"><td><p>bitsArray</p></td>
<td><p>JSON配列</p></td>
<td><p>bitsArray オブジェクトの配列  (最大 512 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="register">
<h4>register オブジェクト<a class="headerlink" href="#register" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id29">
<caption><span class="caption-text">register オブジェクト</span><a class="headerlink" href="#id29" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>address</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>レジスタの開始アドレス. 整数値又は '0x' で始まる 16進数表記の文字列.</p></td>
</tr>
<tr class="row-odd"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>このオブジェクトに基づくポーリングによるデータの読み込みを行うか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-even"><td><p>single</p></td>
<td><p>論理値</p></td>
<td><p>単一レジスタの書き込みに Modbus ファンクション 0x06 を用いる.  false の場合は 0x10 を用いる. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>writeOnly</p></td>
<td><p>論理値</p></td>
<td><p>書き込み専用のレジスタ. デフォルト値は false.</p></td>
</tr>
<tr class="row-even"><td><p>registersArray</p></td>
<td><p>JSON配列</p></td>
<td><p>registersArray オブジェクトの配列  (最大 512 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rawrequest">
<h4>rawRequest オブジェクト<a class="headerlink" href="#rawrequest" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id30">
<caption><span class="caption-text">rawRequest オブジェクト</span><a class="headerlink" href="#id30" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>key</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>この RAW リクエストを呼び出すためのキー. (32byte)</p></td>
</tr>
<tr class="row-odd"><td><p>unitId</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>RAW リクエストに設定される Modbus ID. 整数値又は '0x' で始まる 16進数表記の文字列.　デフォルト値は Modbus client に設定さる Modbus ID.</p></td>
</tr>
<tr class="row-even"><td><p>function</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>RAW リクエストに設定される Modbus ファンクション番号.　 整数値又は '0x' で始まる 16進数表記の文字列.</p></td>
</tr>
<tr class="row-odd"><td><p>address</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>RAW リクエストに設定されるレジスタのアドレス.　 整数値又は '0x' で始まる 16進数表記の文字列.</p></td>
</tr>
<tr class="row-even"><td><p>value</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>RAW リクエストに設定されるレジスタの値.　 整数値又は '0x' で始まる 16進数表記の文字列.</p></td>
</tr>
<tr class="row-odd"><td><p>form</p></td>
<td><p>文字列</p></td>
<td><p>出力メッセージの書式. 'hex'(16進表記の文字列)、'HEX'(16進表記の大文字列). デフォルト値は 'HEX'</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bitsarray">
<h4>bitsArray オブジェクト<a class="headerlink" href="#bitsarray" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id31">
<caption><span class="caption-text">bitsArray オブジェクト</span><a class="headerlink" href="#id31" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>このビット値を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>form</p></td>
<td><p>文字列</p></td>
<td><p>このビット値の書式. 'bit'(1 or 0 の整数値) または 'bool'(true or false)、'BOOL'(TRUE or FALSE)、'hex'(16進表記の小文字列)、'HEX'(16進表記の大文字列). デフォルト値は 'bit'.</p></td>
</tr>
<tr class="row-even"><td><p>key</p></td>
<td><p>文字列</p></td>
<td><p>このビット値に与えるJSONキー. (32byte)</p></td>
</tr>
<tr class="row-odd"><td><p>array</p></td>
<td><p>整数値</p></td>
<td><p>配列表記としたい場合は、array キーにその素数の数を指定する.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="registersarray">
<h4>registersArray オブジェクト<a class="headerlink" href="#registersarray" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id32">
<caption><span class="caption-text">registersArray オブジェクト</span><a class="headerlink" href="#id32" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>こののレジスタ値を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>form</p></td>
<td><p>文字列</p></td>
<td><p>このレジスタ値の書式. 'dec'(数値) または 'hex'(16進表記の文字列)、'HEX'(16進表記の大文字列). デフォルト値は 'dec'.</p></td>
</tr>
<tr class="row-even"><td><p>base_ratio</p></td>
<td><p>整数値</p></td>
<td><p>値の係数に用いる冪乗値の底を指定する. デフォルト値は10.</p></td>
</tr>
<tr class="row-odd"><td><p>ratio</p></td>
<td><p>整数値</p></td>
<td><p>値の係数に用いる冪乗値の冪指数を指定する. デフォルト値は 0.</p></td>
</tr>
<tr class="row-even"><td><p>key</p></td>
<td><p>文字列</p></td>
<td><p>このレジスタ値に与えるJSONキー. (32byte)</p></td>
</tr>
<tr class="row-odd"><td><p>array</p></td>
<td><p>整数値</p></td>
<td><p>配列表記としたい場合は、array キーにその素数の数を指定する.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id6">
<h3>モデリングファイル作成支援ツール<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus 2 のパッケージには、モデリングファイルの構文を確認するツールと複数のモデリングファイルをマージする 2 つの作成支援ツールが用意されています。</p>
<table class="docutils align-default" id="id33">
<caption><span class="caption-text">モデリングファイル作成支援ツール</span><a class="headerlink" href="#id33" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パス名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/usr/sbin/pd_handler_modbus_2_verify</p></td>
<td><p>モデリングファイル 構文確認ツール</p></td>
</tr>
<tr class="row-odd"><td><p>/usr/sbin/pd_handler_modbus_2_merge</p></td>
<td><p>モデリングファイル マージツール</p></td>
</tr>
</tbody>
</table>
<div class="section" id="id7">
<h4>構文確認ツール<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>pd_handler_modbus_2_verify は、作成したモデリングファイルの構文を確認するツールです。</p>
<p>pd_handler_modbus_2_verify コマンドのコマンドオプションを示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_2_verify -h</span>
<span class="n">usages</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="n">pd_handler_modbus_2_verify</span> <span class="o">&lt;</span><span class="n">model</span> <span class="n">file</span><span class="o">&gt;</span>
  <span class="o">-</span><span class="n">v</span>    <span class="n">Show</span> <span class="n">progress</span><span class="o">.</span>
</pre></div>
</div>
<p>pd_handler_modbus_2_verify コマンドの実行例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">root</span><span class="c1"># cd /usr/share/pdhms/modbus2/models/OMRON/ SmartPowerMonitor</span>
 <span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_2_verify -v KM-N1-FLK.conf</span>
 <span class="n">Read</span> <span class="n">modeling</span> <span class="n">file</span> <span class="p">:</span> <span class="n">KM</span><span class="o">-</span><span class="n">N1</span><span class="o">-</span><span class="n">FLK</span><span class="o">.</span><span class="n">conf</span>
    <span class="n">Maker</span><span class="p">:</span> <span class="n">OMRON</span>
      <span class="n">Product</span><span class="p">:</span> <span class="n">Smart</span> <span class="n">Power</span> <span class="n">Monitor</span>
        <span class="n">Model</span><span class="p">:</span> <span class="n">KM</span><span class="o">-</span><span class="n">N1</span><span class="o">-</span><span class="n">FLK</span>
          <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span>
          <span class="n">SKU</span><span class="p">:</span> <span class="mi">01</span>
<span class="n">Verified</span> <span class="n">total</span> <span class="mi">1</span> <span class="n">makers</span> <span class="n">done</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>マージツール<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>PLC 機器によってはモデリングファイルが数百行に及ぶ場合もあり、
全ての PLC 機器のモデリングを一つのファイルで管理することは現実的でないことから、
モデリングファイルについては、プロダクト・モデルもしくはSKU 毎にファイルを分割し、
必要に応じて下図のよにディレクトリ階層を細分化して管理することを推奨します。</p>
<div class="figure align-default" id="id34">
<a class="reference internal image-reference" href="../_images/modeling_tree.png"><img alt="../_images/modeling_tree.png" src="../_images/modeling_tree.png" style="width: 455.25px; height: 132.0px;" /></a>
<p class="caption"><span class="caption-text">ディレクトリ階層を細分化した例とフラット展開した例</span><a class="headerlink" href="#id34" title="この画像へのパーマリンク">¶</a></p>
</div>
<div class="line-block">
<div class="line">マージツール pd_handler_modbus_2_merge は、指定されてたディレクトリ下に保存されている .conf のファイルディスクリプタを持つモデリングファイルを再回帰検索し、マージします。</div>
<div class="line">ただし、ASCII 英数字と '-', '_', '.' 以外の記号文字を含むパス名には対応できません。</div>
</div>
<p>pd_handler_modbus_2_merge コマンドのコマンドオプションを示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_2_merge -h</span>
<span class="n">usages</span><span class="p">:</span> <span class="n">pd_handler_modbus_2_merge</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">][</span><span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">][</span><span class="o">&lt;</span><span class="n">root</span> <span class="n">path</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="o">-</span><span class="n">v</span>         <span class="n">Show</span> <span class="n">progress</span><span class="o">.</span>
   <span class="o">-</span><span class="n">o</span> <span class="n">file</span>    <span class="n">Output</span> <span class="n">file</span><span class="o">.</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">stdout</span><span class="p">]</span>
   <span class="n">root</span> <span class="n">path</span>  <span class="n">Root</span> <span class="n">path</span><span class="o">.</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">./</span><span class="p">]</span>
</pre></div>
</div>
<p>pd_handler_modbus_2_merge コマンドの実行例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">root</span><span class="c1"># cd /usr/share/pdhms/modbus2/models/</span>
    <span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_2_merge -v -o /tmp/foo.conf WatanabeElectricInc/</span>
    <span class="n">Found</span> <span class="mi">14</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">WatanabeElectricInc</span><span class="o">/.</span>
    <span class="n">Load</span> <span class="n">file</span><span class="p">:</span> <span class="n">WatanabeElectricInc</span><span class="o">/</span><span class="n">WMS</span><span class="o">/</span><span class="n">PE1N</span><span class="o">/</span><span class="mi">00</span><span class="n">A000_SW4x</span><span class="o">.</span><span class="n">conf</span>
      <span class="n">Maker</span><span class="p">:</span> <span class="n">Watanabe</span> <span class="n">Electric</span> <span class="n">Inc</span><span class="o">.</span>
        <span class="n">Product</span><span class="p">:</span> <span class="n">WMS</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">PE1N</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A000_SW4x</span>
    <span class="n">Load</span> <span class="n">file</span><span class="p">:</span> <span class="n">WatanabeElectricInc</span><span class="o">/</span><span class="n">WMS</span><span class="o">/</span><span class="n">PE1N</span><span class="o">/</span><span class="mi">00</span><span class="n">A000</span><span class="o">.</span><span class="n">conf</span>
      <span class="n">Maker</span><span class="p">:</span> <span class="n">Watanabe</span> <span class="n">Electric</span> <span class="n">Inc</span><span class="o">.</span>
        <span class="n">Product</span><span class="p">:</span> <span class="n">WMS</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">PE1N</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A000</span>
               <span class="p">:</span>
            <span class="p">(</span><span class="n">中略</span><span class="p">)</span>
               <span class="p">:</span>
    <span class="n">Merge</span> <span class="mi">1</span> <span class="n">makers</span><span class="o">.</span>
      <span class="n">Maker</span><span class="p">:</span> <span class="n">Watanabe</span> <span class="n">Electric</span> <span class="n">Inc</span><span class="o">.</span>
        <span class="n">Product</span><span class="p">:</span> <span class="n">WMS</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">PE1N</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A000_SW4x</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A000</span>
           <span class="n">Model</span><span class="p">:</span> <span class="n">PE6N</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A007_SW4x</span><span class="o">-</span><span class="n">A</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A007_SW4x</span><span class="o">-</span><span class="n">B</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A007</span><span class="o">-</span><span class="n">A</span>
             <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">A007</span><span class="o">-</span><span class="n">B</span>
        <span class="n">Product</span><span class="p">:</span> <span class="n">WMB</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">DIO8R</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000_SW4x_DIO</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">DI16A</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">AI8</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">36</span><span class="n">D000</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">DI16</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">DIO8RA</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">00</span><span class="n">D000_SW4x_DIO</span>
          <span class="n">Model</span><span class="p">:</span> <span class="n">MAI6</span>
            <span class="n">SKU</span><span class="p">:</span> <span class="mi">36</span><span class="n">FD000</span>
    <span class="n">Dump</span> <span class="n">to</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pd-handler-modbus-2-client">
<h2>PD Handler Modbus 2 Client<a class="headerlink" href="#pd-handler-modbus-2-client" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">PD Handler Modbus 2 Clien は、モデリングファイル pd_handler_modbus_2_model.confと設定ファイル pd_handler_modbus_2_client.conf、CSVファイル pd_handler_modbus_client.csv の設定に基づき定期的にPLC 機器に Modbus プロトコルで接続しデータを読み取ります。</div>
<div class="line">また、PD Repeater を介しクラウドから送られる JSON 文字列に基づきPLC 機器に Modbus プロトコルで接続しデータを読み書きすることもできます。</div>
</div>
<div class="section" id="id9">
<h3>デォルトパス<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus 2 Clien に関連するファイルのデォルトパスは次の通りです。</p>
<table class="docutils align-default" id="id35">
<caption><span class="caption-text">PD Handler Modbus 2 Clien に関連するファイルのデォルトパス</span><a class="headerlink" href="#id35" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パス名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/usr/sbin/pd_handler_modbus_2_client</p></td>
<td><p>常駐実行オブジェクト（デーモン）</p></td>
</tr>
<tr class="row-odd"><td><p>/usr/sbin/pd_handler_modbus_2_cli</p></td>
<td><p>コマンドラインインタフェース</p></td>
</tr>
<tr class="row-even"><td><p>/lib/systemd/system/pd_handler_modbus_2_client.service</p></td>
<td><p>Systemd Serviceファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/etc/init.d/pd_handler_modbus_2_client</p></td>
<td><p>RCファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/config/pd_handler_modbus_2_client.conf</p></td>
<td><p>設定ファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/config/pd_handler_modbus_2_model.conf</p></td>
<td><p>Modbus モデリングファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/config/pd_handler_modbus_2_model.conf.default</p></td>
<td><p>Modbus モデリングファイル(デフォルト)</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/upload_dir/ pd_handler_modbus_2_client.csv</p></td>
<td><p>CSVファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/run/pd_handler_modbus_2_client.pid</p></td>
<td><p>PIDファイル</p></td>
</tr>
</tbody>
</table>
<p>Modbusモデリングファイル(デフォルト)は、Modbusモデリングファイルが存在しない場合に読み込まれます。</p>
</div>
<div class="section" id="id10">
<h3>設定ファイルの書式<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id11">
<h4>構文<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>PD Handler Modbu Client 2 の設定ファイルは次の書式で構成されています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;csv_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;CSV ファイル&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;モデリングファイル&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;clients&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">clients</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">clients</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>ルートオブジェクト<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id36">
<caption><span class="caption-text">ルートオブジェクト</span><a class="headerlink" href="#id36" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>csv_file</p></td>
<td><p>文字列</p></td>
<td><p>CSVファイルののパス名. デフォルト値は、'/var/webui/upload_dir/pd_handler_modbus_2_client.csv'. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>model_file</p></td>
<td><p>文字列</p></td>
<td><p>Modbusモデリングファイルのパス名. デフォルト値は、'/var/webui/config/pd_handler_modbus_2_model.conf'. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-even"><td><p>clients</p></td>
<td><p>JSON配列</p></td>
<td><p>clientsオブジェクトの配列 (最大 64 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="clients">
<h4>clients オブジェクト<a class="headerlink" href="#clients" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>clients オブジェクトは、PD Handler Modbus 2 Client の動作を規定する設定オブジェクトです。
clients オブジェクトの配列数は、最大256 個です。
Modbus のプロトコル(TCP, RTC) に依存するオブジェクトとプロトコルに依存しない共通のオブジェクトがあります。</p>
<table class="colwidths-given docutils align-default" id="id37">
<caption><span class="caption-text">clients オブジェクト</span><a class="headerlink" href="#id37" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>localname</p></td>
<td><p>文字列</p></td>
<td><p>デバイスのローカル名. (32byte)</p></td>
</tr>
<tr class="row-even"><td><p>bind</p></td>
<td><p>文字列</p></td>
<td><p>制御メッセージを受け取るソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_handler/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>push_to</p></td>
<td><p>文字列</p></td>
<td><p>データの送り先ソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_repeater/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-even"><td><p>buffer_size</p></td>
<td><p>整数値</p></td>
<td><p>データのバッファサイズ(byte). デフォルト値は 4096</p></td>
</tr>
<tr class="row-odd"><td><p>receive</p></td>
<td><p>論理値</p></td>
<td><p>クラウドからメッセージを受け取る下流方向制御を行うか否か. デフォルト値は false</p></td>
</tr>
<tr class="row-even"><td><p>reply</p></td>
<td><p>論理値</p></td>
<td><p>下流方向制御に対しステータスメッセージを返すか否か. デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>protocol</p></td>
<td><p>文字列</p></td>
<td><p>接続プロトコル 'tcp' 又は 'rtu' を指定. デフォルト値は 'tcp'.</p></td>
</tr>
<tr class="row-even"><td><p>timeout</p></td>
<td><p>整数値</p></td>
<td><p>データを取得出来ない場合のタイムアウト(msec). デフォルト値は 5000.</p></td>
</tr>
<tr class="row-odd"><td><p>node</p></td>
<td><p>文字列</p></td>
<td><p>【TCP接続】PLC 機器の IP アドレス. デフォルト値は'127.0.0.1'</p></td>
</tr>
<tr class="row-even"><td><p>port</p></td>
<td><p>整数値</p></td>
<td><p>【TCP接続】PLC 機器のポート番号. デフォルト値は 502</p></td>
</tr>
<tr class="row-odd"><td><p>device</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】シリアル接続のデバイス名. デフォルト値は '/dev/tty00'</p></td>
</tr>
<tr class="row-even"><td><p>rtu_speed</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のビットレート. デフォルト値は 115200</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_bits</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のビット数. 8 又は 7. デフォルト値は 8.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_parity</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】シリアル接続のパリティ. 'none','even','odd' のいずれか. デフォルト値は'none'.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_stop</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のストップビット.  1 又は 2. デフォルト値は 1.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_rts_delay</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続の RTS ディレイ値(usec). 0 の場合は自動設定される値.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_reset</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】設定される値を越えて接続エラーが連続して発生した場合にシリアルポートをリセットする. デフォルト値は 10.</p></td>
</tr>
<tr class="row-even"><td><p>id_form</p></td>
<td><p>文字列</p></td>
<td><p>Modbus Id の表記フォーマト. 'dec'(数値) または 'hex'(16進表記の文字列)、'HEX'(16進表記の大文字列). デフォルト値は 'dec'</p></td>
</tr>
<tr class="row-odd"><td><p>timestamp_key</p></td>
<td><p>文字列</p></td>
<td><p>タイムスタンプのキーを設定する. デフォルト値は 'timestamp' (32byte)</p></td>
</tr>
<tr class="row-even"><td><p>infos</p></td>
<td><p>JSON Object</p></td>
<td><p>出力に付加される Modbus クライアント ノード固有のユーザー定義オブジェクト</p></td>
</tr>
<tr class="row-odd"><td><p>acquisitions</p></td>
<td><p>JSON配列</p></td>
<td><p>acquisitions オブジェクト (最大 32 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="acquisitions">
<h4>acquisitions オブジェクト<a class="headerlink" href="#acquisitions" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id38">
<caption><span class="caption-text">acquisitions オブジェクト</span><a class="headerlink" href="#id38" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>デフォルト値は false.</p></td>
</tr>
<tr class="row-odd"><td><p>makre</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるメーカー名 (64byte)</p></td>
</tr>
<tr class="row-even"><td><p>product</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるプロダクト名 (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>model</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるモデル名 (64byte)</p></td>
</tr>
<tr class="row-even"><td><p>sku</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義される sku 名 (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>unitId</p></td>
<td><p>文字列又は整数</p></td>
<td><p>PLC 機器のModbus ユニットID. 1 ～ 247 又は255 (TCP プロトコルのみ). '0x' で始まる 16進数表記の文字列入力も可能.</p></td>
</tr>
<tr class="row-even"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>unitId を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>interval</p></td>
<td><p>整数値</p></td>
<td><p>データを取得する間隔(sec). デフォルト値は 60.</p></td>
</tr>
<tr class="row-even"><td><p>time_sync</p></td>
<td><p>論理値</p></td>
<td><p>基準時刻制御モード. デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>base_time</p></td>
<td><p>文字列</p></td>
<td><p>基準時刻制御モードの基準時刻を 'HH:MM' 形式で指定する. デフォルト値は '00:00'</p></td>
</tr>
<tr class="row-even"><td><p>infos</p></td>
<td><p>JSON obj</p></td>
<td><p>出力に付加されるデータ取得対象 PLC 機器固有のユーザー定義オブジェクト.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="csv">
<h3>CSVファイル<a class="headerlink" href="#csv" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">PD Handler Modbus Client 2 は、CSVファイル /var/webui/upload_dir/pd_handler_modbus_2_client.csv が存在すると同ファイルより acquisitions オブジェクトに相当する設定パラメータを読み込み、設定ファイル /var/webui/config/pd_handler_2_modbus.conf から読み込んだパラメータを上書きします。</div>
<div class="line">CSVファイルに設定される情報は、clients オブジェクトの localname とacquisitions オブジェクトの unitId, include, maker, product, model, sku, infos, interval, time_sync, base_time です。　ただし、infos オブジェクトは、2組のkeyと値(文字列)に限定され、また不要な場合は空欄とします。</div>
<div class="line">パラメータの並びは次の通りで、パラメータの区切りはコンマ ','、先頭がシャープ '#' 又はスラッシュ '/' の場合はコメント行として扱います。</div>
</div>
<p>CSVファイルの書式は、次の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localname</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">maker</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sku</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">time_sync</span><span class="p">,</span> <span class="n">base_time</span>
</pre></div>
</div>
<p>パラメータのデータ型は acquisitions オブジェクトと同じですが、JSON 文字列とは異なり文字列に空白が含まれない限り、文字列を '&quot;' で括る必要はありません。
なお、localname が 設定ファイルに存在しない場合は、無効となります。</p>
<p>記載例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#localname,unitId,include,maker,product,model,sku,key1,val1,key2,val2,interval,time_sync,base_time</span>
<span class="n">mdc2dev_0000001</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span><span class="n">S2MS</span><span class="o">-</span><span class="n">RNS22</span><span class="p">,</span><span class="mi">0001</span><span class="p">,</span><span class="n">IBS</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Mater</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">mdc2dev_0000001</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span><span class="n">S2MS</span><span class="o">-</span><span class="n">RNS22</span><span class="p">,</span><span class="mi">0001</span><span class="p">,</span><span class="n">IBS</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Mater</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">mdc2dev_0000001</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span><span class="n">S2MS</span><span class="o">-</span><span class="n">RNS22</span><span class="p">,</span><span class="mi">0001</span><span class="p">,</span><span class="n">IBS</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">Mater</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">mdc2dev_0000001</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span><span class="n">S2MS</span><span class="o">-</span><span class="n">RNS22</span><span class="p">,</span><span class="mi">0001</span><span class="p">,</span><span class="n">IBS</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">Mater</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>基準時刻制御モード<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">基準時刻制御は、特定の時刻にデータを取得する機能です。</div>
<div class="line">clients オブジェクトのtime_sysncキーを true に設定し、intervalキーとbase_timeキーで取得間隔と取得時刻を設定します。</div>
<div class="line">基準時刻制御における「取得時間間隔」は60, 120, 180, 300, 600, 900, 1800, 3600, 7200, 10800, 14400, 21600, 28800, 43200と86400の倍数に限られます。「取得時間間隔」としてこれら以外の値が設定されるとPD Handler Modbus 2 Client内で次のように扱われます。</div>
</div>
<table class="docutils align-default" id="id39">
<caption><span class="caption-text">基準時刻制御における取得時間間隔の設定と実動作値</span><a class="headerlink" href="#id39" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>取得時間間隔の設定値</p></th>
<th class="head"><p>実動作値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0  ～ 199</p></td>
<td><p>60</p></td>
</tr>
<tr class="row-odd"><td><p>120 ～ 179</p></td>
<td><p>120</p></td>
</tr>
<tr class="row-even"><td><p>180 ～ 299</p></td>
<td><p>180</p></td>
</tr>
<tr class="row-odd"><td><p>300 ～ 599</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>600 ～ 899</p></td>
<td><p>600</p></td>
</tr>
<tr class="row-odd"><td><p>900 ～ 1799</p></td>
<td><p>900</p></td>
</tr>
<tr class="row-even"><td><p>1800 ～ 3599</p></td>
<td><p>1800</p></td>
</tr>
<tr class="row-odd"><td><p>3600 ～ 7199</p></td>
<td><p>3600</p></td>
</tr>
<tr class="row-even"><td><p>7200 ～ 10799</p></td>
<td><p>7200</p></td>
</tr>
<tr class="row-odd"><td><p>10800 ～ 14399</p></td>
<td><p>10800</p></td>
</tr>
<tr class="row-even"><td><p>14400 ～ 21599</p></td>
<td><p>14400</p></td>
</tr>
<tr class="row-odd"><td><p>21600 ～ 28799</p></td>
<td><p>21600</p></td>
</tr>
<tr class="row-even"><td><p>28800 ～ 43199</p></td>
<td><p>28800</p></td>
</tr>
<tr class="row-odd"><td><p>43200 ～ 86399</p></td>
<td><p>43200</p></td>
</tr>
<tr class="row-even"><td><p>86400 ～</p></td>
<td><p>86400 の倍数</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「基準時刻」とは動作の起点となる時刻で、例えば「取得時間間隔」を300とし、「基準時刻」を '00:01' とした場合、データの取得は 00:01, 00:06, 00:11 ... 00:56, 01:01 ... 23:56, 00:01の定刻に行われます。</div>
<div class="line">データの取得開始時刻は「基準時刻」に設定さた時刻そのものではなく、「基準時刻」と「取得時間間隔」から算定される直近の時刻となります。</div>
<div class="line">例えば08:30に「基準時刻」 '01:05'、 「取得時間間隔」10800の設定が行われた場合、最初のデータ取得は10:05に行われ、以降13:05, 16:05, 19:05, 22:05, 01:05の順におこなわれます。</div>
</div>
</div>
<div class="section" id="id14">
<h3>メッセージオブジェクト<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>入出力メッセージに用いられる JSON オブジェクトを示します。</p>
<table class="colwidths-given docutils align-default" id="id40">
<caption><span class="caption-text">PD Handler Modbus 2 Client のメッセージオブジェクト</span><a class="headerlink" href="#id40" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 12%" />
<col style="width: 19%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>内容</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>方向</p></th>
<th class="head"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>timestamp</p></td>
<td><p>データ取得日時</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>ISO8601拡張書式. キーの名称は 'timestamp_key' で変更可能.</p></td>
</tr>
<tr class="row-odd"><td><p>unitId</p></td>
<td><p>Modbus Unit ID</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>入出力</p></td>
<td><p>clients オブジェクト の 'include' が true 時のみ出力.</p></td>
</tr>
<tr class="row-even"><td><p>makre</p></td>
<td><p>メーカー名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの maker オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>product</p></td>
<td><p>プロダクト名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの product オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>model</p></td>
<td><p>モデル名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの model オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>sku</p></td>
<td><p>sku名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの sku オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>reply_to</p></td>
<td><p>リクエストメッセージのMD5</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>request_from</p></td>
<td><p>リクエストメッセージの送付元クラウドID</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>result</p></td>
<td><p>制御ステータス</p></td>
<td><p>論理値</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>reason</p></td>
<td><p>エラーの理由</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>write</p></td>
<td><p>書き込み制御</p></td>
<td><p>JSON obj</p></td>
<td><p>入力</p></td>
<td><p>モデリングファイルに定義されるキーと値</p></td>
</tr>
<tr class="row-odd"><td><p>rawRequest</p></td>
<td><p>RAWリクエスト</p></td>
<td><p>JSON obj</p></td>
<td><p>入力</p></td>
<td><p>モデリングファイルに定義される RAWリクエストキーと値. モデリングファイルに定義される値を持ちいる場合は値を null にする.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id15">
<h3>クラウドからの制御<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラウドから PD Repeater を介し制御(JSON)文字列を送ることで、接続されている PLC 機器のレジスタを読み書きすることができます。
制御文字列には、PLC 機器を特定するため acquisitions オブジェクトの unitId を記載します。</p>
<p>例えば、Modbus ID 3 の PLC 機器のレジスタを読み込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;unitId”: 3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-11-07T11:19:08.949+09:00&quot;</span>
    <span class="s2">&quot;request_from&quot;</span><span class="p">:</span> <span class="s2">&quot;0x13(0)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;6bee94d5a2f29eb63b5faecd7e8af8d9&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;unitId&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;doValue_ch1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doValue_ch2&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doValue_ch3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doValue_ch4&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;diValue&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;pulseCoutLimit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">99999999</span><span class="p">,</span> <span class="mi">99999999</span><span class="p">,</span> <span class="mi">99999999</span><span class="p">,</span> <span class="mi">99999999</span><span class="p">],</span>
    <span class="s2">&quot;pulseCountReset_ch1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;pulseCountReset_ch2&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;pulseCountReset_ch3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;pulseCountReset_ch4&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;pulseCount&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで、reply_to は、制御文字列の MD5 です。</p>
<p>同PLC 機器の出力レジスタに値を書き込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;unitId&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;doValue_ch1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;pulseCountReset_ch1&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで write オブジェクトに与えられるキーと値は、モデリングのoutputBits オブジェクト配列内のbitオブジェクト、又はoutputRegistersオブジェクト配列内のregistersオブジェクトに指定される 'key', 'type', 'array' に応じた値でなくてはなりません。但し書き込み処理において’base_ratio’と’ratio’を用いた数値の逆変換は行われません。</p>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-06-11T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_from&quot;</span><span class="p">:</span> <span class="s2">&quot;0x13(0)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;38bfe79195fc09b37b6a85b6fdc97d73&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;doValue_ch1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doValue_ch2&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doValue_ch3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doValue_ch4&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;pulseCountReset_ch1&quot;</span><span class="p">:</span> <span class="mi">1</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>書込み制御は、outputBits オブジェクト配列内のbitオブジェクト、又はoutputRegistersオブジェクト配列内のregistersオブジェクトの単位で行われます。</p>
<p>書込み処理においては、連続しない複数のレジスタに対する制御を効率良く処理するため、bitオブジェクト又はregisterオブジェクトに定義されるレジスタの全てをPLC機器からプログラムに読み込み、writeキーに指定されるレジスターのみを書き換えた後、レジスタの全てをPLC機器へ書き戻します。</p>
</div>
<div class="section" id="cli-pd-handler-modbus-2-cli">
<h3>CLI (pd_handler_modbus_2_cli)<a class="headerlink" href="#cli-pd-handler-modbus-2-cli" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>pd_handler_modbus_2_cli は、クラウドからの制御をローカルに行うためのアプリケーションです。
PLC 機器の初期設定(ディジタル出力もしくは出力レジスタへの書き込み)やモデリングファイルの確認などに用いるものですが、制御対象が RTU 接続の場合は、pd_handler_modbus_2_client とインタフェースが競合するため、pd_handler_modbus_2_client を停止した上で使用することを推奨します。</p>
<p>pd_handler_modbus_2_cli のオプションを示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_2_cli -h</span>
<span class="n">usages</span><span class="p">:</span> <span class="n">pd_handler_modbus_2_cli</span> <span class="p">[</span><span class="o">-</span><span class="n">adqr</span><span class="p">][</span><span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">conf</span> <span class="n">file</span><span class="o">&gt;</span><span class="p">][</span><span class="o">-</span><span class="n">C</span> <span class="o">&lt;</span><span class="n">CSV</span> <span class="n">file</span><span class="o">&gt;</span><span class="p">][</span><span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">]</span>
                                <span class="p">[</span><span class="o">-</span><span class="n">m</span> <span class="o">&lt;</span><span class="n">model</span> <span class="n">file</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">control</span> <span class="n">JSON</span> <span class="n">strings</span><span class="o">&gt;</span>
   <span class="o">-</span><span class="n">a</span>             <span class="n">Force</span> <span class="n">enable</span> <span class="nb">all</span> <span class="k">for</span> <span class="n">read</span><span class="o">.</span>
   <span class="o">-</span><span class="n">c</span> <span class="n">conf</span> <span class="n">file</span>   <span class="n">Conf</span> <span class="n">file</span><span class="o">.</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">webui</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">pd_handler_modbus_2_client</span><span class="o">.</span><span class="n">conf</span><span class="p">]</span>
   <span class="o">-</span><span class="n">C</span> <span class="n">CSV</span> <span class="n">file</span>    <span class="n">CSV</span> <span class="n">file</span> <span class="k">for</span> <span class="n">multiple</span> <span class="n">acquisitions</span><span class="o">.</span>
                         <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">webui</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">pd_handler_modbus_2_client</span><span class="o">.</span><span class="n">csv</span><span class="p">]</span>
   <span class="o">-</span><span class="n">d</span>             <span class="n">Debug</span> <span class="n">mode</span><span class="o">.</span>
   <span class="o">-</span><span class="n">l</span> <span class="n">local</span> <span class="n">name</span>  <span class="n">Local</span> <span class="n">name</span><span class="o">.</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">mdcdev_0000001</span><span class="p">]</span>
   <span class="o">-</span><span class="n">m</span> <span class="n">model</span> <span class="n">file</span>  <span class="n">Modbus</span> <span class="n">model</span> <span class="n">file</span><span class="o">.</span>
                         <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">webui</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">pd_handler_modbus_2_model</span><span class="o">.</span><span class="n">conf</span><span class="p">]</span>
   <span class="o">-</span><span class="n">q</span>             <span class="n">Quiet</span> <span class="n">mode</span><span class="o">.</span>
   <span class="o">-</span><span class="n">r</span>             <span class="n">Read</span> <span class="n">only</span> <span class="k">for</span> <span class="n">writ</span> <span class="n">process</span><span class="o">.</span>
</pre></div>
</div>
<p>'-a' オプションは、モデリング上 disable ('enable' キーが false) とされているレジスタも読み出します。</p>
<p>例えば、Modbus ID 3 の PLC 機器のレジスタを読み込むのであれば、pd_handler_modbus_2_cli の引数にクラウドからの制御と同じ制御文字列を与えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># pd_handler_modbus_2_cli &#39;{&quot;unitId&quot;: 3}&#39;</span>
</pre></div>
</div>
<p>これに対し応答メッセージは、標準出力に返されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-06-11T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;maker&quot;</span><span class="p">:</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;S2MS-RNS22&quot;</span><span class="p">,</span> <span class="s2">&quot;sku&quot;</span><span class="p">:</span><span class="s2">&quot;0001&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switch&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;reversePower&quot;</span><span class="p">:</span> <span class="mi">4567</span><span class="p">,</span> <span class="s2">&quot;current&quot;</span><span class="p">:[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span>
    <span class="s2">&quot;voltage&quot;</span><span class="p">:[</span><span class="mf">101.2</span><span class="p">,</span> <span class="mf">101.3</span><span class="p">],</span> <span class="s2">&quot;instPower&quot;</span><span class="p">:</span> <span class="mi">5678</span><span class="p">,</span> <span class="s2">&quot;serialNumber&quot;</span><span class="p">:</span> <span class="mi">112345678</span>
<span class="p">}</span>
</pre></div>
</div>
<p>クラウドから制御した場合と異なり、reply_to と result は出力されません。</p>
<p>同 PLC 機器の出力レジスタに値を書き込むのであれば、pd_handler_modbus_2_cli の引数は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd_handler_modbus_2_cli &#39;{&quot;unitId&quot;: 3, &quot;write&quot;:{&quot;switch&quot;: 0}}&#39;</span>
</pre></div>
</div>
<p>ここで write オブジェクトに与えられるキーと値は、モデリングのoutputBits オブジェクト配列内のbitオブジェクト、又はoutputRegistersオブジェクト配列内のregistersオブジェクトに指定される 'key', 'type', 'array' に応じた値でなくてはなりません。但し書き込み処理において’base_ratio’と’ratio’を用いた数値の逆変換は行われません。</p>
<p>これに対する応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;2019-06-11T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;maker&quot;</span><span class="p">:</span><span class="s2">&quot;Toukou Toushiba&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;SmaMe Series&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;S2MS-RNS22&quot;</span><span class="p">,</span> <span class="s2">&quot;sku&quot;</span><span class="p">:</span><span class="s2">&quot;0001&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switch&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pd-handler-modbus-2-server">
<h2>PD Handler Modbus 2 Server<a class="headerlink" href="#pd-handler-modbus-2-server" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">PD Handler Modbus Server 2 は、モデリングファイル pd_handler_modbus_2_model.confと設定ファイル pd_handler_modbus_2_server.conf の設定に基づき共有メモリにレジスタマップを構成し PLC機器(Modbusクライアント)からの接続を待ち受け、PLC機器(Modbusクライアント)の書き込み操作によりレジスタの値を更新すると共に、更新されたレジスタとその値を PD Repeater を介してクラウドへ送ります。</div>
<div class="line">また、PD Repeater を介しクラウドから送られる JSON 文字列に基づき、レジスタマップを読み書きすることができます。</div>
<div class="line">レジスタマップは、60秒毎に更新があれば、共有メモリからレジスタマップファイルに出力（バックアップ）されます。</div>
</div>
<div class="section" id="id16">
<h3>デォルトパス<a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus 2 Server に関連するファイルのデォルトパスは次の通りです。</p>
<table class="docutils align-default" id="id41">
<caption><span class="caption-text">PD Handler Modbus 2 Server に関連するファイルのデォルトパス</span><a class="headerlink" href="#id41" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パス名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/usr/sbin/pd_handler_modbus_2_server</p></td>
<td><p>常駐実行オブジェクト（デーモン）</p></td>
</tr>
<tr class="row-odd"><td><p>/etc/init.d/pd_handler_modbus_2_server</p></td>
<td><p>RCファイル</p></td>
</tr>
<tr class="row-even"><td><p>/lib/systemd/system/pd_handler_modbus_2_server.service</p></td>
<td><p>Systemd Serviceファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/config/pd_handler_modbus_2_server.conf</p></td>
<td><p>設定ファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/config/pd_handler_modbus_2_model.conf</p></td>
<td><p>Modbusモデリングファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/config/pd_handler_modbus_2_model.conf.default</p></td>
<td><p>Modbusモデリングファイル(デフォルト)</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/.modbus_2_server/&lt;localname&gt;.map</p></td>
<td><p>レジスタマップファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/run/pd_handler_modbus_2_server.pid</p></td>
<td><p>PIDファイル</p></td>
</tr>
</tbody>
</table>
<p>Modbusモデリングファイル(デフォルト)は、Modbusモデリングファイルが存在しない場合に読み込まれます。</p>
</div>
<div class="section" id="id17">
<h3>設定ファイルの書式<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id18">
<h4>構文<a class="headerlink" href="#id18" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>PD Handler Modbu Server 2 の設定ファイルは次の書式で構成されています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;model_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;モデリングファイル&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;backup_interval&quot;</span><span class="p">:</span> <span class="n">バックアップ周期</span><span class="p">,</span>
    <span class="s2">&quot;servers&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">servers</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">servers</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h4>ルートオブジェクト<a class="headerlink" href="#id19" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id42">
<caption><span class="caption-text">ルートオブジェクト</span><a class="headerlink" href="#id42" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>model_file</p></td>
<td><p>文字列</p></td>
<td><p>Modbusモデリングファイルのパス名. デフォルト値は、'/var/webui/config/pd_handler_modbus_2_model.conf'. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>backup_interval</p></td>
<td><p>整数値</p></td>
<td><p>レジスタをファイルにバックアップする周期(sec)を指定する. デフォルト値は 60.</p></td>
</tr>
<tr class="row-even"><td><p>servers</p></td>
<td><p>JSON配列</p></td>
<td><p>serversオブジェクトの配列 (最大 8 オブジェクト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="servers">
<h4>serversオブジェクト<a class="headerlink" href="#servers" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>server オブジェクトは、PD Handler Modbus 2 Serverの動作を規定する設定オブジェクトです。
server オブジェクトの配列数は、最大8 個. Modbus のプロトコル(TCP, RTC) に依存するオブジェクトと
プロトコルに依存しない共通のオブジェクトがあります。</p>
<table class="colwidths-given docutils align-default" id="id43">
<caption><span class="caption-text">serverss オブジェクト</span><a class="headerlink" href="#id43" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>localname</p></td>
<td><p>文字列</p></td>
<td><p>デバイスのローカル名. (32byte)</p></td>
</tr>
<tr class="row-even"><td><p>map_file</p></td>
<td><p>文字列</p></td>
<td><p>レジスタマップファイルのパス名. デフォルト値は /var/webui/.modbus_2_server/&lt;localname&gt;.map</p></td>
</tr>
<tr class="row-odd"><td><p>bind</p></td>
<td><p>文字列</p></td>
<td><p>制御メッセージを受け取るソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_handler/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-even"><td><p>push_to</p></td>
<td><p>文字列</p></td>
<td><p>データの送り先ソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_repeater/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>buffer_size</p></td>
<td><p>整数値</p></td>
<td><p>データのバッファサイズ(byte). デフォルト値は 4096</p></td>
</tr>
<tr class="row-even"><td><p>receive</p></td>
<td><p>論理値</p></td>
<td><p>クラウドからメッセージを受け取る下流方向制御を行うか否か. デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>reply</p></td>
<td><p>論理値</p></td>
<td><p>下流方向制御に対しステータスメッセージを返すか否か. デフォルト値は false</p></td>
</tr>
<tr class="row-even"><td><p>protocol</p></td>
<td><p>文字列</p></td>
<td><p>接続プロトコル 'tcp' 又は 'rtu' を指定. デフォルト値は 'tcp'.</p></td>
</tr>
<tr class="row-odd"><td><p>timeout</p></td>
<td><p>整数値</p></td>
<td><p>データを取得出来ない場合のタイムアウト(msec). デフォルト値は 5000.</p></td>
</tr>
<tr class="row-even"><td><p>node</p></td>
<td><p>文字列</p></td>
<td><p>【TCP接続】待ち受けIP アドレス. デフォルト値は'127.0.0.1'</p></td>
</tr>
<tr class="row-odd"><td><p>port</p></td>
<td><p>整数値</p></td>
<td><p>【TCP接続】待ち受けポート番号. デフォルト値は502</p></td>
</tr>
<tr class="row-even"><td><p>device</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】シリアル接続のデバイス名. デフォルト値は '/dev/tty00'</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_speed</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のビットレート. デフォルト値は 115200</p></td>
</tr>
<tr class="row-even"><td><p>rtu_bits</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のビット数. 8 又は 7. デフォルト値は 8.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_parity</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】シリアル接続のパリティ. 'none','even','odd' のいずれか. デフォルト値は'none'.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_stop</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続のストップビット.  1 又は 2. デフォルト値は 1.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_rts_delay</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】シリアル接続の RTS ディレイ値(usec). 0 の場合は自動設定される値.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_reset</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】設定される値を越えて接続エラーが連続して発生した場合にシリアルポートをリセットする. デフォルト値は 10.</p></td>
</tr>
<tr class="row-odd"><td><p>maker</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるメーカー名 (64byte).</p></td>
</tr>
<tr class="row-even"><td><p>product</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるプロダクト名 (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>model</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義されるmodel名 (64byte)</p></td>
</tr>
<tr class="row-even"><td><p>sku</p></td>
<td><p>文字列</p></td>
<td><p>モデルファイルに定義される sku 名 (64byte)</p></td>
</tr>
<tr class="row-odd"><td><p>unitId</p></td>
<td><p>整数又は文字列</p></td>
<td><p>PLC機器の Modbus ユニット ID. 1 〜 247 又は 255 (TCPプロトコルのみ). '0x' で始まる 16進数表記の文字列入力も可能.</p></td>
</tr>
<tr class="row-even"><td><p>include</p></td>
<td><p>論理値</p></td>
<td><p>unitId を送信するデータに含むか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>id_form</p></td>
<td><p>文字列</p></td>
<td><p>Modbus Id の表記フォーマト. 'dec'(数値) または 'hex'(16進表記の文字列)、'HEX'(16進表記の大文字列). デフォルト値は 'dec'</p></td>
</tr>
<tr class="row-even"><td><p>timestamp_key</p></td>
<td><p>文字列</p></td>
<td><p>タイムスタンプのキーを設定する. デフォルト値は 'timestamp' (32byte)</p></td>
</tr>
<tr class="row-odd"><td><p>infos</p></td>
<td><p>JSON Object</p></td>
<td><p>出力に付加される Modbus クライアント ノード固有のユーザー定義オブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id20">
<h3>メッセージオブジェクト<a class="headerlink" href="#id20" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>入出力メッセージに用いられる JSON オブジェクトを示します。</p>
<table class="colwidths-given docutils align-default" id="id44">
<caption><span class="caption-text">PD Handler Modbus 2 Server のメッセージオブジェクト</span><a class="headerlink" href="#id44" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 12%" />
<col style="width: 19%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>内容</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>方向</p></th>
<th class="head"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>timestamp</p></td>
<td><p>データ取得日時</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>ISO8601拡張書式. キーの名称は 'timestamp_key' で変更可能.</p></td>
</tr>
<tr class="row-odd"><td><p>unitId</p></td>
<td><p>Modbus Unit ID</p></td>
<td><p>整数値又は文字列</p></td>
<td><p>入出力</p></td>
<td><p>clients オブジェクト の 'include' が true 時のみ出力.</p></td>
</tr>
<tr class="row-even"><td><p>makre</p></td>
<td><p>メーカー名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの maker オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>product</p></td>
<td><p>プロダクト名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの product オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>model</p></td>
<td><p>モデル名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの model オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>sku</p></td>
<td><p>sku名</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>モデリングファイルの sku オブジェクトの 'include' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>reply_to</p></td>
<td><p>リクエストメッセージのMD5</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>request_from</p></td>
<td><p>リクエストメッセージの送付元クラウドID</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>result</p></td>
<td><p>制御ステータス</p></td>
<td><p>論理値</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-odd"><td><p>reason</p></td>
<td><p>エラーの理由</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>clients オブジェクトの 'reply' が true 時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>write</p></td>
<td><p>書き込み制御</p></td>
<td><p>JSON obj</p></td>
<td><p>入力</p></td>
<td><p>モデリングファイルに定義されるキーと値</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id21">
<h3>クラウドからの制御<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラウドから PD Repeater を介し制御(JSON)文字列を送ることで、
レジスタマップの読み取りと入力レジスタに対する書き込みができます。</p>
<p>レジスタマップを読み取る場合は、空の制御文字を送ります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>　<span class="p">}</span>
</pre></div>
</div>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-06-11T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;request_from&quot;</span><span class="p">:</span> <span class="s2">&quot;0x13(0)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;99914b932bd37a50b983c5e7c90ae93b&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;unitId&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s2">&quot;maker&quot;</span><span class="p">:</span><span class="s2">&quot;Plat Home&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;Modbus Handler&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;Test Server&quot;</span><span class="p">,</span> <span class="s2">&quot;sku&quot;</span><span class="p">:</span><span class="s2">&quot;001&quot;</span><span class="p">,</span>
    <span class="s2">&quot;do00&quot;</span><span class="p">:</span> <span class="s2">&quot;0x24&quot;</span><span class="p">,</span> <span class="s2">&quot;do01&quot;</span><span class="p">:</span> <span class="s2">&quot;0x36&quot;</span><span class="p">,</span> <span class="s2">&quot;do02&quot;</span><span class="p">:</span> <span class="s2">&quot;0xcd&quot;</span><span class="p">,</span> <span class="s2">&quot;do03&quot;</span><span class="p">:</span> <span class="s2">&quot;0xac&quot;</span><span class="p">,</span>
    <span class="s2">&quot;di00&quot;</span><span class="p">:</span> <span class="s2">&quot;0x00&quot;</span><span class="p">,</span> <span class="s2">&quot;di01&quot;</span><span class="p">:</span> <span class="s2">&quot;0x00&quot;</span><span class="p">,</span> <span class="s2">&quot;di02&quot;</span><span class="p">:</span> <span class="s2">&quot;0x00&quot;</span><span class="p">,</span> <span class="s2">&quot;di03&quot;</span><span class="p">:</span> <span class="s2">&quot;0x00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rego00&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span> <span class="s2">&quot;regi01&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;regi02&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;regi03&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
    <span class="s2">&quot;regi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで、reply_to は、制御文字列の MD5 です。</p>
<p>入力レジスタに値を書き込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;di00&quot;</span><span class="p">:</span> <span class="s2">&quot;0xff&quot;</span><span class="p">,</span> <span class="s2">&quot;regi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">678</span><span class="p">,</span> <span class="mi">910</span><span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで write オブジェクトに与えられるキーと値は、モデリングのinputBits オブジェクト配列内のbitオブジェクト、
又はinputRegistersオブジェクト配列内のregistersオブジェクトに指定される 'key', 'type', 'ratio'　に応じた値でなくてはなりません。但し書き込み処理において’base_ratio’と’ratio’を用いた数値の逆変換は行われません。</p>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-06-11T16:35:13.653+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;9e5d68f8ce9bb5dc3e86f2d3c2ef4167&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;request_from&quot;</span><span class="p">:</span> <span class="s2">&quot;0x13(0)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unitId&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s2">&quot;maker&quot;</span><span class="p">:</span> <span class="s2">&quot;Plat Home&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;Modbus Handler&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;Test Server&quot;</span><span class="p">,</span> <span class="s2">&quot;sku&quot;</span><span class="p">:</span><span class="s2">&quot;001&quot;</span><span class="p">,</span>
    <span class="s2">&quot;di00&quot;</span><span class="p">:</span> <span class="s2">&quot;0xff&quot;</span><span class="p">,</span> <span class="s2">&quot;regi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">678</span><span class="p">,</span> <span class="mi">910</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PD Handler Modbus 2</a><ul>
<li><a class="reference internal" href="#modbus">Modbus モデリングファイル</a><ul>
<li><a class="reference internal" href="#id1">インデックスの階層</a></li>
<li><a class="reference internal" href="#id2">モデリングファイルの例</a></li>
<li><a class="reference internal" href="#id3">Modbusモデリングファイルの書式</a><ul>
<li><a class="reference internal" href="#id4">構文</a></li>
<li><a class="reference internal" href="#id5">ルートオブジェクト</a></li>
<li><a class="reference internal" href="#maker">maker オブジェクト</a></li>
<li><a class="reference internal" href="#product">product オブジェクト</a></li>
<li><a class="reference internal" href="#model">model オブジェクト</a></li>
<li><a class="reference internal" href="#sku">sku オブジェクト</a></li>
<li><a class="reference internal" href="#bit">bit オブジェクト</a></li>
<li><a class="reference internal" href="#register">register オブジェクト</a></li>
<li><a class="reference internal" href="#rawrequest">rawRequest オブジェクト</a></li>
<li><a class="reference internal" href="#bitsarray">bitsArray オブジェクト</a></li>
<li><a class="reference internal" href="#registersarray">registersArray オブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">モデリングファイル作成支援ツール</a><ul>
<li><a class="reference internal" href="#id7">構文確認ツール</a></li>
<li><a class="reference internal" href="#id8">マージツール</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#pd-handler-modbus-2-client">PD Handler Modbus 2 Client</a><ul>
<li><a class="reference internal" href="#id9">デォルトパス</a></li>
<li><a class="reference internal" href="#id10">設定ファイルの書式</a><ul>
<li><a class="reference internal" href="#id11">構文</a></li>
<li><a class="reference internal" href="#id12">ルートオブジェクト</a></li>
<li><a class="reference internal" href="#clients">clients オブジェクト</a></li>
<li><a class="reference internal" href="#acquisitions">acquisitions オブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#csv">CSVファイル</a></li>
<li><a class="reference internal" href="#id13">基準時刻制御モード</a></li>
<li><a class="reference internal" href="#id14">メッセージオブジェクト</a></li>
<li><a class="reference internal" href="#id15">クラウドからの制御</a></li>
<li><a class="reference internal" href="#cli-pd-handler-modbus-2-cli">CLI (pd_handler_modbus_2_cli)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pd-handler-modbus-2-server">PD Handler Modbus 2 Server</a><ul>
<li><a class="reference internal" href="#id16">デォルトパス</a></li>
<li><a class="reference internal" href="#id17">設定ファイルの書式</a><ul>
<li><a class="reference internal" href="#id18">構文</a></li>
<li><a class="reference internal" href="#id19">ルートオブジェクト</a></li>
<li><a class="reference internal" href="#servers">serversオブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id20">メッセージオブジェクト</a></li>
<li><a class="reference internal" href="#id21">クラウドからの制御</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="modbus.html"
                        title="前の章へ">PD Handler Modbus</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="sw4x.html"
                        title="次の章へ">PD Handler SW4x</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020 Plat&#39;Home Co., Ltd. All rights reserved..
    </div>
  </body>
</html>