
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>PD Handler Modbus &#8212; OpenBlocks FW4 1.0.1 ドキュメント</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="PD Handler Modbus 2" href="modbus2.html" />
    <link rel="prev" title="PD Handler HVSMC" href="hvsmc.html" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="ja" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta name="description" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="keywords" content="OpenBlocks,IoT,AirManage,WEB UI,PD,Repeater,Handler" />
    <meta http-equiv="Content-Script-Type" content="text/JavaScript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="subject" content="OpenBlocks FW4の各種ドキュメントです。" />
    <meta name="abstract" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="owner" content="ぷらっとホーム株式会社" />
    <meta name="copyright" content="2020 Plat'Home Co., Ltd. All rights reserved." />
    <meta name="robots" content="INDEX,FOLLOW" />
  </head><body>
<div class="header">
	<div class="header_container">
		<a href="https://www.plathome.co.jp">
			<!-- <img src="/_static/logo_plathome_technology.png" width="137.5" alt="Plat'Home"> -->
			<img src="/_static/logo_plathome_white.png" width="137.5" alt="Plat'Home">
		</a>
		<div class="right">
			<a class="headlink" href="https://www.plathome.co.jp">
				会社TOP
			</a>
		</div>
		<div class="right">
			<a class="headlink" href="https://docs.plathome.co.jp">
				HOME
			</a>
		</div>
	</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="modbus2.html" title="PD Handler Modbus 2"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="hvsmc.html" title="PD Handler HVSMC"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenBlocks FW4 1.0.1 ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="data_handling_ref.html" accesskey="U">データハンドリング設定リファレンスガイド</a> &#187;</li> 
      </ul>
    </div>
</div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pd-handler-modbus">
<span id="data-handler-reference-modbus"></span><h1>PD Handler Modbus<a class="headerlink" href="#pd-handler-modbus" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="modbus">
<h2>Modbusファンクションコード<a class="headerlink" href="#modbus" title="このヘッドラインへのパーマリンク">¶</a></h2>
<table class="colwidths-given docutils align-default" id="id16">
<caption><span class="caption-text">PD Handler Modbusに用いられているファンクションコード</span><a class="headerlink" href="#id16" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 10%" />
<col style="width: 30%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>コード</p></th>
<th class="head"><p>名称</p></th>
<th class="head"><p>機能説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p>Read Coils</p></td>
<td><p>デジタル出力に設定されているビット値を読み込む。</p></td>
</tr>
<tr class="row-odd"><td><p>0x02</p></td>
<td><p>Read Discrete Input</p></td>
<td><p>デジタル入力のビット値を読み込む。</p></td>
</tr>
<tr class="row-even"><td><p>0x03</p></td>
<td><p>Read Holding Registers</p></td>
<td><p>レジスタ出力に設定されている値を読み込む。</p></td>
</tr>
<tr class="row-odd"><td><p>0x04</p></td>
<td><p>Read Input Registers</p></td>
<td><p>レジスタ入力の値を読み込む。</p></td>
</tr>
<tr class="row-even"><td><p>0x05</p></td>
<td><p>Write Single Coil</p></td>
<td><p>デジタル出力1ビットのビット値を設定する。</p></td>
</tr>
<tr class="row-odd"><td><p>0x06</p></td>
<td><p>Write Single Register</p></td>
<td><p>レジスタ出力１レジスタの値を設定する。</p></td>
</tr>
<tr class="row-even"><td><p>0x07</p></td>
<td><p>Read Exception Status</p></td>
<td><p>クライアント／サーバー間でエラーステータスを通知する。</p></td>
</tr>
<tr class="row-odd"><td><p>0x09</p></td>
<td><p>Write Single Discrete Input</p></td>
<td><p>デジタル入力1ビットのビット値を設定する。</p></td>
</tr>
<tr class="row-even"><td><p>0x0a</p></td>
<td><p>Write Single Input Register</p></td>
<td><p>レジスタ入力１レジスタの値を設定する。</p></td>
</tr>
<tr class="row-odd"><td><p>0x0f</p></td>
<td><p>Write Multiple Coils</p></td>
<td><p>連続する複数のデジタル出力のビット値を設定する。</p></td>
</tr>
<tr class="row-even"><td><p>0x10</p></td>
<td><p>Write Multiple Registers</p></td>
<td><p>連続する複数のレジスタ出力の値を設定する。</p></td>
</tr>
<tr class="row-odd"><td><p>0x11</p></td>
<td><p>Report Slave ID</p></td>
<td><p>接続可能なスレーブ（サーバー）機器のIDを通知する。</p></td>
</tr>
<tr class="row-even"><td><p>0x13</p></td>
<td><p>Write Multiple Discrete Input</p></td>
<td><p>連続する複数のデジタル入力のビット値を設定する。</p></td>
</tr>
<tr class="row-odd"><td><p>0x14</p></td>
<td><p>Write Multiple Input Registers</p></td>
<td><p>連続する複数のレジスタ入力の値を設定する。</p></td>
</tr>
<tr class="row-even"><td><p>0x16</p></td>
<td><p>Mark Write Registers</p></td>
<td><p>レジスタ出力をマスクする。</p></td>
</tr>
<tr class="row-odd"><td><p>0x17</p></td>
<td><p>Write and Read Registers</p></td>
<td><p>連続する複数のレジスタ出力の値を設定し、その値を読み込む。</p></td>
</tr>
</tbody>
</table>
<p>0x09, 0x0a, 0x13, 0x14 物理的な入力を持たないPD Handler Modbus Serverの
デジタル入力もしくはレジスタ入力をクラウド側から設定できるよう用意された、
本来のModbusプロトコルには存在しない独自拡張のファンクションです。</p>
<p>Modbus ファンクションコードは、
設定ファイルもしくはCSV ファイルあるいはクラウド側からの制御においてJSON 文字列の'function' キーの値に設定される.
'0x' から始まる16 進表記のファンクションコードを文字列として'function' キーの値に設定することも可能ですが、
16 進表記とは別に整数表記と文字列表記を用いることも可能です。</p>
<table class="colwidths-given docutils align-default" id="id17">
<caption><span class="caption-text">“function”キーに用いるファンクションコードの別称</span><a class="headerlink" href="#id17" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 38%" />
<col style="width: 13%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>コード</p></th>
<th class="head"><p>名称</p></th>
<th class="head"><p>整数表記</p></th>
<th class="head"><p>文字列表記</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p>Read Coils</p></td>
<td><p>1</p></td>
<td><p>read_coils</p></td>
</tr>
<tr class="row-odd"><td><p>0x02</p></td>
<td><p>Read Discrete Input</p></td>
<td><p>2</p></td>
<td><p>read_discrete_input</p></td>
</tr>
<tr class="row-even"><td><p>0x03</p></td>
<td><p>Read Holding Registers</p></td>
<td><p>3</p></td>
<td><p>read_holding_registers</p></td>
</tr>
<tr class="row-odd"><td><p>0x04</p></td>
<td><p>Read Input Registers</p></td>
<td><p>4</p></td>
<td><p>read_input_registers</p></td>
</tr>
<tr class="row-even"><td><p>0x05</p></td>
<td><p>Write Single Coil</p></td>
<td><p>5</p></td>
<td><p>write_single_coil</p></td>
</tr>
<tr class="row-odd"><td><p>0x06</p></td>
<td><p>Write Single Register</p></td>
<td><p>6</p></td>
<td><p>write_single_register</p></td>
</tr>
<tr class="row-even"><td><p>0x07</p></td>
<td><p>Read Exception Status</p></td>
<td><p>7</p></td>
<td><p>read_exception_status</p></td>
</tr>
<tr class="row-odd"><td><p>0x09</p></td>
<td><p>Write Single Discrete Input</p></td>
<td><p>9</p></td>
<td><p>write_single_input_register</p></td>
</tr>
<tr class="row-even"><td><p>0x0a</p></td>
<td><p>Write Single Input Register</p></td>
<td><p>10</p></td>
<td><p>write_single_input_register</p></td>
</tr>
<tr class="row-odd"><td><p>0x0f</p></td>
<td><p>Write Multiple Coils</p></td>
<td><p>15</p></td>
<td><p>write_multiple_coils</p></td>
</tr>
<tr class="row-even"><td><p>0x10</p></td>
<td><p>Write Multiple Registers</p></td>
<td><p>16</p></td>
<td><p>write_multiple_register</p></td>
</tr>
<tr class="row-odd"><td><p>0x11</p></td>
<td><p>Report Slave ID</p></td>
<td><p>17</p></td>
<td><p>report_slave_id</p></td>
</tr>
<tr class="row-even"><td><p>0x13</p></td>
<td><p>Write Multiple Discrete Input</p></td>
<td><p>19</p></td>
<td><p>write_muliple_discrete_input</p></td>
</tr>
<tr class="row-odd"><td><p>0x14</p></td>
<td><p>Write Multiple Input Registers</p></td>
<td><p>20</p></td>
<td><p>write_multiple_input_registers</p></td>
</tr>
<tr class="row-even"><td><p>0x16</p></td>
<td><p>Mark Write Registers</p></td>
<td><p>22</p></td>
<td><p>mark_write_registers</p></td>
</tr>
<tr class="row-odd"><td><p>0x17</p></td>
<td><p>Write and Read Registers</p></td>
<td><p>23</p></td>
<td><p>write_and_read_registers</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pd-handler-modbus-client">
<h2>PD Handler Modbus Client<a class="headerlink" href="#pd-handler-modbus-client" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id1">
<h3>デォルトパス<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus Client に関連するファイルのデォルトパスは次の通りです。</p>
<table class="docutils align-default" id="id18">
<caption><span class="caption-text">PD Handler Modbus Client に関連するファイルのデォルトパス</span><a class="headerlink" href="#id18" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パス名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/usr/sbin/pd_handler_modbus_client</p></td>
<td><p>常駐実行オブジェクト（デーモン）</p></td>
</tr>
<tr class="row-odd"><td><p>/lib/systemd/system/pd_handler_modbus_client.service</p></td>
<td><p>Systemd Serviceファイル</p></td>
</tr>
<tr class="row-even"><td><p>/etc/init.d/pd_handler_modbus_client</p></td>
<td><p>RCファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/config/pd_handler_modbus_client.conf</p></td>
<td><p>設定ファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/upload_dir/pd_handler_modbus_client.csv</p></td>
<td><p>CSVファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/run/pd_handler_modbus_client.pid</p></td>
<td><p>PIDファイル</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h3>設定ファイルの書式<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id3">
<h4>構文<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;csv_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;CSVファイルのパス名&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;clients&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">clients</span> <span class="n">オブジェクト</span><span class="o">&gt;</span><span class="p">,</span>
            <span class="s2">&quot;acquisitions&quot;</span> <span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="n">acquisitions</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="n">acquisitions</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
                <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
             <span class="o">&lt;</span><span class="n">clients</span> <span class="n">オブジェクト</span><span class="o">&gt;</span><span class="p">,</span>
             <span class="s2">&quot;acquisitions&quot;</span> <span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="n">acquisitions</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="n">acquisitions</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
                <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>ルートオブジェクト<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id19">
<caption><span class="caption-text">ルートオブジェクト</span><a class="headerlink" href="#id19" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>csv_file</p></td>
<td><p>文字列</p></td>
<td><p>CSVファイルのパス名. デフォルト値は'/var/webui/upload_dir/pd-data/pd_handler_modbus_client.csv'. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>clients</p></td>
<td><p>JSON obj</p></td>
<td><p>clients オブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="clients">
<h4>clients オブジェクト<a class="headerlink" href="#clients" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>clients オブジェクトは、PD Handler Modbus Client の動作を規定する設定オブジェクトです。
clients オブジェクトの配列数は、最大256 個です。
Modbus のプロトコル(TCP, RTC) に依存するオブジェクトとプロトコルに依存しない共通のオブジェクトがあります。</p>
<table class="colwidths-given docutils align-default" id="id20">
<caption><span class="caption-text">clients オブジェクト</span><a class="headerlink" href="#id20" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>localname</p></td>
<td><p>文字列</p></td>
<td><p>デバイスのローカル名. (32byte)</p></td>
</tr>
<tr class="row-even"><td><p>bind</p></td>
<td><p>文字列</p></td>
<td><p>制御メッセージを受け取るソケット名. 文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_handler/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>push_to</p></td>
<td><p>文字列</p></td>
<td><p>データの送り先ソケット名. 文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_repeater/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-even"><td><p>buffer_size</p></td>
<td><p>整数値</p></td>
<td><p>データのバッファサイズ(byte). デフォルト値は 4096</p></td>
</tr>
<tr class="row-odd"><td><p>receive</p></td>
<td><p>論理値</p></td>
<td><p>クラウドからメッセージを受け取る下流方向制御)か否か. デフォルト値は false</p></td>
</tr>
<tr class="row-even"><td><p>writeout</p></td>
<td><p>論理値</p></td>
<td><p>push_to に指定するソケットに出力するか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>protocol</p></td>
<td><p>文字列</p></td>
<td><p>接続プロトコル 'tcp' 又は 'rtu' を指定. デフォルト値は 'tcp'.</p></td>
</tr>
<tr class="row-even"><td><p>interval</p></td>
<td><p>整数値</p></td>
<td><p>データを取得する間隔(sec). デフォルト値は 60.</p></td>
</tr>
<tr class="row-odd"><td><p>timeout</p></td>
<td><p>整数値</p></td>
<td><p>データを取得出来ない場合のタイムアウト(msec). デフォルト値は 5000.</p></td>
</tr>
<tr class="row-even"><td><p>time_sync</p></td>
<td><p>論理値</p></td>
<td><p>基準時刻制御モード. デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>base_time</p></td>
<td><p>文字列</p></td>
<td><p>基準時刻制御モードの基準時刻を 'HH:MM' 形式で指定する. デフォルト値は '00:00'</p></td>
</tr>
<tr class="row-even"><td><p>node</p></td>
<td><p>文字列</p></td>
<td><p>【TCP 接続】PLC 機器の IP アドレス. デフォルト値は'127.0.0.1'</p></td>
</tr>
<tr class="row-odd"><td><p>port</p></td>
<td><p>整数値</p></td>
<td><p>【TCP 接続】PLC 機器のポート番号. デフォルト値は 502</p></td>
</tr>
<tr class="row-even"><td><p>device</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】のデバイス名. デフォルト値は '/dev/tty00'</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_speed</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】のビットレート. デフォルト値は 115200</p></td>
</tr>
<tr class="row-even"><td><p>rtu_bits</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】のビット数. 8 又は 7. デフォルト値は 8.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_parity</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】のパリティ. 'none','even','odd' のいずれか. デフォルト値は'none'.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_stop</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】のストップビット.  1 又は 2. デフォルト値は 1.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_rts_delay</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】の RTS ディレイ値(usec). 0 の場合は自動設定される値.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_reset</p></td>
<td><p>整数値</p></td>
<td><p>設定される値を越えて接続エラーが連続して発生した場合に 'device' キーに設定されるデバイスをリセットする. デフォルト値は 10.</p></td>
</tr>
<tr class="row-odd"><td><p>memo</p></td>
<td><p>文字列</p></td>
<td><p>出力に付加されるユーザー定義文字列. (256byte)</p></td>
</tr>
<tr class="row-even"><td><p>infos</p></td>
<td><p>JSON Object</p></td>
<td><p>出力に付加されるユーザー定義オブジェクト</p></td>
</tr>
<tr class="row-odd"><td><p>acquisitions</p></td>
<td><p>JSON配列</p></td>
<td><p>acquisitions オブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="acquisitions">
<h4>acquisitions オブジェクト<a class="headerlink" href="#acquisitions" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id21">
<caption><span class="caption-text">acquisitions オブジェクト</span><a class="headerlink" href="#id21" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>unit</p></td>
<td><p>整数</p></td>
<td><p>PLC 機器の Modbus ユニットID. 1 ～ 247 又は255 (TCP接続のみ)</p></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
<td><p>文字列又は整数</p></td>
<td><p>Modbus プロトコルのデータ読み出しファンクション名又はファンクション番号.
文字列の場合は、'read_coils', 'read_discrete input', 'read_holding_registers','read_input_registers' 又は'0x01'～'0x04'、
整数値の場合は文字列の順に1～4. デフォルト値は'read_holding_r_gisters'.</p></td>
</tr>
<tr class="row-even"><td><p>data_type</p></td>
<td><p>文字列又は整数</p></td>
<td><p>文字列の場合は'uint16_t','int16_t','uint32lsb_t','int32lsb_t', 'uint32msb_t','int32msb_t' のいずれか.
整数値の場合は文字列の順に 0～5.
function が'read_coils' 又は'read discrete_input'の場合は、'uint16_t' に固定される. デフォルト値は'uint16 t'.</p></td>
</tr>
<tr class="row-odd"><td><p>address</p></td>
<td><p>文字列又は整数</p></td>
<td><p>読み込み介しレジスタアドレスを指定する. 文字列の先頭に'0x'が付加されている場合は16 進表記と解釈される.
デフォルト値は'0x0'.</p></td>
</tr>
<tr class="row-even"><td><p>number</p></td>
<td><p>文字列又は整数</p></td>
<td><p>読み込むビット数またはレジスタ数、文字列の先頭に'0x' が付加されている場合は16 進表記と解釈される.
data_type が'uint32lsb_t', 'int32ls_t','uint32msb_t','int32msb_t' の場合は、内部的に2 倍の値で扱われる. デフォルト値は1.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id5">
<h3>利用可能なファンクションコード<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus Client で利用可能なファンクションコードを示します。</p>
<table class="docutils align-default" id="id22">
<caption><span class="caption-text">PD Handler Modbus Client で利用可能なファンクションコード</span><a class="headerlink" href="#id22" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>コード</p></th>
<th class="head"><p>名称</p></th>
<th class="head"><p>ローカル</p></th>
<th class="head"><p>クラウド</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p>Read Coils</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x02</p></td>
<td><p>Read Discrete Input</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x03</p></td>
<td><p>Read Holding Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x04</p></td>
<td><p>Read Input Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x05</p></td>
<td><p>Write Single Coil</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x06</p></td>
<td><p>Write Single Register</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x07</p></td>
<td><p>Read Exception Status</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x09</p></td>
<td><p>Write Single Discrete Input</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>0x0a</p></td>
<td><p>Write Single Input Register</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x0f</p></td>
<td><p>Write Multiple Coils</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x10</p></td>
<td><p>Write Multiple Registers</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x11</p></td>
<td><p>Report Slave ID</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x13</p></td>
<td><p>Write Multiple Discrete Input</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x14</p></td>
<td><p>Write Multiple Input Registers</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>0x16</p></td>
<td><p>Mask Write Registers</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x17</p></td>
<td><p>Write And Read Registers</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
<p>ローカルは、設定ファイルもしくはCSV ファイルに指定可能なファンクションコード、
クラウドはクラウド側か指定可能なファンクションコードを意図します。</p>
</div>
<div class="section" id="csv">
<h3>CSVファイル<a class="headerlink" href="#csv" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>/var/webui/config/pd_handler_modbus_client.conf のcsv_fileキーに設定されるCSVファイルを置くことで、
/var/webui/config/pd_handler_modbus_client.conf で設定された１つのデバイス番号に対し
複数の取得Modbusクライアントデバイスを設定することができます。</p>
<p>CSVファイルの書式は、次の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>デバイス番号，ユニットID，読込方式，データタイプ，読込開始アドレス，読込レジスタ数
</pre></div>
</div>
<table class="colwidths-given docutils align-default" id="id23">
<caption><span class="caption-text">PD Handler Modbus ClientのCSVファイルの書式</span><a class="headerlink" href="#id23" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 15%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>データの形式</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>デバイス番号</p></td>
<td><p>半角英数字</p></td>
<td><p>WebUIにより割り振れたデバイス番号を記載します。
WebUIに設定されていないデバイス番号は無視されます。
先頭が'#'または”/”の場合は、コメント行として扱われます。</p></td>
</tr>
<tr class="row-odd"><td><p>ユニットID</p></td>
<td><p>半角数字</p></td>
<td><p>PLC機器のModbus ユニットIDを設定します。　ユニットIDは、１～247または255を記載します。</p></td>
</tr>
<tr class="row-even"><td><p>読込方式</p></td>
<td><p>半角英数字</p></td>
<td><p>読込方式として次の何れかを記載します。</p>
<dl class="simple">
<dt>デジタル出力:</dt><dd><p>'read_coils'又は '0x01' 又は ‘1'</p>
</dd>
<dt>デジタル入力:</dt><dd><p>'read_discrete_input' 又は '0x02' 又は ‘2'</p>
</dd>
<dt>レジスタ出力:</dt><dd><p>'read_holding_registers' 又は '0x03' 又は '3'</p>
</dd>
<dt>レジスタ入力:</dt><dd><p>'read_input_registers' 又は'0x04' 又は ‘4'</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>データタイプ</p></td>
<td><p>半角英数字</p></td>
<td><p>データタイプとして次の何れかを記載します。</p>
<dl class="simple">
<dt>符号なし16ビット整数:</dt><dd><p>'uint16_t' 又は '0'</p>
</dd>
<dt>符号付き16ビット整数:</dt><dd><p>'int16_t' 又は '1'</p>
</dd>
<dt>符号なし32ビット整数/リトルエンディアン:</dt><dd><p>'uint32lsb_t' 又は ‘2'</p>
</dd>
<dt>符号付き32ビット整数/リトルエンディアン:</dt><dd><p>'int32lsb_t' 又は ‘3'</p>
</dd>
<dt>符号なし32ビット整数/ビッグエンディアン:</dt><dd><p>'uint32msb_t' 又は ‘4'</p>
</dd>
<dt>符号付き32ビット整数/ビッグエンディアン:</dt><dd><p>'int32msb_t' 又は ‘5'</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>読込開始アドレス</p></td>
<td><p>半角英数字</p></td>
<td><p>読み込みたいデータが格納されているPLC機器上の開始アドレスを設定します。
先頭が'0x'の場合は16進数と解釈されます。</p></td>
</tr>
<tr class="row-odd"><td><p>読込レジスタ数</p></td>
<td><p>半角数字</p></td>
<td><p>読み込みたいレジスタ数を記載します。</p></td>
</tr>
</tbody>
</table>
<p>各パラメータの区切りはカンマ、先頭がシャープ '#' もしくはスラッシュ '/' の行はコメント行と見なされます。</p>
<p>CSVファイルが読み込まれるとclientsオブジェクトに設定されたModbusクライアントデバイスは上書きされます
そのため、CSVファイルにはclientsオブジェクトに設定したModbusクライアントデバイスを含む取得したい全ての
Modbusクライアントデバイスを記載して下さい。</p>
</div>
<div class="section" id="id6">
<h3>基準時刻制御<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">基準時刻制御は、特定の時刻にデータを取得する機能です。</div>
<div class="line">clients オブジェクトのtime_sysncキーを true に設定し、intervalキーとbase_timeキーで取得間隔と取得時刻を設定します。</div>
<div class="line">基準時刻制御における「取得時間間隔」は300, 600, 900, 1800, 3600, 7200, 10800, 14400, 21600, 28800, 43200と86400の倍数に限られます。「取得時間間隔」としてこれら以外の値が設定されるとPD Handler Modbus Client内で次のように扱われます。</div>
</div>
<table class="docutils align-default" id="id24">
<caption><span class="caption-text">基準時刻制御における取得時間間隔の設定と実動作値</span><a class="headerlink" href="#id24" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>取得時間間隔の設定値</p></th>
<th class="head"><p>実動作値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0  ～ 599</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-odd"><td><p>600 ～ 899</p></td>
<td><p>600</p></td>
</tr>
<tr class="row-even"><td><p>900 ～ 1799</p></td>
<td><p>900</p></td>
</tr>
<tr class="row-odd"><td><p>1800 ～ 3599</p></td>
<td><p>1800</p></td>
</tr>
<tr class="row-even"><td><p>3600 ～ 7199</p></td>
<td><p>3600</p></td>
</tr>
<tr class="row-odd"><td><p>7200 ～ 10799</p></td>
<td><p>7200</p></td>
</tr>
<tr class="row-even"><td><p>10800 ～ 14399</p></td>
<td><p>10800</p></td>
</tr>
<tr class="row-odd"><td><p>14400 ～ 21599</p></td>
<td><p>14400</p></td>
</tr>
<tr class="row-even"><td><p>21600 ～ 28799</p></td>
<td><p>21600</p></td>
</tr>
<tr class="row-odd"><td><p>28800 ～ 43199</p></td>
<td><p>28800</p></td>
</tr>
<tr class="row-even"><td><p>43200 ～ 86399</p></td>
<td><p>43200</p></td>
</tr>
<tr class="row-odd"><td><p>86400 ～</p></td>
<td><p>86400 の倍数</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「基準時刻」とは動作の起点となる時刻で、例えば「取得時間間隔」を300とし、「基準時刻」を '00:01' とした場合、データの取得は 00:01, 00:06, 00:11 ... 00:56, 01:01 ... 23:56, 00:01の定刻に行われます。</div>
<div class="line">データの取得開始時刻は「基準時刻」に設定さた時刻そのものではなく、「基準時刻」と「取得時間間隔」から算定される直近の時刻となります。</div>
<div class="line">例えば08:30に「基準時刻」'01:05'、 「取得時間間隔」10800の設定が行われた場合、最初のデータ取得は10:05に行われ、以降13:05, 16:05, 19:05, 22:05, 01:05の順におこなわれます。</div>
</div>
</div>
<div class="section" id="id7">
<h3>メッセージオブジェクト<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>入出力メッセージに用いられる JSON オブジェクトを示します。</p>
<table class="colwidths-given docutils align-default" id="id25">
<caption><span class="caption-text">PD Handler Modbus Client のメッセージオブジェクト</span><a class="headerlink" href="#id25" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 12%" />
<col style="width: 19%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>内容</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>方向</p></th>
<th class="head"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>time</p></td>
<td><p>データ取得日時</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>ISO8601拡張書式</p></td>
</tr>
<tr class="row-odd"><td><p>prototocol</p></td>
<td><p>プロトコル</p></td>
<td><p>文字列</p></td>
<td><p>入出力</p></td>
<td><p>'tcp' 又は 'rtu'</p></td>
</tr>
<tr class="row-even"><td><p>node</p></td>
<td><p>取得先 IP アドレス</p></td>
<td><p>文字列</p></td>
<td><p>入出力</p></td>
<td><p>TCP接続時のみ</p></td>
</tr>
<tr class="row-odd"><td><p>port</p></td>
<td><p>ポート番号</p></td>
<td><p>整数値</p></td>
<td><p>入出力</p></td>
<td><p>TCP接続時のみ.</p></td>
</tr>
<tr class="row-even"><td><p>device</p></td>
<td><p>デバイスファイル名</p></td>
<td><p>文字列</p></td>
<td><p>入出力</p></td>
<td><p>RTU接続時のみ</p></td>
</tr>
<tr class="row-odd"><td><p>unit</p></td>
<td><p>Modbus Unit ID</p></td>
<td><p>整数値</p></td>
<td><p>入出力</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>memo</p></td>
<td><p>メモ</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>memo キーに設定された値</p></td>
</tr>
<tr class="row-odd"><td><p>address</p></td>
<td><p>読み／書き込みアドレス</p></td>
<td><p>整数値</p></td>
<td><p>入出力</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>number</p></td>
<td><p>読み込むレジスタ数</p></td>
<td><p>整数値</p></td>
<td><p>入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
<td><p>Modbus function code</p></td>
<td><p>整数値</p></td>
<td><p>入出力</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>data_type</p></td>
<td><p>データの型</p></td>
<td><p>文字列</p></td>
<td><p>入出力</p></td>
<td><p>'uint16_t', 'int16_t', 'uint32lsb_t', 'int32lsb_t', 'uint32msb_t', 'int32msb_t' のいずれか</p></td>
</tr>
<tr class="row-odd"><td><p>valuse</p></td>
<td><p>読み／書き込み</p></td>
<td><p>整数配列</p></td>
<td><p>入出力</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>reply_to</p></td>
<td><p>リクエストメッセージのMD5</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>result</p></td>
<td><p>制御ステータス</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td><p>'done', 'not queuing', 'failed' のいずれか</p></td>
</tr>
<tr class="row-even"><td><p>reason</p></td>
<td><p>エラーの理由</p></td>
<td><p>文字列</p></td>
<td><p>出力</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h3>クラウドからの制御<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">クラウドから PD Repeater を介し制御(JSON)文字列を送ることで、接続されている PLC 機器のレジスタを読み書きすることができます。</div>
<div class="line">制御文字列には、PLC 機器を特定するため clients オブジェクトの protocol, node, port, もしくは device とacquisitions オブジェクトの unit, function, data_type, address, number および書き込みファンクションにおいては、valuseに値を記載します。</div>
<div class="line">node, port, もしくは device は、設定ファイルに設定されているものでなければなりません。物理的に接続されていても設定ファイルに設定されていない node, port, もしくは device を操作することはできません。</div>
</div>
<p>例えば、TCP 接続されている PLC 機器の入力レジスタを読み込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.8&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span>
   <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;0x04&quot;</span><span class="p">,</span>
   <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16_t&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x160&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-09-05T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;452556d8daf1f7eb483d00ee03718e8e&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span>
    <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Modbus Client 00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.8&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="mi">352</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16_t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">65535</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで、reply_to は、制御文字列の MD5 です。</p>
<p>シリアル接続の PLC 機器の出力レジスタを書き込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;rtu&quot;</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/ttyMDF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;0x10&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32lsb_t&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x120&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4567</span><span class="p">,</span> <span class="mi">891011</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで data_type が 32bit の場合、values は上位/下位の 16 bits に分割されて処理されるため、書き込む値の数が 1 であっても function は Write Multiple Registers を使用しなくてはなりません。</p>
<p>これに対する、応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-09-05T16:35:13.653+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;fe9b49ff045f435a371303a82281f3f9&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span>
    <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Modbus Client 01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;rtu&quot;</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/ttyMDF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="mi">288</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32_t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4567</span><span class="p">,</span> <span class="mi">891011</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pd-handler-modbus-server">
<h2>PD Handler Modbus Server<a class="headerlink" href="#pd-handler-modbus-server" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Modbusサーバーは次表に示すレジスタマップを保持し、PLC機器からのModbusプロトコルによる接続を待ち受け、PLC機器の書き込み操作によりレジスタの値を更新すると共に更新されたレジスタとその値をPD Repeaterを介してクラウドに送ります。</div>
<div class="line">また、PD Repeaterを介してクラウドから送られる制御メッセージ(JSON文字列)に基づきレジスタマップを読み書きすることもできます。</div>
<div class="line">レジスタマップは、60 秒毎に更新があればレジスタマップファイルregisters.map に出力されます。</div>
</div>
<table class="docutils align-default" id="id26">
<caption><span class="caption-text">PD Handler Modbus Serverのレジスタマップ</span><a class="headerlink" href="#id26" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>レジスタ</p></th>
<th class="head"><p>開始アドレス</p></th>
<th class="head"><p>サイズ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>デジタル出力(Coils)</p></td>
<td><p>0x000</p></td>
<td><p>uint8_t × 2048</p></td>
</tr>
<tr class="row-odd"><td><p>デジタル入力(Discrete Input)</p></td>
<td><p>0x000</p></td>
<td><p>uint8_t × 2048</p></td>
</tr>
<tr class="row-even"><td><p>レジスタ出力(Holdig Registers)</p></td>
<td><p>0x000</p></td>
<td><p>uint16_t × 2048</p></td>
</tr>
<tr class="row-odd"><td><p>レジスタ入力(Input Registers)</p></td>
<td><p>0x000</p></td>
<td><p>uint16_t × 2048</p></td>
</tr>
</tbody>
</table>
<div class="section" id="id9">
<h3>デォルトパス<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus Server に関連するファイルのデォルトパスは次の通りです。</p>
<table class="docutils align-default" id="id27">
<caption><span class="caption-text">PD Handler Modbus Server に関連するファイルのデォルトパス</span><a class="headerlink" href="#id27" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パス名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/usr/sbin/pd_handler_modbus_server</p></td>
<td><p>常駐実行オブジェクト（デーモン）</p></td>
</tr>
<tr class="row-odd"><td><p>/lib/systemd/system/pd_handler_modbus_server.service</p></td>
<td><p>Systemd Serviceファイル</p></td>
</tr>
<tr class="row-even"><td><p>/etc/init.d/pd_handler_modbus_server</p></td>
<td><p>RCファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/webui/config/pd_handler_modbus_server.conf</p></td>
<td><p>設定ファイル</p></td>
</tr>
<tr class="row-even"><td><p>/var/webui/.modbus_server/registers.map</p></td>
<td><p>レジスタマップファイル</p></td>
</tr>
<tr class="row-odd"><td><p>/var/run/pd_handler_modbus_server.pid</p></td>
<td><p>PIDファイル</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id10">
<h3>設定ファイルの書式<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id11">
<h4>構文<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;registers_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;レジスタマップファイルのパス名&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;servers&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">servers</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">servers</span> <span class="n">オブジェクト</span><span class="o">&gt;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>ルートオブジェクト<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id28">
<caption><span class="caption-text">ルートオブジェクト</span><a class="headerlink" href="#id28" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>registers_file</p></td>
<td><p>文字列</p></td>
<td><p>レジスタマップファイルのパス名. デフォルト値は'/var/webui/.modbus_server/pd-data/registers.map'. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>servers</p></td>
<td><p>JSON obj</p></td>
<td><p>servers オブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="servers">
<h4>servers オブジェクト<a class="headerlink" href="#servers" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>server オブジェクトは、PD Handler Modbus Serverの動作を規定する設定オブジェクトです。
server オブジェクトの配列数は、最大8 個.
Modbus のプロトコル(TCP, RTC) に依存するオブジェクトとプロトコルに依存しない共通のオブジェクトがあります。</p>
<table class="colwidths-given docutils align-default" id="id29">
<caption><span class="caption-text">servers オブジェクト</span><a class="headerlink" href="#id29" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 12%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable</p></td>
<td><p>論理値</p></td>
<td><p>デフォルト値は false</p></td>
</tr>
<tr class="row-odd"><td><p>localname</p></td>
<td><p>文字列</p></td>
<td><p>デバイスのローカル名. (32byte)</p></td>
</tr>
<tr class="row-even"><td><p>bind</p></td>
<td><p>文字列</p></td>
<td><p>制御メッセージを受け取るソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_handler/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-odd"><td><p>push_to</p></td>
<td><p>文字列</p></td>
<td><p>データの送り先ソケット名.
文字列の先頭が '&#64;' の場合は abstract namespace と解釈する.
空の場合は、デフォルト値 '&#64;/pd_repeater/&lt;localname&gt;.sock' が設定される. (MAXPATHLEN)</p></td>
</tr>
<tr class="row-even"><td><p>buffer_size</p></td>
<td><p>整数値</p></td>
<td><p>データのバッファサイズ(byte). デフォルト値は 4096</p></td>
</tr>
<tr class="row-odd"><td><p>receive</p></td>
<td><p>論理値</p></td>
<td><p>クラウドからメッセージを受け取る下流方向制御)か否か. デフォルト値は false.</p></td>
</tr>
<tr class="row-even"><td><p>writeout</p></td>
<td><p>論理値</p></td>
<td><p>push_to に指定するソケットに出力するか否か. デフォルト値は true.</p></td>
</tr>
<tr class="row-odd"><td><p>protocol</p></td>
<td><p>文字列</p></td>
<td><p>接続プロトコル 'tcp' 又は 'rtu' を指定. デフォルト値は 'tcp'.</p></td>
</tr>
<tr class="row-even"><td><p>timeout</p></td>
<td><p>整数値</p></td>
<td><p>データを取得出来ない場合のタイムアウト(msec). デフォルト値は 5000.</p></td>
</tr>
<tr class="row-odd"><td><p>node</p></td>
<td><p>文字列</p></td>
<td><p>【TCP接続】PLC 機器からの接続を待ち受ける IP アドレス. デフォルト値は'0.0.0.0'</p></td>
</tr>
<tr class="row-even"><td><p>port</p></td>
<td><p>整数値</p></td>
<td><p>【TCP接続】PLC 機器からの接続を待ち受ける TCP ポート番号. デフォルト値は 502</p></td>
</tr>
<tr class="row-odd"><td><p>device</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続デバイス名. デフォルト値は '/dev/tty00'</p></td>
</tr>
<tr class="row-even"><td><p>rtu_speed</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続ビットレート. デフォルト値は 115200</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_bits</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続ビット数. 8 又は 7. デフォルト値は 8.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_parity</p></td>
<td><p>文字列</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続パリティ. 'none','even','odd' のいずれか. デフォルト値は'none'.</p></td>
</tr>
<tr class="row-odd"><td><p>rtu_stop</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続ストップビット.  1 又は 2. デフォルト値は 1.</p></td>
</tr>
<tr class="row-even"><td><p>rtu_rts_delay</p></td>
<td><p>整数値</p></td>
<td><p>【RTU接続】PLC 機器からの接続を待ち受けるシリアル接続の RTS ディレイ値(usec). 0 の場合は自動設定される値.</p></td>
</tr>
<tr class="row-odd"><td><p>unit</p></td>
<td><p>整数値</p></td>
<td><p>自身に付与する Modbus ユニット ID. 整数値 1 〜 247.</p></td>
</tr>
<tr class="row-even"><td><p>memo</p></td>
<td><p>文字列</p></td>
<td><p>出力に付加されるユーザー定義文字列. (256byte)</p></td>
</tr>
<tr class="row-odd"><td><p>infos</p></td>
<td><p>JSON Object</p></td>
<td><p>出力に付加されるユーザー定義オブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id13">
<h3>利用可能なファンクションコード<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PD Handler Modbus Server で利用可能なファンクションコードを示します。</p>
<table class="docutils align-default" id="id30">
<caption><span class="caption-text">PD Handler Modbus Server で利用可能なファンクションコード</span><a class="headerlink" href="#id30" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>コード</p></th>
<th class="head"><p>名称</p></th>
<th class="head"><p>ローカル</p></th>
<th class="head"><p>クラウド</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p>Read Coils</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x02</p></td>
<td><p>Read Discrete Input</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x03</p></td>
<td><p>Read Holding Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x04</p></td>
<td><p>Read Input Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x05</p></td>
<td><p>Write Single Coil</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x06</p></td>
<td><p>Write Single Register</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x07</p></td>
<td><p>Read Exception Status</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x09</p></td>
<td><p>Write Single Discrete Input</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x0a</p></td>
<td><p>Write Single Input Register</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x0f</p></td>
<td><p>Write Multiple Coils</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x10</p></td>
<td><p>Write Multiple Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x11</p></td>
<td><p>Report Slave ID</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x13</p></td>
<td><p>Write Multiple Discrete Input</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>0x14</p></td>
<td><p>Write Multiple Input Registers</p></td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>0x16</p></td>
<td><p>Mask Write Registers</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x17</p></td>
<td><p>Write And Read Registers</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
<p>ローカルは、設定ファイルもしくはCSV ファイルに指定可能なファンクションコード、
クラウドはクラウド側か指定可能なファンクションコードを意図します。</p>
</div>
<div class="section" id="id14">
<h3>クラウドからからの制御<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">クラウドから PD Repeater を介し制御(JSON)文字列を送ることで、レジスタマップを読み書きすることができます。</div>
<div class="line">acquisitions オブジェクトの function, data_type, address, number 相当のパラメタと、書き込みファンクションにおいては、valuse に値を記載します。</div>
<div class="line">PD Handler Modbus Client とは異なり自身のレジスタマップを読み書きするため、node, portもしくは device の設定は必要としません。</div>
</div>
<p>例えば、入力レジスタを読み込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;0x04&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16_t&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x160&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これに対する応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-09-05T15:30:05.758+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;14239b236795a8a9e06d60a25c015f2e&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span>
    <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Modbus Server 00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span><span class="s2">&quot;192.168.1.8&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">502</span><span class="p">,</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="mi">352</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16_t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">65535</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ここで、reply_to は、制御文字列の MD5 です。
| レジスタマップに node, port, もしくは device の区別はありませんが、PD Repeater からは異なる localname を持つ個別のデバイスと位置付けられるため、応答メッセージには、制御文字列を受けだ Unix ドメインソケットと対をなす node, port, もしくは device が付加されます。</p>
<p>入力レジスタを書き込むのであれば、その制御文字列は次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;0x14&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32_t&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;0x140&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4567</span><span class="p">,</span> <span class="mi">8910</span><span class="p">,</span> <span class="mi">561</span><span class="p">,</span> <span class="mi">435</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これに対する応答メッセージは、次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-09-05T16:35:13.653+09:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reply_to&quot;</span><span class="p">:</span> <span class="s2">&quot;d5bcc347ad36fa6e7090d0f763108882&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span>
    <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Modbus Server 01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;rtu&quot;</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/ttyMDF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="mi">320</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint32_t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4567</span><span class="p">,</span> <span class="mi">8910</span><span class="p">,</span> <span class="mi">561</span><span class="p">,</span> <span class="mi">435</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>レジスタマップのダンプと作成<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>レジスタマップファイル(/var/webui/.modbus_server/registers.map)の内容は、
/usr/sbin/pd_handler_modbus_register コマンドを用いて CSVファイルへダンプもしくは、
CSVファイルからレジスタマップファイルを作成することができます。</p>
<p>pd_handler_modbus_register コマンドのコマンドオプションを示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_register -h</span>
<span class="n">usages</span><span class="p">:</span> <span class="n">pd_handler_modbus_register</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">mapfile</span><span class="o">&gt;</span><span class="p">][</span><span class="o">-</span><span class="n">C</span> <span class="o">&lt;</span><span class="n">CSV</span> <span class="n">file</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="o">-</span><span class="n">d</span>            <span class="n">Dump</span> <span class="n">a</span> <span class="n">registers</span> <span class="nb">map</span> <span class="n">file</span> <span class="n">to</span> <span class="n">CSV</span> <span class="n">file</span><span class="o">.</span>
    <span class="o">-</span><span class="n">f</span> <span class="n">mapfile</span>    <span class="n">Registers</span> <span class="nb">map</span> <span class="n">file</span><span class="o">.</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">webui</span><span class="o">/.</span><span class="n">modbus_server</span><span class="o">/</span><span class="n">registers</span><span class="o">.</span><span class="n">map</span><span class="p">]</span>
    <span class="o">-</span><span class="n">C</span> <span class="n">CSV</span> <span class="n">file</span>   <span class="n">CSV</span> <span class="n">file</span> <span class="n">path</span> <span class="k">for</span> <span class="ow">in</span><span class="o">/</span><span class="n">out</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">stdin</span><span class="o">/</span><span class="n">stdout</span><span class="p">]</span>
</pre></div>
</div>
<p>レジスタマップファイルの CSV ファイルへダンプ例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_register -d</span>
    <span class="c1">#address, coil, discrete_input, register, input_register, comment</span>
    <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">65534</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">65534</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">65534</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
         <span class="p">:</span>
    <span class="mi">2047</span><span class="p">,,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<p>ここで、数値の並びは、</p>
<p>アドレス(0〜2047)、ディジタル出力値、ディジタル入力値、レジスタ出力値、レジスタ入力値の順です。</p>
<p>値は全て符号なし 16 ビットです。
レジスタマップファイルはコメントを保持しないため、コメント欄は常に空欄となります。</p>
<p>CSV ファイルからレジスタマップファイルを作成する場合は、次のような CVS ファイルを用意し、
pd_handler_modbus_register コマンドでレジスタマップファイルに変換します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">default</span> <span class="n">register</span> <span class="nb">map</span>
       <span class="c1">#address, coil, discrete_input, register, input_register, comment</span>
      <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>
      <span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span><span class="mi">65534</span><span class="p">,</span>
      <span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">32767</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span>
      <span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span><span class="mi">65535</span><span class="p">,</span>
</pre></div>
</div>
<p>CSVファイルは、アドレス 0〜2047 の全てを用意する必要はなく、値を設定する必要があるアドレスだけで構いません。
値は全て符号なし 16 ビットで指定し、ディジタル出力値とディジタル入力値は必ず 0 又は 1 とします。
記載されていないアドレスのレジスタ値は 0 がセットされます。
先頭が '#' もしくは '/' の行はコメントと見なされます。</p>
<p>pd_handler_modbus_register コマンドによるレジスタマップファイルへの変換方法は次の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="c1"># /usr/sbin/pd_handler_modbus_register -C default_register_map.csv</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PD Handler Modbus</a><ul>
<li><a class="reference internal" href="#modbus">Modbusファンクションコード</a></li>
<li><a class="reference internal" href="#pd-handler-modbus-client">PD Handler Modbus Client</a><ul>
<li><a class="reference internal" href="#id1">デォルトパス</a></li>
<li><a class="reference internal" href="#id2">設定ファイルの書式</a><ul>
<li><a class="reference internal" href="#id3">構文</a></li>
<li><a class="reference internal" href="#id4">ルートオブジェクト</a></li>
<li><a class="reference internal" href="#clients">clients オブジェクト</a></li>
<li><a class="reference internal" href="#acquisitions">acquisitions オブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">利用可能なファンクションコード</a></li>
<li><a class="reference internal" href="#csv">CSVファイル</a></li>
<li><a class="reference internal" href="#id6">基準時刻制御</a></li>
<li><a class="reference internal" href="#id7">メッセージオブジェクト</a></li>
<li><a class="reference internal" href="#id8">クラウドからの制御</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pd-handler-modbus-server">PD Handler Modbus Server</a><ul>
<li><a class="reference internal" href="#id9">デォルトパス</a></li>
<li><a class="reference internal" href="#id10">設定ファイルの書式</a><ul>
<li><a class="reference internal" href="#id11">構文</a></li>
<li><a class="reference internal" href="#id12">ルートオブジェクト</a></li>
<li><a class="reference internal" href="#servers">servers オブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">利用可能なファンクションコード</a></li>
<li><a class="reference internal" href="#id14">クラウドからからの制御</a></li>
<li><a class="reference internal" href="#id15">レジスタマップのダンプと作成</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="hvsmc.html"
                        title="前の章へ">PD Handler HVSMC</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="modbus2.html"
                        title="次の章へ">PD Handler Modbus 2</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020 Plat&#39;Home Co., Ltd. All rights reserved..
    </div>
  </body>
</html>