
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>複雑な構成の実現 &#8212; OpenBlocks FW4 1.0.1 ドキュメント</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/translations.js"></script>
    
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="next" title="PD Broker" href="../pd_broker/pd_broker.html" />
    <link rel="prev" title="アプリケーション設定の確認" href="../check_rc.html" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="ja" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta name="description" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="keywords" content="OpenBlocks,IoT,AirManage,WEB UI,PD,Repeater,Handler" />
    <meta http-equiv="Content-Script-Type" content="text/JavaScript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="subject" content="OpenBlocks FW4の各種ドキュメントです。" />
    <meta name="abstract" content="OpenBlocksに搭載しているFW4のドキュメントです。初期セットアップ方法や各種クラウドへのIoTデータの送受信(PD Repeater, PD Handler)、AirManageへの接続方法、自作開発に必用な情報等を記載しています。" />
    <meta name="owner" content="ぷらっとホーム株式会社" />
    <meta name="copyright" content="2020 Plat'Home Co., Ltd. All rights reserved." />
    <meta name="robots" content="INDEX,FOLLOW" />
  </head><body>
<div class="header">
	<div class="header_container">
		<a href="https://www.plathome.co.jp">
			<!-- <img src="/_static/logo_plathome_technology.png" width="137.5" alt="Plat'Home"> -->
			<img src="/_static/logo_plathome_white.png" width="137.5" alt="Plat'Home">
		</a>
		<div class="right">
			<a class="headlink" href="https://www.plathome.co.jp">
				会社TOP
			</a>
		</div>
		<div class="right">
			<a class="headlink" href="https://docs.plathome.co.jp">
				HOME
			</a>
		</div>
	</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../pd_broker/pd_broker.html" title="PD Broker"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="../check_rc.html" title="アプリケーション設定の確認"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OpenBlocks FW4 1.0.1 ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../data_handling.html" >データハンドリングガイド</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../custmize.html" accesskey="U">カスタマイズ</a> &#187;</li> 
      </ul>
    </div>
</div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="data-handler-custum-advanced">
<span id="id1"></span><h1>複雑な構成の実現<a class="headerlink" href="#data-handler-custum-advanced" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>PD Handler からのデータを Node-RED フィルタリングしたい場合、
WEB UI の設定だけでも Node-RED をユーザー定義デバイスとすれば、
PD Repeater から lsocket を用いてデータを Node-RED に渡し、Node-RED の出力を PD Handler へ返す構成が可能ですが、
データの収集において弊社用意するアプリケーション (PD Handler) を用いず、
各デバイス等からデータを取得するアプリケーションをユーザーが独自に開発し、
PD Repeater と連携しクラウドにデータを送信する方法を説明します。</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/through_repeater.png"><img alt="../../../_images/through_repeater.png" src="../../../_images/through_repeater.png" style="width: 650.65px; height: 164.45000000000002px;" /></a>
</div>
<p><a class="reference internal" href="../../application/application.html#data-handler-application"><span class="std std-ref">IoTデータ制御のアプリ設定</span></a> に示すユーザー定義のコンフィグを使用しUNIXドメインソケット名を変更することで、
下図のようなよりスループットを意識した構成とすることが可能です。</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/direct.png"><img alt="../../../_images/direct.png" src="../../../_images/direct.png" style="width: 650.65px; height: 78.65px;" /></a>
</div>
<p>設定ファイル(コンフィグ)はJSON形式で記載されており、UNIXドメインソケット名は次のキーで表記されます。</p>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">アプリ起動制御の設定項目</span><a class="headerlink" href="#id2" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>キー</p></th>
<th class="head"><p>形式</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bind</p></td>
<td><p>文字列</p></td>
<td><p>データを待ち受けるUNIXドメインソケット名。
空白の場合は各アプリケーションのデフォルト値をプリフックスとし、
デバイス番号を差フックスとするソケット名がもちいられる。
先頭が&#64;の場合は抽象的ドメイン名 (Abstract UNIX doamin name) であることを意図します。</p></td>
</tr>
<tr class="row-odd"><td><p>push_to</p></td>
<td><p>文字列</p></td>
<td><p>データの送り先となるUNIXドメインソケット名。
空白の場合は各アプリケーションのデフォルト値をプリフックスとし、
デバイス番号を差フックスとするソケット名がもちいられる。
先頭が&#64;の場合は抽象的ドメイン名 (Abstract UNIX doamin name) であることを意図します。</p></td>
</tr>
</tbody>
</table>
<p>Beacon デバイス　（PD Handler BLE）を例に設定方法を示します。</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../application/application.html#data-handler-application"><span class="std std-ref">IoTデータ制御のアプリ設定</span></a> に示す「コンフィグ設定モード」が「本システムコンフィグ」であることを確認します。
| WEB UIの「IoTデータ」→「アプリ設定」タブより、「コンフィグ設定モード表示」をチェックしてPD Handler BLEが「本システムコンフィグ」となっていることを確認します。</p></li>
</ol>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/system_config.png"><img alt="../../../_images/system_config.png" src="../../../_images/system_config.png" style="width: 698.0px; height: 314.0px;" /></a>
</div>
<ol class="arabic simple" start="2">
<li><p>WEB UIの「IoTデータ」→「送受信設定」タブの「送受信設定」メニューより、
送受信先の設定を行います。　設定方法は:ref:<cite>pd_repeater</cite> を参照して下さい。</p></li>
<li><p>WEB UIの「IoTデータ」→「送受信設定」タブの「ビーコン送信設定」メニューより、
ビーコンを受信し送信する設定を行います。設定方法は:ref:<cite>pd_handler_beacon</cite> を参照して下さい。</p></li>
<li><p>ここまでの設定で下図のようにPD Repeater は、UNIXドメインソケット &#64;/pd_repeater/device_beacon.sock でデータを持ち受け、
PD Handler BLE は &#64;/pd_repeater/device_beacon.sock にデータ書き込むよう設定されます。
| ここでUNIXドメインソケット名の '&#64;' はソケットが抽象的ドメイン名 (Abstract UNIX doamin name) であることを意図するものです。</p></li>
</ol>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/straight.png"><img alt="../../../_images/straight.png" src="../../../_images/straight.png" style="width: 650.65px; height: 86.45px;" /></a>
</div>
<ol class="arabic simple" start="5">
<li><p>「コンフィグ設定モード」を「ユーザー設定コンフィグ」に切り替えます。
| WEB UIの「IoTデータ」→「アプリ設定」タブより、「コンフィグ設定モード表示」をチェックしてPD Handler BLEを「ユーザー設定コンフィグ」に切り替えます。</p></li>
</ol>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/user_config.png"><img alt="../../../_images/user_config.png" src="../../../_images/user_config.png" style="width: 698.0px; height: 314.0px;" /></a>
</div>
<ol class="arabic simple" start="6">
<li><p>WEB UIにより作成されたシステムコンフィグをユーザーコンフィグとしてコピーし、
UNIXドメインソケット名を &#64;/pd_repeater/device_beacon.sock から &#64;/node-red/device_beacon.sock に変更します。</p></li>
</ol>
<div class="line-block">
<div class="line">　　6-1. WEB UIの「IoTデータ」→「編集」タブより、「編集対象ファイル」として</div>
<div class="line">　　　　「PD Handler BLE」を選択します。</div>
<div class="line">　　6-2.「Load(システムコンフィグ)」をクリックします。テキストエリアに表示された設定情報</div>
<div class="line">　　　　（JSON文字列）をコピーします。</div>
<div class="line">　　6-3.「Load(ユーザーコンフィグ)」をクリックします。２項で取得した設定情報（JSON文字列）</div>
<div class="line">　　　　をテキストエリアにペーストします。</div>
<div class="line">　　6-4. &quot;push_to&quot; キーの値を&quot;&#64;/node-red/device_beacon.sock&quot;に変更します。</div>
<div class="line">　　6-5.「保存」をクリックします。</div>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/edit_config.png"><img alt="../../../_images/edit_config.png" src="../../../_images/edit_config.png" style="width: 478.40000000000003px; height: 453.05px;" /></a>
</div>
<ol class="arabic" start="7">
<li><p>Node-REDのUNIXドメインソケット入力ipc-inノードのプロパティを設定します。
Node-REDの利用方法については <a class="reference internal" href="../../../node-red/node-red.html#node-red-starter-guid"><span class="std std-ref">Node-REDスターターガイド</span></a> を参照して下さい。</p>
<p>ipc-inノードを配置し、プロパティの「Path」を&quot;/node-red/device_beacon.sock&quot; に設定し、「Abstract Flag」をチェツクします。</p>
</li>
</ol>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/node_red1.png"><img alt="../../../_images/node_red1.png" src="../../../_images/node_red1.png" style="width: 473.2px; height: 306.8px;" /></a>
</div>
<ol class="arabic" start="8">
<li><p>Node-REDのUNIXドメインソケット出力ipc-outノードのプロパティを設定します。</p>
<p>ipc-outノードを配置し、プロパティの「Path」を&quot;/pd_repeater/device_beacon.sock&quot;に設定し、「Abstract Flag」をチェツクします。</p>
</li>
</ol>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/node_red2.png"><img alt="../../../_images/node_red2.png" src="../../../_images/node_red2.png" style="width: 473.2px; height: 306.8px;" /></a>
</div>
<p>以上の設定で PD Handler BLE は &#64;/node-red/device_beacon.sock にデータ書き込み、
Node-RED は &#64;/node-red/device_beacon.sock でデータを待ち受け &#64;/pd_repeater/device_beacon.sock に書き込むように設定されます。</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../../_images/via_node_red.png"><img alt="../../../_images/via_node_red.png" src="../../../_images/via_node_red.png" style="width: 650.65px; height: 95.55px;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>前のトピックへ</h4>
  <p class="topless"><a href="../check_rc.html"
                        title="前の章へ">アプリケーション設定の確認</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="../pd_broker/pd_broker.html"
                        title="次の章へ">PD Broker</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020 Plat&#39;Home Co., Ltd. All rights reserved..
    </div>
  </body>
</html>