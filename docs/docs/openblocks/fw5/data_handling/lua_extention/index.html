<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">LUA言語拡張ハンドラ | ぷらっとホームどきゅめんと</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="LUA言語拡張ハンドラ | ぷらっとホームどきゅめんと"><meta data-react-helmet="true" name="description" content="OpenBlocksに用いているIoTゲートウェイソフトウェア「FW5」のデータハンドリングに関するドキュメントの「Lua拡張」のページです。"><meta data-react-helmet="true" property="og:description" content="OpenBlocksに用いているIoTゲートウェイソフトウェア「FW5」のデータハンドリングに関するドキュメントの「Lua拡張」のページです。"><meta data-react-helmet="true" name="keywords" content="IoT,Data Handling,PD Repeater,PD Handler,Device Shadow,customize,Lua,RS-SERIAL,RS232C,RS485,data_handler_custom_lua_extention"><meta data-react-helmet="true" property="og:url" content="https://docs.plathome.co.jp/docs/openblocks/fw5/data_handling/lua_extention"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.plathome.co.jp/docs/openblocks/fw5/data_handling/lua_extention"><link rel="stylesheet" href="/styles.6a7f28c3.css">
<link rel="preload" href="/styles.c6d5988d.js" as="script">
<link rel="preload" href="/runtime~main.3c6ecc41.js" as="script">
<link rel="preload" href="/main.40f297ea.js" as="script">
<link rel="preload" href="/1.7d91b6d9.js" as="script">
<link rel="preload" href="/1a4e3797.96891e2b.js" as="script">
<link rel="preload" href="/1be78505.6b22e6e7.js" as="script">
<link rel="preload" href="/c4f5d8e4.e3deaf6d.js" as="script">
<link rel="preload" href="/423.bf325f44.js" as="script">
<link rel="preload" href="/422.7c8e2ca8.js" as="script">
<link rel="preload" href="/935f2afb.c062de1d.js" as="script">
<link rel="preload" href="/421.015e3d13.js" as="script">
<link rel="preload" href="/3b8484a0.3bb861b3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_3046 navbarHidden_1Uo_"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">ぷらっとホームどきゅめんと</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a target="_self" rel="noopener noreferrer" class="navbar__item navbar__link" href="/search/">検索</a></div><div class="navbar__items navbar__items--right"><a href="https://www.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">会社トップ</a><a href="https://www.plathome.co.jp/support/topix-software-update/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">アップデート情報</a><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">FAQ</a><a href="https://blog.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">ブログ</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search searchBarContainer_1-U_"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_18Th searchBarLoadingRing_zYFK"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">ぷらっとホームどきゅめんと</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a target="_self" rel="noopener noreferrer" class="menu__link" href="/search/">検索</a></li><li class="menu__list-item"><a href="https://www.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="menu__link">会社トップ</a></li><li class="menu__list-item"><a href="https://www.plathome.co.jp/support/topix-software-update/" target="_blank" rel="noopener noreferrer" class="menu__link">アップデート情報</a></li><li class="menu__list-item"><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="menu__link">FAQ</a></li><li class="menu__list-item"><a href="https://blog.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="menu__link">ブログ</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC sidebarWithHideableNavbar_2IoJ"><a tabindex="-1" class="sidebarLogo_Snse" href="/"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--light_AouX"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--dark_1YPN"><strong>ぷらっとホームどきゅめんと</strong></a><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">免責・商標一覧</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">免責事項と商標について</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doclist">ドキュメント一覧</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">OpenBlocks</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">ハードウェア</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/bx0_spec">OpenBlocks IoT BX0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/bx1_spec">OpenBlocks IoT BX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/bx3_spec">OpenBlocks IoT BX3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/bx5_spec">OpenBlocks IoT BX5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/ex1_spec">OpenBlocks IoT EX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/vx1_spec">OpenBlocks IoT VX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/vx2_spec">OpenBlocks IoT VX2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/fx1_spec">OpenBlocks IoT FX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/dx1_spec">OpenBlocks IoT DX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/ix9_spec">OpenBlocks IX9</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/a16_spec">OpenBlocks A16</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/hx1_spec">OpenBlocks HX1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/iotmodule_spec">OpenBlocks用モジュールetc</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/common">その他オプション</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/hardware/certification">技術基準適合マーク</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">ソフトウェア</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Debian Linux FW5</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/doclist">FW5ドキュメント一覧</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">スタートアップガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/first/first">WEB-UI接続準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/initial/initial">初期設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/airmanage/airmanage">遠隔管理AirManage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/service/service">サービスの追加</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/iotstart/iotstart">IoTセットアップ手順</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">サービスガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/basic">デバイス登録</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/iotdata">IoTデータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/nodered">Node-RED設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/camera">カメラ機能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/docker">Docker/Moby設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/iotedge">Azure IoT Edge設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">拡張サービスガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/samba">Samba設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/ftp_server">FTPサーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/ftp_download">FTPダウンロード設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/ftp_upload">FTPアップロード設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/service/secure">不正ログイン監視(セキュリティ)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">WEB-UIガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/index">WEB-UIタブ別インデックス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/system">システム関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/network">ネットワーク関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/storage">ストレージ関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/maintenance">メンテナンス関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/smscontrol">SMSコントロール</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/webui/reference/etcetera">その他の設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">センサーデータの受信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_handler">PD Handler</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">センサーI/F毎の設定</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/beacon">BLEビーコン送信設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/ble">BLEデバイス設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/enocean">EnOceanデバイス設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/wi-sun_b">Wi-SUN Bルート情報送信設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus/client">Modbusクライアント設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus/server">Modbusサーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus2/client">Modbus2クライアント設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus2/server">Modbus2サーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/sw4x/sw4x">SW4xデバイス設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/hvsmc">高圧スマートメータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/bidirec_hvsmc">双方向対応高圧スマートメータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/lvsmc">低圧スマートメータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/user_dev">デバイス設定(ユーザー定義)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/log">IoTデータ制御ツールログ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/custom">その他GATTやRS232Cなど</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">対応センサJSONフォーマット</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/ble">BLEビーコン&amp;センサー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/enocean">EnOceanセンサー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/wisun">低圧スマートメーター(PD Handler UART)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/lvsmc">低圧スマートメーター</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/hvsmc">高圧スマートメーター</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/bidirec_hvsmc">双方向対応高圧スマートメーター</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/modbus_merge">Modbus PLC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/sw4x">ミスター省エネ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_form/files_handler">PD File&#x27;s Handler</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">IoTクラウド/サーバー送受信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/pd_repeater">PD Repeater 送受信設定</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">送受信先毎の設定</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/dexpf">DEXPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/dexpf_ws">DEXPF[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/iothub">MS Azure IoT Hub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/iothub_ws">MS Azure IoT Hub[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/awsiot">AWS IoT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/awsiot_ws">AWS IoT[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/iotcore">Google IoT Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/w4g">Watson IoT for Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/eventhub">MS Azure Event hubs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/kinesis">Amazon Kinesis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/w4d">Watson IoT for Device</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/sbiot">SoftBank スマ可視専用クラウド</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/kddi_std">KDDI IoT クラウド Standard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/pd_web">PHオリジナルWEBサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/web">WEBサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/mqtt">MQTTサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/ltcp">TCPサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/pd_ex">PD Exchange</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/lsocket">ユニックスドメインソケット</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">下流方向デバイス制御</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/down_stream">下流方向制御の概要</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_repeater/down_stream_message">PD Repeaterの下流方向メッセージ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Modbus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus/down_stream">Modbusの下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus/down_stream_client">Modbusクライアント</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus/down_stream_server">Modbusサーバー</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Modbus2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus2/down_stream_client">Modbus2クライアント</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/modbus2/down_stream_server">Modbus2サーバー</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/sw4x/down_stream">ミスター省エネSW4x</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/down_stream_serial_ble">BLEとシリアルI/Fの下流制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/lvsmc_downstream">低圧スマートメーター下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/hvsmc_downstream">高圧スマートメーター下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/bidirec_hvsmc_downstream">双方向対応高圧スマートメーター下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling/pd_agent">PD Agent</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">開発者向けガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/developer/before_use/before_use">カスタマイズ前の注意と補足</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/developer/how_to_use/how_to_use">OpenBlocks HW 制御ソフト</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">カスタマイズ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/user_app">カスタムデータ収集モジュール</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/user_app_down_stream">下流方向制御モジュール</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/rc">自作アプリの起動・停止制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/deb_package">deb パッケージ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/check_rc">アプリケーション設定の確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/advanced">複雑な構成の実現</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/pd_broker">PD Broker</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/openblocks/fw5/data_handling/lua_extention">LUA言語拡張ハンドラ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/adjust">PDHMSの調整</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/csv_data">CSVデータ送信機能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/data_handling/file_data">ファイル送信機能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw5/developer/web_api">OpenBlocks WEB UI用API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">PDHMS リファレンス</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/index">索引</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/common">共通事項</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/pd_repeater">PD Repeater</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/pd_broker">PD Broker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/pd_agent">PD Agent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/files_handler">PD File&#x27;s Handler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/ble">PD Handler BLE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/uart">PD Handler UART</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/lvsmc">PD Handler LVSMC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/hvsmc">PD Handler HVSMC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/bidirec_hvsmc">PD Handler HVSMC(双方向対応)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/modbus">PD Handler Modbus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/modbus2">PD Handler Modbus 2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/data_handling_ref/sw4x">PD Handler SW4x</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Node-REDスターターガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/node-red/easy-exp/easy-exp">Node-REDの簡易説明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/node-red/sample/sample">ノード操作サンプル</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">OpenBlocks IoTチュートリアル</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">EnOceanデータをIoT Hubへ送信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/iothub/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/iothub/azure_iot_hub">IoT Hub の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/iothub/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/iothub/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/iothub/reference">参考ページ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">BLEデータをAWS IoTへ送信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/awsiot/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/awsiot/aws_iot_core">AWS IoT Coreの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/awsiot/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/awsiot/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/awsiot/reference">参考ページ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">BLEデータの転送と可視化</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/broker">MQTTブローカーの準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/openblocks_iot_pub">OpenBlocks IoT の設定(送信側)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/openblocks_iot_sub">OpenBlocks IoT の設定(受信側)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/nodered">Node-REDの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/mqtt/reference">参考ページ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">RS-SERIALでDevice Shadowを使う</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/device">シリアル・デバイスの準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/aws_iot_core">AWS IoT Coreの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/app_client">Application Clientの準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw5/tutorial/rs_serial/reference">参考ページ</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Debian Linux FW4</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/doclist">FW4ドキュメント一覧</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">スタートアップガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/first/first">WEB-UI接続準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/initial/initial">初期設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/airmanage/airmanage">遠隔管理AirManage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/service/service">サービスの追加</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/iotstart/iotstart">IoTセットアップ手順</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">サービスガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/basic">基本(IoTデータ必読)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/iotdata">IoTデータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/nodered">Node-RED設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/camera">カメラ機能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/docker">Docker/Moby設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/iotedge">Azure IoT Edge設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">拡張サービスガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/samba">Samba設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/ftp_server">FTPサーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/ftp_download">FTPダウンロード設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/ftp_upload">FTPアップロード設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/service/secure">不正ログイン監視(セキュリティ)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">WEB-UIガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/index">WEB-UIタブ別インデックス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/dashboard">ダッシュボード</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/system">システム関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/network">ネットワーク関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/storage">ストレージ関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/maintenance">メンテナンス関連の設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/smscontrol">SMSコントロール</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/webui/reference/etcetera">その他の設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">センサーデータの受信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_handler">PD Handler</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">センサーI/F毎の設定</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/beacon">BLEビーコン送信設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/ble">BLEデバイス情報送信設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/enocean">EnOceanデバイス設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/wi-sun_b">Wi-SUN Bルート情報送信設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus/client">Modbusクライアント設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus/server">Modbusサーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus2/client">Modbus2クライアント設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus2/server">Modbus2サーバー設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/sw4x/sw4x">SW4xデバイス設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/hvsmc">高圧スマートメータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/user_dev">デバイス設定(ユーザー定義)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/log">IoTデータ制御ツールログ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/sensor_data">BLEセンサーグラフ表示</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">対応センサJSONフォーマット</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/ble">BLEビーコン&amp;センサー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/enocean">EnOceanセンサー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/wisun">低圧スマートメーター</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/hvsmc">高圧スマートメーター</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/modbus_merge">Modbus PLC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_form/sw4x">ミスター省エネ</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">IoTクラウド/サーバー送受信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/pd_repeater">PD Repeater 送受信設定</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">送受信先毎の設定</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/lo">本体内データベース</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/dexpf">DEXPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/dexpf_ws">DEXPF[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/iothub">MS Azure IoT Hub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/iothub_ws">MS Azure IoT Hub[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/awsiot">AWS IoT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/awsiot_ws">AWS IoT[Websocket]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/iotcore">Google IoT Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/w4g">Watson IoT for Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/eventhub">MS Azure Event hubs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/kinesis">Amazon Kinesis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/w4d">Watson IoT for Device</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/t4d">Toami for DOCOMO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/sbiot">SoftBank スマ可視専用クラウド</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/kddi_std">KDDI IoT クラウド Standard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/pd_web">PHオリジナルWEBサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/web">WEBサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/mqtt">MQTTサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/ltcp">TCPサーバー</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/pd_ex">PD Exchange</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/lsocket">ユニックスドメインソケット</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">下流方向デバイス制御</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/down_stream">下流方向制御の概要</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_repeater/down_stream_message">PD Repeaterの下流方向メッセージ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Modbus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus/down_stream">Modbusの下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus/down_stream_client">Modbusクライアント</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus/down_stream_server">Modbusサーバー</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Modbus2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus2/down_stream_client">Modbus2クライアント</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/modbus2/down_stream_server">Modbus2サーバー</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/sw4x/down_stream">ミスター省エネSW4x</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/hvsmc_downstream">高圧スマートメーター下流方向制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_agent">PD Agent</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">開発者向けガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/developer/before_use/before_use">カスタマイズ前の注意と補足</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/developer/how_to_use/how_to_use">OpenBlocks HW 制御ソフト</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">カスタマイズ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/user_app">カスタムデータ収集アプリ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/user_app_down_stream">下流方向制御アプリ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/rc">自作アプリの起動・停止制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/deb_package">deb パッケージ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/check_rc">アプリケーション設定の確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/advanced">複雑な構成の実現</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/pd_broker">PD Broker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/lua_extention">LUA言語拡張ハンドラ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/adjust">PDHMSの調整</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling/csv_data">CSVデータ送信機能</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">PDHMS リファレンス</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/index">索引</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/common">共通事項</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/pd_repeater">PD Repeater</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/pd_broker">PD Broker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/pd_agent">PD Agent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/ble">PD Handler BLE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/uart">PD Handler UART</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/hvsmc">PD Handler HVSMC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/modbus">PD Handler Modbus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/modbus2">PD Handler Modbus 2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/data_handling_ref/sw4x">PD Handler SW4x</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Node-REDスターターガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/node-red/easy-exp/easy-exp">Node-REDの簡易説明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/node-red/sample/sample">ノード操作サンプル</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">OpenBlocks IoTチュートリアル</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">EnOceanデータをIoT Hubへ送信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/iothub/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/iothub/azure_iot_hub">IoT Hubの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/iothub/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/iothub/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/iothub/reference">参考ページ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">BLEデータをAWS IoTへ送信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/awsiot/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/awsiot/aws_iot_core">AWS IoT Coreの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/awsiot/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/awsiot/check">動作確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/awsiot/reference">参考ページ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CO2データをMQTTサーバーへ送信</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/mqtt/preface">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/mqtt/mqtt_server">MQTTサーバーの準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/mqtt/openblocks_iot">OpenBlocks IoTの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/mqtt/check">Node-REDでグラフを作る</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/fw4/tutorial/mqtt/reference">参考ページ</a></li></ul></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/fw3">Debian Linux FW3 (PDF一覧)</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">FW共通/工場出荷状態に戻す</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/factory/factory_reset">ファクトリーリセット</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">RAMディスク版OpenBlocks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/ramdisk_obs/ramdisk">Debianモデル(RAMディスク版)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/ramdisk_obs/obsix9r_debian">OpenBlocks IX9 Debian搭載モデル向け</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/ramdisk_obs/obshx1r_debian">OpenBlocks HX1 Debian搭載モデル向け</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">ストレージ版OpenBlocks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/storage_obs/storage">Debianモデル(ストレージ版)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openblocks/storage_obs/obsa16_storage">OpenBlocks A16 Debian搭載モデル向け</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/openblocks/windows">Windows版スタートガイド</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">EasyBlocks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp">EasyBlocks DHCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog">EasyBlocks Syslog</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix">EasyBlocks PacketiX VPN</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote">EasyBlocks Remote Office</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/ddn">EasyBlocks DDN (統合型)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter">EasyBlocks Network Reporter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor">EasyBlocks 監視</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi">EasyBlocks リモート監視管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource">EasyBlocks リソース監視</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/kvm">EasyBlocks KVM</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ハードウェアガイド</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/bpv4_spec">EasyBlocks BPV4型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/ebx9_spec">EasyBlocks EBX9型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/ebix_spec">EasyBlocks EBIX型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/ebb0_spec">EasyBlocks EBB0型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/eba16_spec">EasyBlocks EBA16型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/ebhx1_spec">EasyBlocks EBHX1型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/ebfx_spec">EasyBlocks EBFX型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/hardware/pro_spec">EasyBlocks ProLine型</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">初期設定共通</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/WEBUIcommon">WEB-UI接続準備</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/license">ソフトウェア使用許諾</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/account_reg">管理者アカウント登録</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/basic">時刻同期</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/basicsyslog">時刻同期（Syslog&amp;NetworkReporter用）</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/network">ネットワークの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/common/airmanage">遠隔管理AirManage</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">サービス毎の設定</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DHCP</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/conf">設定編集</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/basic">基本</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/subnet">サブネット</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/hostmng">ホスト管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/policymng">ポリシー管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/log">ログ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/arpscan">ARPスキャン</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dhcp/mainte">メンテナンス</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DNS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/edit">設定編集</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/basic">基本設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/zone">ゾーン</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/record">レコード</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/log">ログ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/dns/mainte">メンテナンス</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">NTP</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/ntp/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/ntp/basic">基本設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/ntp/syncinfo">同期情報</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Syslog</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_disp">ログ表示</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_statistic">ログ統計</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_basic">基本設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_rule">フィルタ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_logcont">ログ管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_cert">証明書管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/syslog/syslog_zabbix">Zabbix設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">PacketiX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix/file_control">ファイル管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix/update">アップデート</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix/service_detail">サービス詳細設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/packetix/precautions">注意事項</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Remote Office</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/file_control">ファイル管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/update">アップデート</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/bulk_regist">一括登録</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/service_detail">サービス詳細設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/client_setup">子機の設置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/remote/precautions">注意事項</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Network Reporter</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_disp">ログ表示</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_statistic">ログ統計</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_basic">基本設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_rule">フィルタ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_logcont">ログ管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_report">レポート</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_setting_rt">ルータ設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_cert">証明書管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_rtxcontrol">制御</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/reporter/reporter_zabbix">Zabbix設定</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">監視</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/service">サービス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/basic">基本設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/hosts">監視対象設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/methods">監視パターン設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/summary">監視状況一覧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/mailbody">通知メール本文</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/snmptrap">SNMP Trapメール通知</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/user_notify">ユーザー定義通知</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/scan">監視対象一括登録</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/resource">リソース監視パターン設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/history">監視履歴確認</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/timeperiod">監視時間帯設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/map">監視マップ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/monitor/mainte">メンテナンス</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">リモート監視管理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi/rebooter_status">リブーター 状況一覧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi/rebooter_regist">リブーター 登録</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi/uriproxy">URIプロキシ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi/security">セキュリティ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/rmkanshi/sshconsole">SSHコンソール</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">リソース監視</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/mrtg_conf">リソース可視化設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/resource/mrtg_graph">グラフ表示</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">KVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/kvm/regist_setup">EasyBlocksゲストOS登録及びストレージサイズ変更</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/kvm/setting">EasyBlocksゲストOS設定変更</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/kvm/cockpit_other">管理画面機能(その他)</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">その他共通</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/dashboard">ダッシュボード</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">システム</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/basic">基本</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/webadmin">WEB管理者の登録削除</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/etc">その他(Syslog&amp;NetworkReporter用)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/mypage">マイページ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/filter">フィルタ開放</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/opensource">オープンソースライセンス</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/serial">シリアルナンバー</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ネットワーク</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/network">ネットワークの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/proxy">プロキシの設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/routing">ルーティング</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/netstat">状態</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/ddns_remote">ダイナミックDNS(RemoteOfficeのみ)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/hosts_append">ホスト追加</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/tagvlan">タグVLAN</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">メンテナンス</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/setting">設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/eb_update">システムの更新</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/eb_restert">停止・再起動</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/eb_support">サポート</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">AirManage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/eb_airmanage1">AirManage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/eb_airmanage2">AirManage登録</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">コマンドライン操作</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/ssh">SSHログイン</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/etc/console">シリアルコンソールログイン</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">仮想アプライアンス専用</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/virtual_install">仮想アプライアンス インストール方法(Network Reporterのみ)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/virtual/license">ライセンス(Network Reporter用)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/easyblocks/virtual/console">コマンド操作</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">AirManage遠隔監視</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/amdoc/amdoc_1">はじめに</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/amdoc/amdoc_2">初期設定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/amdoc/amdoc_3">運用(システム管理者向け)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/amdoc/amdoc_4">運用(テナント管理者向け)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/amdoc/amdoc_webapi">WebAPI</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">IDMシリーズ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/idm/rx1">OpenBlocks IDM RX1</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2Tub"></button></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">LUA言語拡張ハンドラ</h1></header><div class="markdown"><p>LUA言語は、C言語ベースのバイナリー実行モジュールに、高級言語スクリプト実行環境をアドオンできるシステムです。<br>
OpenBlocksのPD Handlerではシステムソフトウェアの主だった処理系がLUA言語から利用できる関数として用意されており、LUA言語スクリプトを用いて機能を拡張することができます。
例えばEnOceanデバイスの様にプロファイルがあれば、そのプロファイルによってバイナリーデータ列が規則化されているので、EnOceanコミュニティからプロファイルの仕様を手に入れれば、容易にデータを抽出しjsonテキスト化ができます。<br>
本章ではBLE(ビーコン型センサー)とEnOcean(EEP仕様)およびRS-232CやRS-485などのシリアル通信の機能拡張ハンドラの作成について解説しています。<br>
また、Luaを利用する前には、BLE/EnOcean/RS-SERIALなどの各ハンドラを前もって<a href="/docs/openblocks/fw5/service/iotdata#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E8%B5%B7%E5%8B%95%E5%88%B6%E5%BE%A1">モジュール起動制御</a>でアクティブにしておく必要があります。  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="luaソースコードの配置"></a>Luaソースコードの配置<a aria-hidden="true" class="hash-link" href="#luaソースコードの配置" title="Direct link to heading">#</a></h2><p>それぞれBLE/EnOcean/RS-SERIAL各ハンドラ毎にソースコードを下図例の通りディレクトリ分けして配置してあります。<br>
<img src="/assets/images/ble_lua_custom-df1ff9c8e77e8e1ec7a7d450fe9fd212.png"><br>
また、それぞれのLuaファイルはdevicesディレクトリとdevices_customディレクトリの二つの領域に区別し保存しています。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="devicesディレクトリ"></a>devicesディレクトリ<a aria-hidden="true" class="hash-link" href="#devicesディレクトリ" title="Direct link to heading">#</a></h5><p>ぷらっとホームから提供される標準対応センサー用のLuaファイルの保存領域です。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="devices_customディレクトリ"></a>devices_customディレクトリ<a aria-hidden="true" class="hash-link" href="#devices_customディレクトリ" title="Direct link to heading">#</a></h5><p>ユーザーが自分でカスタマイズしたLuaファイルを保存する領域です。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="funcディレクトリ"></a>funcディレクトリ<a aria-hidden="true" class="hash-link" href="#funcディレクトリ" title="Direct link to heading">#</a></h5><p>ぷらっとホームから提供される標準ユーティリティ関数のLuaファイルを保存する領域です。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="func_customディレクトリ"></a>func_customディレクトリ<a aria-hidden="true" class="hash-link" href="#func_customディレクトリ" title="Direct link to heading">#</a></h5><p>ユーザーが自分でカスタマイズしたユーティリティ関数のLuaファイルを保存する領域です。  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="標準サポートセンサーのluaファイルを手直して使う"></a>標準サポートセンサーのLuaファイルを手直して使う<a aria-hidden="true" class="hash-link" href="#標準サポートセンサーのluaファイルを手直して使う" title="Direct link to heading">#</a></h4><p>devicesディレクトリから標準の任意センサーのLuaソースコードをダウンロードして、改造した後にファイル名をそのまま変えずにdevices_customディレクトリへアップロードすれば、
標準のdevicesディレクトリあるLuaスクリプトよりも優先して実行(実際には上書)されます。<br>
クラウドに送信されるjsonメッセージは、<strong>jo.</strong>で始まるテーブルに例えばメンバを <strong>jo.temperature = 30</strong> とすることで <strong>{&quot;temperature&quot;:30}</strong> がjsonに追加されます。<br>
またはもともと<strong>jo.temperature = 30</strong>たっだのを<strong>jo.temp = 30</strong>とすれば出力は <strong>{&quot;temp&quot;:30}</strong> と変更されます。<br>
（ここで説明されているjson例は該当部分のみです。）  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="カスタムしたluaを有効にする"></a>カスタムしたLuaを有効にする<a aria-hidden="true" class="hash-link" href="#カスタムしたluaを有効にする" title="Direct link to heading">#</a></h5><p>Luaスクリプトを編集・作成後、Luaファイルを保存しただけではシステムに反映されません。<br>
このためプロセスの再起動が必要になります。<br>
プロセスの再起動は<a href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a>で行います。  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="ble-lua"></a>BLE Lua<a aria-hidden="true" class="hash-link" href="#ble-lua" title="Direct link to heading">#</a></h2><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="ble-接続で知っておくこと"></a>BLE 接続で知っておくこと<a aria-hidden="true" class="hash-link" href="#ble-接続で知っておくこと" title="Direct link to heading">#</a></h5><p>通常、BLEのアドバタイジングでセンサデータを受けるビーコン型センサーが、IoTシステムとして何年もの間に安定してデータを受信し続けられるために一般的に使われています。<br>
これはBLEデバイスがアドバタイズ(定期的に発するビーコン)によって一方的に送出してくる電波を、単に受信するだけの一方通行通信であるため、プロトコルを必要とせず安定しているためです。  </p><p>これに対してBLEコネクションモード(GATT通信とも呼ばれる)は、電波の状態に影響を受けやすいため非常に安定性が悪く、また、センサーメーカー毎のプロトコルの作りに互換性が無く、コネクション切断毎の処理系がマチマチでその復旧方法も曖昧でした。<br>
どちらかと言うとスマートフォンでデータを見たい時、一時的なコネクションで一気にデータを取り込むような使い方あれば多機能なコネクション型が向いていますが、IoTの様に24/365での接続を求めるシステム向きではありません。<br>
長時間接続するといつの間にかにコネクションが切れたり、BLEデバイスとホスト装置のステートが不一致になり、最悪、現場に設置してあるBLEデバイスの電源を入れなおさないと復帰できないようなケースもあります。<br>
こう言った現象はホスト側であれば再起動などでの復帰も可能ですが、BLEデバイスによっては電源を切るしか方法が無いものが多くあります。  </p><p>しかしIoTでも下流制御が必要な場合もあるため、この場合は、センサーの通常ステータスの取得は安定したアドバタイジングデータで受信をします。<br>
そして制御に必要になった場合にのみ、コネクションモードでBLEデバイスを制御し、制御が終わった時点で即ディスコネクトすることで、デッドロックリスクの高いコネクションモードでの接続を短時間で終わらせる事ができます。  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="bleのluaハンドラの関数構成"></a>BLEのLuaハンドラの関数構成<a aria-hidden="true" class="hash-link" href="#bleのluaハンドラの関数構成" title="Direct link to heading">#</a></h3><p>BLEのLuaハンドラは、1つのセンサーに1つのスクリプトが用意されています。
このスクリプトにはアドバタイジング用のビーコンハンドラと、コネクションモード用のGATT通信ハンドラが混載されており、各々に対応した関数で動作を分けています。<br>
Luaスクリプトは<a href="/docs/openblocks/fw5/service/basic#ble%E7%99%BB%E9%8C%B2">BLEのデバイス登録</a>の際、そのデバイス用のLuaハンドラーを各々選んで登録して下さい。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="parse_adv"></a>.parse_adv()<a aria-hidden="true" class="hash-link" href="#parse_adv" title="Direct link to heading">#</a></h5><p>アドバタイジング用関数は、センサーからのアドバタイジングを受けた時に呼ばれる関数です。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function &lt;makerneme&gt;_&lt;model&gt;.parse_adv(jo, manufacturerData, localname)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    アドバタイズからセンサデータをセンサデータをパースする関数です。通常はこちらを使用する。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;makerneme&gt;  特にUSERにわかれば何でも良いのですが、基本的な法則としてメーカ名を指定しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     &lt;model&gt;      基本的な法則としてモデル名としていますが、略称など分かり易い名前にしています。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="parse_beacon"></a>.parse_beacon()<a aria-hidden="true" class="hash-link" href="#parse_beacon" title="Direct link to heading">#</a></h5><p>ビーコン用関数はWEB-UIでビーコン指定(dataのプレフィックスで指定されるデバイス)されたアドバタイジングを受信した時に起動する関数です。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function &lt;makerneme&gt;_&lt;model&gt;.parse_beacon(jo, manufacturerData, localname)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ビーコンとして登録されたデバイスのセンサデータをパースする関数です。通常は使わない。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;makerneme&gt;  特にUSERにわかれば何でも良いのですが、基本的な法則としてメーカ名を指定しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;model&gt;      基本的な法則としてモデル名としていますが、略称など分かり易い名前にしています。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="gatt_exec"></a>.gatt_exec()<a aria-hidden="true" class="hash-link" href="#gatt_exec" title="Direct link to heading">#</a></h5><p>コネクションモード(GATT)用の関数は、WEB-UIで設定したシステムインターバルタイマーの間隔で起動されます。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function &lt;makerneme&gt;_&lt;model&gt;.gatt_exec(sensor, deviceId, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    GATTでBLEデバイスをアクセスするルーチンでWEB-UIで設定されたインターバルで呼び出される関数です。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;makerneme&gt;  特にUSERにわかれば何でも良いのですが、基本的な法則としてメーカ名を指定しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;model&gt;      基本的な法則としてモデル名としていますが、略称など分かり易い名前にしています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sensor   クラウドへの送信関数 LUA_send_sensor_data を呼ぶ時の第一引数としてそのまま使う。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        deviceId BLEデバイスのID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        infos    WEB-UIの固定情報付与(JSON)で設定された情報</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="downstream_exec"></a>.downstream_exec()<a aria-hidden="true" class="hash-link" href="#downstream_exec" title="Direct link to heading">#</a></h5><p>クラウド(上流)からの制御命令を受けた時に起動する関数は以下の通りです。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function &lt;makerneme&gt;_&lt;model&gt;.downstream_exec(sensor, deviceId, msg, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    上流（クラウド）から制御命令を受信した時に呼び出される関数です。（受信設定有効時のみ）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;makerneme&gt;  特にUSERにわかれば何でも良いのですが、基本的な法則としてメーカ名を指定しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;model&gt;      基本的な法則としてモデル名としていますが、略称など分かり易い名前にしています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sensor   クラウドへの送信関数 LUA_send_sensor_data を呼ぶ時の第一引数としてそのまま使う。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        deviceId BLEデバイスのID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        msg      上流から受信した制御メッセージ(json文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        infos    WEB-UIの固定情報付与(JSON)で設定された情報</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>その他、ユーザーが別の名前の関数を定義してサブルーチンを作ることは自由です。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="bleアドバタイジング対応のlua"></a>BLEアドバタイジング対応のLua<a aria-hidden="true" class="hash-link" href="#bleアドバタイジング対応のlua" title="Direct link to heading">#</a></h3><p>BLEデバイスが一方的にアドバタイジングによって送信してくるセンサーデータを受けるためのハンドラ作成について説明します。<br>
この例はビーコン用のハンドラの参考にもなります。</p><p>BLEハンドラはC言語部分とLUA言語部分で構成され、共通の部分をC言語で、カスタム部分をLua言語で記述する構成となっています。<br>
標準サポートのセンサーのLuaハンドラーは以下のディレクトリに保存されています。  </p><p><img src="/assets/images/ble_lua-885331518c8e1f90b2de7ab89b855267.png"></p><p>BLEから受信したアドバタイズのデータ部分であるペイロードには、デバイスメーカーが自由に使っていい領域があり、BLEハンドラではこのペイロード部分をLua言語に渡しています。  </p><p>OpenBlocksが起動後、PD HandlerがBLEビーコンを受信すると<a href="/docs/openblocks/fw5/service/basic#ble%E7%99%BB%E9%8C%B2">BLE登録</a>で登録されたデバイスのみ選別されWEB-UIで設定したLua関数に送り込まれます。<br>
ここでは<a href="https://www.nyc.co.jp/products/BCON/index_bcon.html" target="_blank" rel="noopener noreferrer">ナカヨ製ボタン付きBLEビーコン</a>のハンドラソースコードをサンプルに説明します。<br>
※このビーコンはiBeaconに互換です。<br>
※仕様変更もありえる詳細はナカヨ様の最新仕様書で確認して下さい。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="nakayo_nycbconlua"></a>NAKAYO_NYCBCON.lua<a aria-hidden="true" class="hash-link" href="#nakayo_nycbconlua" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAKAYO_NYCBCON = {}  -- 配列の初期化</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- iBeacon規格互換でナカヨビーコンのIDとなるマッチング変数の宣言</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nakayo_uuid = string.char(0xa9, 0x03, 0x01, 0x00, 0x14, 0x78, 0x48, 0x24, 0xb2, 0x98, 0x8e, 0x68, 0x23, 0xcf, 0xde, 0xfa)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nakayo_minor_normal = string.char(0xff, 0xe0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nakayo_minor_1 = string.char(0xff, 0xe8)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nakayo_minor_2 = string.char(0xff, 0xf0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nakayo_minor_3 = string.char(0xff, 0xf8)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- ハンドラのメインから順次呼び出される関数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- 引数 jo = jsonテキストに変換される連想配列、manufacturerData = バイナリデータ列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--      localname = BLE規格で設定される名前(付けられるかはメーカーによってまちまち)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function NAKAYO_NYCBCON.parse_adv(jo, manufacturerData, localname)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if is_ibeacon(manufacturerData) then                  -- 先ずiBeaconであるかチェック</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local uuid = string.sub(manufacturerData, 5, 20)  -- バイナリー列からUUID部取り込み</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local major = string.sub(manufacturerData, 21, 22)-- バイナリー列からmajor部取り込み</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local minor = string.sub(manufacturerData, 23, 24)-- バイナリー列からminor部取り込み</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if string.match(uuid, nakayo_uuid) ~= nil then    -- UUIDがマッチングするかチェック</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        pdHandlerUtil.log_debug(&quot;NAKAYO NYC-BCON&quot;)             -- デバッグログへUUIDなどを出力</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pdHandlerUtil.log_debug(&quot;uuid: &quot;..pdHandlerUtil.bin2str(uuid, #uuid))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pdHandlerUtil.log_debug(&quot;major: &quot;..pdHandlerUtil.bin2str(major, #major))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pdHandlerUtil.log_debug(&quot;minor: &quot;..pdHandlerUtil.bin2str(minor, #minor))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                jo.uuid = pdHandlerUtil.bin2str(uuid, #uuid)     -- jsonへ変換されるUUIDの保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                jo.major = pdHandlerUtil.bin2str(major, #major)  -- jsonへ変換されるmajorの保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                jo.minor = pdHandlerUtil.bin2str(minor, #minor)  -- jsonへ変換されるminorの保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if string.match(minor, nakayo_minor_normal) ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.push = 0   -- ボタンが押されていないステータスをjson変換される配列に保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                elseif string.match(minor, nakayo_minor_1) ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.push = 1   -- ボタンが押されたステータスをjson変換される配列に保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                elseif string.match(minor, nakayo_minor_2) ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.push = 2   -- ボタンが押されたステータスをjson変換される配列に保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                elseif string.match(minor, nakayo_minor_3) ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.push = 3   -- ボタンが押されたステータスをjson変換される配列に保存</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.push = -1  -- ボタンのステータスがおかしい時</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return NAKAYO_NYCBCON</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>ナカヨ製ボタン付きBLEビーコンは、ボタンを長押しするとjo.pushの値が &quot;1 → 2 → 3 → 1 → 2&quot; と変化します。<br>
BLEビーコンセンサにはiBeacon規格以外のもあるので、デバイスマッチングについては他のソースコードも参考にして下さい。<br>
以上のコードでIoTクラウドへ送信されるjsonテキストは以下の通りになります。  </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;time&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-12-08T12:34:56.789+09:00&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">     ← ここから</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">つがOpenBlocksで設定されるデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;deviceId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxxxxxxxxxxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;rssi&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">-68</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;uuid&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a903010014784824b2988e6823cfdefa&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ← ここから下がハンドラで追加されたデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;major&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;00c8&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;minor&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ffe0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;push&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>その他のセンサーのjsonテキストは<a href="/docs/openblocks/fw5/data_form/ble">こちらを参照</a>して下さい。<br>
それぞれのセンサ毎にLuaで書かれたソースコードがdevicesディレクトリにあります。</p><p>編集が終わったら、&lt;メーカー名&gt;_&lt;デバイス名&gt;.luaと名前を付けてdevices_customディレクトリにアップロードして下さい。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="gatt通信（双方向通信）"></a>GATT通信（双方向通信）<a aria-hidden="true" class="hash-link" href="#gatt通信（双方向通信）" title="Direct link to heading">#</a></h3><p>BLEはGATT通信を使う事で双方向通信となり下流デバイスの制御が可能となります。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="gattを使う上で理解しておくこと"></a>GATTを使う上で理解しておくこと<a aria-hidden="true" class="hash-link" href="#gattを使う上で理解しておくこと" title="Direct link to heading">#</a></h5><p>BLEを使ったIoT機器にはビーコンの様に、アドバタイジングと言うデータを垂れ流すだけの一方通行の通信方式が、動作安定性が高く一般的に使われている通信方法です。<br>
このアドバタイジングにセンサーデータを一緒に乗せてしまう事で複数の受信機でセンサーデータを得る事ができます。<br>
このアドバタイジングに対し通信プロトコルによって双方向のやり取りを行い、単一の受信機でセンサーなどのデータをやり取りする方式がGATT通信です。<br>
GATTは1対1接続でかつ暗号化などの機能を持つためセキュリティの高い通信ではありますが、BLEの使う通信帯域は非常に混雑しているためにエラーリトライが多発する不安定な要素も多々あります。<br>
このため秘匿する様なデータでは無く、また機器制御（下流制御）を必要の無い通信では、アドバタイジングモードでの通信を奨めてます。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="gatt通信の概要"></a>GATT通信の概要<a aria-hidden="true" class="hash-link" href="#gatt通信の概要" title="Direct link to heading">#</a></h5><p>GATT通信は<strong>とあるレジスタ</strong>に対して読み書きを行う事で通信を行います。<br>
この<strong>とあるレジスタ</strong>はUUIDという名前で管理されており、このレジスタは複数バイトの16進数を用いられて表現されています。<br>
このUUIDで表現されるレジスタは、デバイスによって複数バイトで構成されており、大体20Byte程度に収まる様な構成になっており、このUUIDの何バイト目で何ビット目の位置などで各々に意味を持たせています。</p><p>特定のBLEデバイスにアクセスするには、ホストとなる装置がscanと言う電波を送信すると、各々の応答可能なBLEデバイスが、アドバタイジング電波を送信します。<br>
ホストはこのアドバタイジング情報から任意のBLEデバイスを見つけてコネクション動作に入ります。<br>
コネクションに成功すると、接続されたBLEデバイスが持つUUIDのリストや接続ハンドル、通信パラメータをホストが得ます。<br>
GATT通信ではペアリングによって、特定のホストとの接続限定や暗号化する場合もあれば、ペアリングなしで接続できるデバイスもあります。
これらの情報交換も行われてコネクションが完了します。<br>
この状態から指定したUUIDに対して読み書きする事で通信が始まります。<br>
それぞれのUUIDには書き込み専用・読み込み専用・読み書き両用があるので各々のデバイスの仕様書で確認して下さい。<br>
そして通信が終わった時点で、ディスコネクトする事で一連の処理が完了します。  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="openblocksでのgattアクセス関数"></a>OpenBlocksでのGATTアクセス関数<a aria-hidden="true" class="hash-link" href="#openblocksでのgattアクセス関数" title="Direct link to heading">#</a></h4><p>OpenBlocksではGATTアクセスライブラリを用意しており、以下の手順通りライブラリで操作を行うことにより容易にGATT通信を可能にします。<br>
またライブラリの使用においてUUIDをhandleに置き換えてアクセスする方法を取っているので、これを混同しないように注意して下さい。<br>
このライブラリではUUIDとhandleが1対1で紐づけられています。</p><p>以下にGATTアクセスに用意されたLua関数を示します。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_gatt_connect"></a>LUA_gatt_connect()<a aria-hidden="true" class="hash-link" href="#lua_gatt_connect" title="Direct link to heading">#</a></h5><p>BlutoothデバイスアドレスdeviceIdにGATT接続します。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_gatt_connect(deviceId, type)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        deviceId(文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            接続するリモートのBluetoothデバイスアドレス</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type(文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            アドレスタイプ(“public”または”random”)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            デバイスのアクセス用デスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            接続に失敗した場合はnilが返る</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    注意</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        失敗の確率が高いためリトライする事を推奨。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_read"></a>LUA_ble_read()<a aria-hidden="true" class="hash-link" href="#lua_ble_read" title="Direct link to heading">#</a></h5><p>Bluetoothデバイスの指定したUUIDハンドルからデータを読み込みます。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_read(cli, handle)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()で取得したデバイスアクセス用デスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        handle(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            characteristicsのUUIDをアクセスするハンドル</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data(バイナリー)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            取得した値のバイト列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            失敗した場合はnilが返る</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_write"></a>LUA_ble_write()<a aria-hidden="true" class="hash-link" href="#lua_ble_write" title="Direct link to heading">#</a></h5><p>Bluetoothデバイスの指定したUUIDハンドルにデータを書き込みます。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_write(cli, handle, value)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()で取得したデバイスアクセス用デスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        handle(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            値を書くcharacteristics値のハンドル</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        value(バイナリー)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            書き込むバイナリーデータ列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        num(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            書いた値のバイト数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            失敗した場合はnilが返る</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_gatt_disconnect"></a>LUA_gatt_disconnect()<a aria-hidden="true" class="hash-link" href="#lua_gatt_disconnect" title="Direct link to heading">#</a></h5><p>BluetoothデバイスとのGATT接続を切断します。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()で取得したデバイスアクセス用デスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="gatt通信の応用のuartサービスとインターバルによる自発的なデータ送信関数"></a>GATT通信の応用のUARTサービスとインターバルによる自発的なデータ送信関数<a aria-hidden="true" class="hash-link" href="#gatt通信の応用のuartサービスとインターバルによる自発的なデータ送信関数" title="Direct link to heading">#</a></h4><p>BLEデバイスによっては、UUIDを受信専用のものと送信専用のものと分けて実装し、データ転送を20Byte程度の単位に抑えて少しずつ転送を行い一般のシリアル通信の様な動作機能を持つデバイスがあります。<br>
ホストはこういったデバイスを相手にする時、特定のUUIDを受信ポート・送信ポートと見立ててシリアル通信を行う事が必要があります。  </p><p>もう一つは、BLEデバイスが自分のインターバルタイマによって定期的にデータを送信してくる機能への対応です。<br>
例えば1分毎に消費電力を通知させるような場合に使います。  </p><p>OpenBlocksのGATTライブラリでは、こういった動作もサポートできるように作られています。<br>
なお、これらの関数は、前記、LUA_gatt_connect、LUA_gatt_disconnect、と一緒に利用します。
以下がBLEデバイスの自発的な通知を制御する関数です。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_register_notify"></a>LUA_ble_register_notify()<a aria-hidden="true" class="hash-link" href="#lua_ble_register_notify" title="Direct link to heading">#</a></h5><p>BLEデバイスの自発的な通知を有効にします。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_register_notify(cli, handle)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()の戻り値で取得したデバイスアクセス用ディスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        handle(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            通知を有効にするcharacteristics値のハンドル</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            有効にした通知の登録ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            失敗した場合はnilが返る</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_notify_show"></a>LUA_ble_notify_show()<a aria-hidden="true" class="hash-link" href="#lua_ble_notify_show" title="Direct link to heading">#</a></h5><p>BLEデバイスからの通知されたデータを取得します。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_notify_show(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()の戻り値で取得したデバイスアクセス用ディスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data(文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            取得した値のバイト列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            失敗した場合はnilが返る</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_unregister_notify"></a>LUA_ble_unregister_notify()<a aria-hidden="true" class="hash-link" href="#lua_ble_unregister_notify" title="Direct link to heading">#</a></h5><p>BLEデバイスの自発的な通知を無効にします。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_unregister_notify(cli, id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cli(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_connect()の戻り値で取得したデバイスアクセス用ディスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_ble_register_notify()の戻り値で取得した通知の登録ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            無効にした通知の登録ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            失敗した場合はnilが返る</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="bleハンドラ用のユーティリティ関数"></a>BLEハンドラ用のユーティリティ関数<a aria-hidden="true" class="hash-link" href="#bleハンドラ用のユーティリティ関数" title="Direct link to heading">#</a></h4><p>その他ユーティリティ関数です。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_send_sensor_data"></a>LUA_send_sensor_data()<a aria-hidden="true" class="hash-link" href="#lua_send_sensor_data" title="Direct link to heading">#</a></h5><p>データをクラウド（上流）へ送信します。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_send_sensor_data(sensor, data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sensor(ユーザーデータ)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            xxxxx_xxxxxx.gatt_exec()関数またはxxxxx_xxxxxx.downstream_exec()関数で渡された引数をそのまま渡す。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data(文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            送信するjson文字列のデータ（必ず文字列としてエンコードする）</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_getcrc8"></a>LUA_ble_getcrc8()<a aria-hidden="true" class="hash-link" href="#lua_ble_getcrc8" title="Direct link to heading">#</a></h5><p>CRC8を取得する（UARTサービスなどで必要な場合に使う）</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_getcrc8(payload)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        payload(文字列)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            CRC8を取得する値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        crc8(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            取得したCRC8</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_sleep"></a>LUA_ble_sleep()<a aria-hidden="true" class="hash-link" href="#lua_ble_sleep" title="Direct link to heading">#</a></h5><p>プロセスをスリープする（秒単位）</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_sleep(sec)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sec(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            スリープする秒数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_ble_usleep"></a>LUA_ble_usleep()<a aria-hidden="true" class="hash-link" href="#lua_ble_usleep" title="Direct link to heading">#</a></h5><p>プロセスをスリープする（マイクロ秒単位）</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_ble_usleep(usec)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        usec(数値)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            スリープするマイクロ秒数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="gatt通信のluaハンドラーサンプル"></a>GATT通信のLuaハンドラーサンプル<a aria-hidden="true" class="hash-link" href="#gatt通信のluaハンドラーサンプル" title="Direct link to heading">#</a></h4><p>このサンプルではセンサーデータのパースを行っていないので、パースについては他のセンサーハンドラを参考にして下さい。
このサンプルはdevices_customディレクトリの skelton.lua です。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="skeltonlua"></a>skelton.lua<a aria-hidden="true" class="hash-link" href="#skeltonlua" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    skelton = {} -- ハンドラーのテーブル宣言</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- definition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local write_uuid = &quot;01234567-89ab-cdef-0123-456789abcdef&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local read_uuid  = &quot;0123456f-89ab-cdef-0123-456789abcdef&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- WEB-UIでビーコン登録されたアドバタイズデータのパーサー</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- （例えばビーコンの電池残量をアドバタイズデータからパースしたい時に使用）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.parse_beacon(jo, manufacturerData, localname)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;skelton.parse_beacon&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if #manufacturerData == 0 then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.send = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- このサンプルでデータのペイロードをそのまま16進文字列に変換しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- 通常はこの中でセンサーデータなど&quot;jo.&quot;の任意のメンバーにパースして代入します。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local str = pdHandlerUtil.bin2str(manufacturerData, #manufacturerData)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if str ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                jo.manufacturerData = str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- WEB-UIでビーコンセンサー登録されたアドバタイズデータのパーサー</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- （通常はビーコンセンサーのデータをパースする場合こちらを使用）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.parse_adv(jo, manufacturerData, localname)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;skelton.parse_adv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if #manufacturerData == 0 then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.send = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- このサンプルでデータのペイロードをそのまま16進文字列に変換しています。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- 通常はこの中でセンサーデータなど&quot;jo.&quot;の任意のメンバーにパースして代入します。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local str = pdHandlerUtil.bin2str(manufacturerData, #manufacturerData)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if str ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                jo.manufacturerData = str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- GATTでアクセスするセンサーで使用する関数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- （WEB-UIで設定されたインターバルタイマーで定期的に呼び出される関数）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.gatt_exec(sensor, deviceId, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;skelton.gatt_exec&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local jo = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.deviceId = deviceId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.time = pdHandlerUtil.get_current_time()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        add_infos(jo, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- connect and get handle table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local cli, handle_table = LUA_gatt_connect(deviceId, &quot;random&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if cli == nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_gatt_connect&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- read 単純に任意のUUIDを読み込む時</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local read_value = LUA_ble_read(cli, handle_table[read_uuid])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if read_value == nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_ble_read&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.read_value = read_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- BLEデバイスの自発送信を有効にする場合</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local id = LUA_ble_register_notify(cli, handle_table[read_uuid])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if id == nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_ble_register_notify&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_ble_sleep(10) -- モード設定したら少し待つ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- BLEデバイスの自発送信のデータを読み込む</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local notify_data = LUA_ble_notify_show(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if notify_data == nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- 自発送信なので送信されていない時もある</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_ble_notify_show&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- 自発送信データがバッファにあった場合</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.notify_data = notify_data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- BLEデバイスの自発送信を有効にした場合は使用後に無効にする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_ble_unregister_notify(cli, id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- 一連の処理が終わったらディスコネクトする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- 取り込んだデータをクラウド(上流)に送信する</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_send_sensor_data(sensor, json.encode(jo))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- クラウド(上流)からの制御命令を受信した時起動する関数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.downstream_exec(sensor, deviceId, msg, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;skelton.downstream_exec&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local jo = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.deviceId = deviceId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.time = pdHandlerUtil.get_current_time()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        add_infos(jo, infos)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.result = &quot;error&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- connect</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local cli, handle_table = LUA_gatt_connect(deviceId, &quot;random&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if cli == nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_gatt_connect&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_send_sensor_data(sensor, json.encode(jo))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- 受信したクラウド(上流)からのメッセージを連想配列にデコードする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local upstream_data = json.decode(msg)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local write_data = upstream_data.data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- 受信したデータ部分をBLEデバイスに送る</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if nil == LUA_ble_write(cli, handle_table[write_uuid], write_data) then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_err(&quot;failed: LUA_ble_write&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_send_sensor_data(sensor, json.encode(jo))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_info(&quot;succeeded: LUA_ble_write&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.result = &quot;success&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- GATTをディスコネクト</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_gatt_disconnect(cli)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- クラウド(上流)にレスポンスする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_send_sensor_data(sensor, json.encode(jo))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return skelton</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="アップロードダウンロード操作"></a>アップロード/ダウンロード操作<a aria-hidden="true" class="hash-link" href="#アップロードダウンロード操作" title="Direct link to heading">#</a></h3><p>作成したLuaハンドラのアップロードや、参考にするLuaハンドラのダウンロード操作は以下の通りです。  </p><p><img src="/assets/images/ble_lua_custom-df1ff9c8e77e8e1ec7a7d450fe9fd212.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="ble-lua-メニューの操作項目"></a>BLE Lua メニューの操作項目<a aria-hidden="true" class="hash-link" href="#ble-lua-メニューの操作項目" title="Direct link to heading">#</a></h4><table><thead><tr><th>設定項目</th><th>説明</th></tr></thead><tbody><tr><td>更新</td><td>Luaファイルのアップロード先のファイル一覧表示を更新します。</td></tr><tr><td>削除</td><td>ファイルを選択後<code>削除</code>ボタンで削除します。<br>削除可能なファイルはカスタム用ディレクトリ配下のファイルです。</td></tr><tr><td>ダウンロード</td><td>ファイルを選択後<code>ダウンロード</code>ボタンでクライアントパソコンのダウンロードフォルダにファイルをダウンロードします。</td></tr><tr><td>実行権付与</td><td>ファイルを選択後<code>実行権付与</code>ボタンで実行権を付与します。通常では不要です。</td></tr><tr><td>アップロード先</td><td>アップロードしたいディレクトリをプルダウンから選択して下さい。<br>※対象ディレクトリ配下がプルダウン対象です。</td></tr><tr><td>アップロード</td><td><code>ファイルを選択</code>ボタンを押すと、クライアントパソコンのファイル一覧から指定のファイルを選択してアップロードできます。<sup>*1</sup></td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>アップロード後にプロセスの再起動が必要なので、<a href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a>から停止・起動の操作を行って下さい。</li></ol></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>アップロード先にLuaファイル以外が存在している場合には正常に動作しません。<br>
Luaファイル以外を置かないで下さい。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="enocean-lua"></a>EnOcean Lua<a aria-hidden="true" class="hash-link" href="#enocean-lua" title="Direct link to heading">#</a></h2><p>EnOceanはEEP(EnOcean Equipment Profile)というプロファイルでデバイスが定義されています。<br>
また一部のGP(Generic Profile)のデバイスについても対応していますが、Tech-inデータを用いない為EEPデバイスと同様にGPから始まるプロファイルを使用します。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="enocean登録とlua関数の関係"></a>EnOcean登録とLua関数の関係<a aria-hidden="true" class="hash-link" href="#enocean登録とlua関数の関係" title="Direct link to heading">#</a></h3><p>EnOceanデバイスはBLE機器に比べプロファイルと言う形式をとっているため、データ形式が規格化されているため扱い易いです。<br>
デバイス毎のハンドラは以下の通り、devicesディレクトリにプロファイル名でLuaハンドラが登録されています。<br>
<strong>IoTデータ⇒EnOcean Lua</strong>タブの操作画面の以下のディレクトリです。  </p><p><img src="/assets/images/enocean_lua-b15532067bde45bee6df88f043f4e136.png"></p><p>EnOceanを受信登録するする時は<a href="/docs/openblocks/fw5/service/basic#enocean">EnOcean登録</a>で<strong>デバイスID</strong>と<strong>EEP</strong>の登録が必須です。  </p><p>ここで登録されたEEPあわせて、devicesディレクトリに登録されたLuaハンドラーの中から該当するハンドラーが選択され実行します。<br>
※EnOceanハンドラはBLEハンドラとは違ってLuaを呼ばれた時点でデバイスのプロファイルが決定しています。  </p><p>ユーザースクリプトは以下のdevices_customディレクトリに保存するので、ここに置いてある&quot;skelton.lua&quot;をダウンロードして、テンプレートにすると良いです。  </p><p><img src="/assets/images/enocean_lua_custom-6159416e747a91c40e3191be77297ab2.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="skeltonlua-1"></a>skelton.lua<a aria-hidden="true" class="hash-link" href="#skeltonlua-1" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    skelton = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.skelton_decode(jo, data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;skelton&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        str = pdHandlerUtil.bin2str(data, #data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_info(&quot;str: &quot;, str)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if str ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo.data = str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return skelton</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>登録したいEEPは次のようなデバイスのものです。  </p><table><thead><tr><th>EnOceanアライアンスのEEP仕様書から A50205</th></tr></thead><tbody><tr><td><img src="/assets/images/eep_spec_sample-d80641af3d1d01c498be0d42e7d1b299.png"></td></tr></tbody></table><p>最初に&quot;skelton&quot;文字列をデバイスのEEPに置換します。<br>
かつ、クラウド送信用のjo配列のメンバーにtemperatureを追加しtemperatureｎ値を計算し代入します。<br>
※元のskeltonは受け取ったデータをそのまま16進テキスト文字列でjsonで送るものです。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="skeltonlua（編集後"></a>skelton.lua（編集後)<a aria-hidden="true" class="hash-link" href="#skeltonlua（編集後" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    A50205 = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function A50205.A50205_decode(jo, data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local temperature = string.byte(data, 3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_debug(&quot;A50205&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        temperature = (255 - temperature) * 40 / 255 -- 仕様書の計算式のまま</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pdHandlerUtil.log_info(&quot; temperature: &quot;, temperature)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.temperature = temperature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return A50205</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>以上のコードでIoTクラウド送信用のjsonテキストは以下の様になります。  </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;deviceId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxxxxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;time&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2016-03-14T16:17:02.269+09:00&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;temperature&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">25.41176470</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  ← ここだけハンドラで追加されたデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;EEP&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A50701&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;memo&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;temperature Sensor&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;rssi&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">-71</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>その他のセンサーのjsonテキストは<a href="/docs/openblocks/fw5/data_form/enocean">こちらを参照</a>して下さい。  </p><p>編集が終わったら、&lt;プロファイル名&gt;.luaと名前を付けてdevices_customディレクトリにアップロードして下さい。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="アップロードダウンロード操作-1"></a>アップロード/ダウンロード操作<a aria-hidden="true" class="hash-link" href="#アップロードダウンロード操作-1" title="Direct link to heading">#</a></h3><p>作成したLuaハンドラのアップロードや、参考にするLuaハンドラのダウンロード操作は以下の通りです。  </p><p><img src="/assets/images/enocean_lua-b15532067bde45bee6df88f043f4e136.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="enocean-lua-メニューの操作項目"></a>EnOcean Lua メニューの操作項目<a aria-hidden="true" class="hash-link" href="#enocean-lua-メニューの操作項目" title="Direct link to heading">#</a></h4><table><thead><tr><th>設定項目</th><th>説明</th></tr></thead><tbody><tr><td>更新</td><td>Luaファイルのアップロード先のファイル一覧表示を更新します。</td></tr><tr><td>削除</td><td>ファイルを選択後<code>削除</code>ボタンで削除します。<br>削除可能なファイルはカスタム用ディレクトリ配下のファイルです。</td></tr><tr><td>ダウンロード</td><td>ファイルを選択後<code>ダウンロード</code>ボタンでクライアントパソコンのダウンロードフォルダにファイルをダウンロードします。</td></tr><tr><td>実行権付与</td><td>ファイルを選択後<code>実行権付与</code>ボタンで実行権を付与します。通常では不要です。</td></tr><tr><td>アップロード先</td><td>アップロードしたいディレクトリをプルダウンから選択して下さい。<br>※対象ディレクトリ配下がプルダウン対象です。</td></tr><tr><td>アップロード</td><td><code>ファイルを選択</code>ボタンを押すと、クライアントパソコンのファイル一覧から指定のファイルを選択してアップロードできます。<sup>*1</sup></td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>アップロード後にプロセスの再起動が必要なので、<a href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a>から停止・起動の操作を行って下さい。</li></ol></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>アップロード先にLuaファイル以外が存在している場合には正常に動作しません。<br>
そのため、ファイル内容については skelton.lua を参考に作成して下さい。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="標準登録センサーのluaハンドラ編集"></a>標準登録センサーのLuaハンドラ編集<a aria-hidden="true" class="hash-link" href="#標準登録センサーのluaハンドラ編集" title="Direct link to heading">#</a></h3><p>例えば&quot;EEP:A50205&quot;と言うセンサーでクラウドに送信するキー名&quot;temperature&quot;となっているのを&quot;temp&quot;と変更したい場合、&quot;devices&quot;ディレクトリから&quot;a50205.lua&quot;というファイルをダウンロードします。   </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="a50205lua"></a>a50205.lua<a aria-hidden="true" class="hash-link" href="#a50205lua" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    a50205 = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function a50205.a50205_decode(jo, data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local temperature = pdHandlerUtil.round((255 - string.byte(data, 3)) * 40 / 255, 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.temperature = temperature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return a50205</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>この行   </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.temperature = temperature</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>を   </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jo.temp = temperature</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>に変更します。<br>
そして変更したファイルを&quot;devices_custom&quot;ディレクトリにファイル名を変更せずに&quot;a50205.lua&quot;と言う名前のままアップロードして下さい。<br>
この作業だけでオリジナルの送信データを作成できます。  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="新規センサーのluaハンドラ作成"></a>新規センサーのLuaハンドラ作成<a aria-hidden="true" class="hash-link" href="#新規センサーのluaハンドラ作成" title="Direct link to heading">#</a></h3><p>未サポートのデバイスのハンドラを新規に追加する時は、&quot;devices_custom&quot;ディレクトリに&quot;skelton.lua&quot;というファイルが置いてあるので、このファイルをテンプレートとして使って下さい。<br>
このファイルの中の&quot;skelton&quot;と言う部分をEEPプロファイル名に変更して使います。
上記の&quot;EEP:A50205&quot;のソースコードが参考になると思います。<br>
あとはxxxxxx.xxxxxx_decode関数の中にバイナリデータからの変換ルーチンを用意するだけです。<br>
完成したら<em>EEPプロファイル名.lua</em>というファイル名で&quot;devices_custom&quot;ディレクトリにアップロードして下さい。<br>
なお、&quot;skelton.lua&quot;テンプレートにあるxxxxxx.xxxxxx_decode関数内のルーチン  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="skeltonskelton_decode"></a>skelton.skelton_decode()<a aria-hidden="true" class="hash-link" href="#skeltonskelton_decode" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function skelton.skelton_decode(jo, data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_debug(&quot;skelton&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            str = pdHandlerUtil.bin2str(data, #data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            pdHandlerUtil.log_info(&quot;str: &quot;, str)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if str ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    jo.data = str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>は、バイナリデータをそのまま16進数ASCII文字列に変えているだけなので、変換ルーチンを別途用意する場合は全て不要になります。  </p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ファームウェア 1.x、2.x は、Lua に対応しておりません。<br>
EEPタイプとGPタイプに対応しています。<br>
EEPタイプはプロファイルコードで検索して下さい。<br>
GPタイプはEEPの欄に&quot;GP&quot;から始まるプロファイル名を入力します。(GP_xxxx)<br>
GPセンサーはファームウェア 4.xからのサポートになります。  </p></div></div><span id="serial-lua"></span><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-serial-lua"></a>RS-SERIAL Lua<a aria-hidden="true" class="hash-link" href="#rs-serial-lua" title="Direct link to heading">#</a></h2><p>PD Handler RS-SERIALでは、対向のシリアルデバイス(RS-232C/RS-485など)向けに処理内容をフルカスタムできるユーザー定義ハンドラです。<br>
<strong>IoTデータ⇒SERIAL Lua</strong>タブから、カスタマイズしたLuaファイルをアップロードし使用します。  </p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ul><li>デフォルトでインストールされているrs-serial.luaはサンプルとなります。このファイルを参考に編集して下さい。</li><li>PD Handler RS-SERIALは指定したLuaファイルを読み込み、LUA_main関数を実行します。</li><li>PD Handler RS-SERIALはPD Repeaterへのアクセスするパスのデバイス名部をLuaファイル内にて定義しています。そのため、環境に合わせてLuaファイルを編集する必要があります。</li></ul></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Luaファイルが不正(フォーマットエラーやシンタックスエラー等)の場合エラー終了となるので、ログを確認して下さい。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-serial-lua-のカスタマイズ（シリアルポート側）"></a>RS-SERIAL Lua のカスタマイズ（シリアルポート側）<a aria-hidden="true" class="hash-link" href="#rs-serial-lua-のカスタマイズ（シリアルポート側）" title="Direct link to heading">#</a></h3><p>基本的には一般の高級言語でシリアルインターフェース機器との通信全般を書くのと違いがありません。<br>
※実際にはシリアル通信にこだわらずLuaだけで汎用的なアプリケーションもここで作れてしまいます。</p><p>システムの単純な流れとしては  </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> シリアルポートのオープン  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ↓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 速度などの通信パラメータ設定  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ↓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> データ送受信  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ↓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> シリアルポートのクローズ  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>この作り方になりますが、OpenBlocks上ではデーモンとして起動するので、シリアルポートのクローズはSTOPシグナルが入った時となるので、データ送受信部分で無限ループする作りになります。</p><p><img src="/assets/images/SERIAL_Lua-608d598efd973be53dd5cf28805183f3.png"></p><p>このディレクトリにあるrs-serial.luaをテンプレートとしてダウンロードしてから編集して使って下さい。<br>
※利用開始前には<a href="/docs/openblocks/fw5/service/iotdata#module">モジュール設定</a>でPD Handler RS-Serialの起動を忘れずに！</p><p>以下はrs-serial.luaのデフォルトソースコードです。<br>
OpenBlocksとパソコンをRS-232Cクロスケーブルで接続しテストを行って下さい。<br>
動作はパソコン側でTeraTermなどを使ってOpenBlocksと接続しキーボード入力するとその文字をエコーバックします。<br>
そして&quot;who?&quot;と入力すると&quot;I am openblocks&quot;と返事し、&quot;exit!&quot;と入力すると&quot;!!!!!! STOPING prcess !!!!!&quot;と返事してからプロセスを停止します。<br>
※本番用デーモンとして起動する時は無限ループを抜ける仕組みがない方が良いです。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-seriallua_org"></a>rs-serial.lua_org<a aria-hidden="true" class="hash-link" href="#rs-seriallua_org" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_err(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (3, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_info(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (6, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_debug(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (7, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LUA_main(void)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LOG_info(&quot;start rs-serial\n&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- シリアルポートのオープン（RS485の時は&quot;/dev/ttyMFD1&quot;の部分を&quot;/dev/ttyRS485&quot;に変更）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fd = LUA_open_serial(&quot;/dev/ttyMFD1&quot;, 9600, 8, 1, false, false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (0 &gt; fd) then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LOG_err(&quot;serial port open error\n&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- メインループ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local read_buff = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local read_size = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        while (1) do -- フォアグランドモードの場合、無限ループはCTRL-Cでも止まります。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            local rbuff, rsize -- ローカル変数宣言</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            rbuff, rsize = LUA_read_serial(fd) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            read_buff = read_buff .. rbuff -- 前にシリアル入力された文字列に今回分を連結</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            read_size = read_size + rsize  -- 同上</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            -- データを受信した</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if rsize &gt; 0 then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                LUA_send_serial(fd, rbuff, rsize)  -- 入力文字のエコーバック</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if nil ~= string.find(read_buff, &quot;exit!&quot;) then -- 終了文字列の検索(exit!)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local res_str = &quot;\n\r!!!!!! STOPING prcess !!!!!\n\r&quot; -- レスポンス文字列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local res_len = string.len(res_str)  -- レスポンス文字列の長さ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    LUA_send_serial(fd, res_str, res_len)  -- シリアルポートにレスポンスを送信</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    break; -- exit!で無限ループを抜ける</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           --  ※デーモン動作の時は無限ループから抜けないようにする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if nil ~= string.find(read_buff, &quot;who%?&quot;) then -- 文字列検索（who?）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local res_str = &quot;\n\rI am openblocks\n\r&quot; -- レスポンス文字列</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local res_len = string.len(res_str)  -- レスポンス文字列の長さ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    LUA_send_serial(fd, res_str, res_len)  -- シリアルポートにレスポンスを送信</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    read_buff = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            read_buff = string.sub(read_buff, -10) -- 最後に入力された10文字だけ残して捨てる</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            read_size = string.len(read_buff)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_usleep (50000)  -- 50msec程度スリープを入れとくと他の処理が軽くなります。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- シリアルポートのクローズ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_close_serial(fd)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LOG_info(&quot;stop rs-serial\n&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>これは非常に簡単なプログラムで、もう少し色々試したい時はsample.luaを一度ダウンロードでして別名のluaのファイル名でアップロードして下さい。<br>
IoTクラウド(PD Repeater)への送信サンプルなども用意されていますので参考にして下さい。  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-serial-lua-のカスタマイズ（クラウドとの通信側）"></a>RS-SERIAL Lua のカスタマイズ（クラウドとの通信側）<a aria-hidden="true" class="hash-link" href="#rs-serial-lua-のカスタマイズ（クラウドとの通信側）" title="Direct link to heading">#</a></h3><p>もともとはシリアルポート側の処理系と一緒のソースコードとして作成しますが、わかりやすく解説するためにクラウド側の処理を分けて説明します。<br>
以下は簡単なサンプルです。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="クラウドとの通信側"></a>クラウドとの通信側<a aria-hidden="true" class="hash-link" href="#クラウドとの通信側" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_info(message) -- ログ出力用関数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (6, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local device_number = &quot;userdev_0000001&quot;  -- WEB-UIでユーザー定義したデバイス。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LUA_main(void)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local uds_fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local rbuff</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        uds_fd = LUA_open_udomain(device_number) -- 待ち受けのユニックスドメインソケット</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (1 &gt; uds_fd) then  -- 戻り値0でオープンエラー</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LOG_err(&quot;unix domain server open error\n&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- メインループ ※基本的にはポーリング処理です。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        while (1) do -- 無限ループはCTRL-Cでも止まります。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            rbuff = LUA_read_udomain(uds_fd)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if (#rbuff &gt; 0) then -- rbuff にメッセージ到着</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -- 通常 rbuff 内の下流制御メッセージをデコードして実行する</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                -- ここでは PD-Handler のログへプリントしてクラウドへエコーバックする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                LOG_info(rbuff)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                LUA_post (device_number, rbuff) -- クラウドから受けたjsonをそのままエコーバック</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_usleep(1000000) -- 1秒スリープ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_close_udomain(uds_fd) -- 使い終わったらクローズ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-serial-lua-で-device-shadow-を使う"></a>RS-SERIAL Lua で Device Shadow を使う<a aria-hidden="true" class="hash-link" href="#rs-serial-lua-で-device-shadow-を使う" title="Direct link to heading">#</a></h3><p>AWS IoTのDevice Shadowはクラウド上に仮想化したステートマシンを配置し、エッジ側の装置はそのステートマシンの状態を常に同期する仕組みを取ります。<br>
例えば<strong>SwitchA</strong>がクラウド上のステートマシンで定義され、それが<strong>on</strong>になれば、エッジ側のマシンの<strong>SwitchA</strong>は<strong>on</strong>のステータスへ移行します。<br>
また、エッジ側の<strong>SwitchA</strong>が何らかのエッジ処理によって<strong>off</strong>とされた場合、クラウド上のステートマシンに対して<strong>SwitchA</strong>は<strong>off</strong>になったステータスを通知します。<br>
さらにエッジ側の自己処理でステータスが変わった場合もエッジ側が自発的にそのステータス変化を通知します。</p><p>こう言った一連の処理をMQTTプロトコルによって行います。<br>
このAWS IoTのDevice Shadowの仮想ステートマシンは全てjson文字列で記述されています。  </p><p>jsonで記述されたステートマシンの基本構造（参考例）</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ...    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;reported&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ... </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ↓ ここから下はDeviceShadowシステムがトピックに応じてメタ情報を書き込みます。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>上記の形式で&#x27;...&#x27;の部分がユーザー定義部分です。
このユーザー定義の部分の使い方は自由ですが、基本的な操作の流れはクラウド(操作する側)から<strong>desired</strong>のメンバーでエッジデバイスに操作要求を送り、エッジデバイス(操作される側)が<strong>reported</strong>のメンバでその結果をDeviceShadowに送ります。<br>
例えばDeviceShadow仮想ステートマシンの状態が</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;reported&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>の所へクラウドから以下のjsonメッセージをDeviceShadowへパブリッシュすると</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>DeviceShadow仮想ステートマシンは</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;reported&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>と、このようになり、この変化がDeviceShadow配下のトピックにその状態変化を通知するメタ情報がパブリッシュされます。<br>
OpenBlocksのPD Repeaterでは、このトピックの全てをサブスクライブしているため、すべてのメタ情報が取り込まれ読み出すことができます。  </p><p>実際のDeviceShadowはこの状態変化が起こると、<strong>documents</strong>,<strong>delta</strong>,<strong>accepted</strong>の3つのトピックにパブリッシュしてきます。<br>
基本的にはどのトピックを参照しても現在のステータスを得ることができますが、エッジ処理では<strong>delta</strong>トピックの内容を参照すると、その状態変化が容易にわかります。<br>
<strong>delta</strong>トピックは<strong>desired</strong>と<strong>reported</strong>のメンバーの差分をパブリッシュしてくるので次の様になります。  </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ↓ ここから下はDeviceShadowシステムがトピックに応じてメタ情報を書き込みます。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>このようにステータスに変異のあったメンバのみ通知されるので、この変異に同期するようにエッジ側の処理を実行します。<br>
ここでは<strong>SwitchA</strong>を<strong>on</strong>にするためのエッジ処理を実行します。<br>
エッジ処理を実行して実際の<strong>SwitchA</strong>を<strong>on</strong>した後は、クラウドにそのリポートを通知します。  </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;reported&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>以上のようにクラウドにパブリッシュして処理の完了となります。<br>
DeviceShadowはこの変異に対して同じように<strong>documents</strong>,<strong>delta</strong>,<strong>accepted</strong>の3つのトピックにパブリッシュしてきます。<br>
これに対してもOpenBlocksはメッセージを受け取ることができますが、自発のレポートの変異であるためこのメッセージは無視します。  </p><p>最終的にクラウドの仮想ステートマシンの状態は以下の通りとなります。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;reported&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchB&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;off&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>仮想ステートマシンの特定のメンバを消すときには次の様にパブリッシュします。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;SwitchA&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token null keyword" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>仮想ステートマシンの<strong>desired</strong>全部を消す場合は次の様にパブリッシュします。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;state&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;desired&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token null keyword" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="luaスクリプトの実際"></a>Luaスクリプトの実際<a aria-hidden="true" class="hash-link" href="#luaスクリプトの実際" title="Direct link to heading">#</a></h4><p>以下のLuaスクリプトは上記の手順を追ったものです。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="device-shadow-を扱う-lua-スクリプト"></a>Device Shadow を扱う Lua スクリプト<a aria-hidden="true" class="hash-link" href="#device-shadow-を扱う-lua-スクリプト" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    package.cpath = package.cpath .. &#x27;;&#x27; .. &quot;/opt/pd/lua/util/luarocks/lib/lua/5.3/?.so;&quot;      -- cjsonなど置いている場所</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    package.cpath = package.cpath .. &#x27;;&#x27; .. &quot;/opt/pd/lua/util/luarocks/share/lua/5.3/?/?.lua;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json = require &quot;cjson&quot;                -- jsonのエンコーダーデコーダーライブラリのLoad</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DeviceShadow = require &quot;DeviceShadow&quot; -- DeviceShadowアクセスライブラリのLoad</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_err(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (3, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_info(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (6, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LOG_debug(message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_sys_log (7, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local device_number = &quot;userdev_0000001&quot;  -- WEB-UIでユーザー定義したデバイス。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function LUA_main(void)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local uds_fd -- ファイルデスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        local jo     -- json文字列をデコードしたあとに保存される連想配列テーブル</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        uds_fd = LUA_open_udomain(device_number) -- 待ち受けのユニックスドメインソケット</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (1 &gt; uds_fd) then  -- 戻り値0でオープンエラー</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LOG_err(&quot;unix domain server open error\n&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- メインループ ※基本的にはポーリング処理です。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        while (1) do -- 無限ループはCTRL-Cでも止まります。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            jo = DeviceShadow.receive(uds_fd)    -- DeviceShadowのステータス変異を受け取る</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if nil ~= jo then    -- ステータス変異を受信</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if jo.type == &quot;delta&quot; then -- deltaトピックだけ受け付ける</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    if jo.data ~= nil then -- 有効なペイロードがある場合</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        if jo.data.state.desired.SwitchA ~= nil then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            local rep = {} -- クラウドにレポートを送るための連想配列テーブル</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            jo.data.state.desired.SwitchA == &quot;on&quot; then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                -- ここへSwitchAをonするルーチンを入れる</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                rep.state.reported.SwitchA == &quot;on&quot;    -- reportedへ変更後のステータスを入れておく</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                -- ここへSwitchAをoffするルーチンを入れる</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                rep.state.reported.SwitchA == &quot;off&quot;   -- reportedへ変更後のステータスを入れておく</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            -- rep.state.desired = json.null &lt;&lt; クラウドの&quot;desired&quot;の中身を全部消したい場合</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            DeviceShadow.update(uds_fd, rep)   -- DeviceShadowへレポートする</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_usleep(1000000) -- 1秒スリープ（適当に！）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LUA_close_udomain(uds_fd) -- 使い終わったらクローズ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rs485半二重通信での注意点"></a>RS485半二重通信での注意点<a aria-hidden="true" class="hash-link" href="#rs485半二重通信での注意点" title="Direct link to heading">#</a></h3><p>RS485の場合、送信線と受信線を共有して４ワイヤ(実質２ワイヤでも通信可能)の半二重接続が主流の使い方になっています。<br>
ここでよく問題となるのは、送信と受信を切り替えるタイミングで発生するデータ化け問題です。<br>
例えば通信フレームに対してのエラーチェックでCRCを付与している時やパリティチェックしている時など、この切替の微妙なタイミングでエラーを発生します。<br>
これを通信回路で発生するノイズと勘違いされている方が非常に多いです。  </p><p><img src="/assets/images/485txrx-7a3e400c935b3c27f4f56ae9ab60aec6.png"></p><p>この図で示される切替のタイミングはプライマリが送信側としてセカンダリが受信機側としている場合、プライマリが送信終わって送受信を切り替えても即時切り替わるわけではなく多少の遅延が発生します。<br>
このため、低いボーレートでは気にならなかった送受信線の切替が、高いボーレートではセカンダリのデバイスがデータを受けきらないタイミングで切り替わってしまい、データが化けるという現象が起こってしまいます。<br>
この逆のパターンでは、セカンダリデバイスが送信し始めたタイミングをうまく検出できなくて、データ化けが起こるケースもあります。<br>
これはデバイスがRS485半二重に対応したLSIを採用している場合にはデータ化けの無い通信が可能ですが、元々全二重のRS232Cの回路をRS485半二重にハードウェアロジックなどでコンバートした回路を採用しているデバイスにはこの切替の遅延が発生します。<br>
(旧版のOpenBlocks IoT EX1やBXシリーズも対象になります。)<br>
この場合には通信速度を遅くすることで対処も可能ですが、ソフトウェア的に解決するには、RS485に流すデータのフレームの前後にダミーデータを置く方法があります。  </p><p>ダミーデータ付与の例</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">元となるデータペイロード</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        1234567890</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ダミーを付けたデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ･･･S1234567890CCE･･･ &lt; Sはスタートコード Eはエンドコード CはCRCデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    xxxxooooooooooooxxxx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">xxxx部分のデータは無視してSの次のデータからEの前のoとc部分データを有効として使いCC部分でエラーチェック</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">･･･のダミーデータは0xaaや0x55などを使うことを推奨。  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>こういった感じのプロトコルで有効部分のデータの最後にCRCを付けて転送します。<br>
受信側はダミー部分を捨てて有効部分のデータのみ使います。<br>
また、スタートコードやエンドコードは1バイトの場合、使用制限が付きやすいので2バイトでスタート・エンドコードを設定するやり方が一般的です。  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rs-serialのlua用関数"></a>RS-SERIALのLua用関数<a aria-hidden="true" class="hash-link" href="#rs-serialのlua用関数" title="Direct link to heading">#</a></h3><p>以下はOpenBlocksのLua言語用に実装している関数です。<br>
sample.luaではこれら関数を一通り使っているので参考にして下さい。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_open_serial"></a>LUA_open_serial()<a aria-hidden="true" class="hash-link" href="#lua_open_serial" title="Direct link to heading">#</a></h5><p>シリアルポートを指定の通信パラメータでオープンする。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_open_serial (devfile, speed, databit, stopbit, enable_parity, odd_parity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        devfile (string)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            対象のシリアルポートのデバイスファイル名を設定(例:&quot;/dev/ttyMFD1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        speed (int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            シリアルポートの通信速度を指定(110～921600の範囲で14400はサポート外)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        databit (int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            データのビット長(5～8 範囲外の値は8とする)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        stopbit (int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ストップビット長(1 or 2、2以外は全部1とする)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        enable_parity (bool)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            パリティを有効にする(true or false )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        odd_parity (bool)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enable_parityがtrueの時にこの設定が有効になる。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            trueの時、奇数パリティになる。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            falseの時、偶数パリティになる。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ファイルデスクリプタ(int)、オープン失敗時 マイナス値</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_close_serial"></a>LUA_close_serial()<a aria-hidden="true" class="hash-link" href="#lua_close_serial" title="Direct link to heading">#</a></h5><p>シリアルポートをクローズする。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_close_serial (fd)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fd (int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            シリアルポートオープン時のファイルデスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値　無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_send_serial"></a>LUA_send_serial()<a aria-hidden="true" class="hash-link" href="#lua_send_serial" title="Direct link to heading">#</a></h5><p>シリアルポートからバイナリーデータを送信する。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_send_serial (fd, buffer, size)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ファイルデスクリプタ(int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        buffer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            送信するバイナリーデータ(data ※ポインタではなく実体)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ※送信データにNULL(0)などのバイナリーも含む事ができます。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            バイナリデータの長さ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        送信できたバイト数</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_read_serial"></a>LUA_read_serial()<a aria-hidden="true" class="hash-link" href="#lua_read_serial" title="Direct link to heading">#</a></h5><p>シリアルポートからバイナリーデータを受信する。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_read_serial (fd, buffer, size)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ファイルデスクリプタ(int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値１</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        バイナリーデータ列の実体(NULLを含むがLUAではstring型)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ※受信データにNULL(0)などのバイナリーも含む事ができます。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値２</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        バイナリデータの長さ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        データが無い時 0 ※C言語内では -1(使いにくいので0に置き換え)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_post"></a>LUA_post()<a aria-hidden="true" class="hash-link" href="#lua_post" title="Direct link to heading">#</a></h5><p>ユニックスドメインソケット経由で PD Repeater にメッセージを送信する。<br>
PD Repeater はそのメッセージをWEB-UIの設定に従いクラウドへ送信する。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_post (device_number, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        device_number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            openblocksので確保したソケットの名前(string)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ソケットはWEB-UIにある 基本＞Userデバイス登録 タブで登録された</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            デバイス番号を使う。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            一般的にはjsonの文字列を指定するが、文字列であれば何でもかまわない。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_open_udomain"></a>LUA_open_udomain()<a aria-hidden="true" class="hash-link" href="#lua_open_udomain" title="Direct link to heading">#</a></h5><p>ユニックスドメインソケットの待ち受けサーバーを起動する。<br>
PD Repeater はWEB-UIの設定に従いクラウドからの下流制御メッセージを受け取り、
このコマンドでオープンされたユニックスドメインソケットにjsonメッセージを送信する。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_open_udomain(device_number)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        device_number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            openblocksので確保したソケットの名前(string)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ソケットはWEB-UIにある 基本＞Userデバイス登録 タブで登録された</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            デバイス番号を使う。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ファイルデスクリプタ(int) 戻り値が0の時はオープンエラー</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_read_udomain"></a>LUA_read_udomain()<a aria-hidden="true" class="hash-link" href="#lua_read_udomain" title="Direct link to heading">#</a></h5><p>ユニックスドメインソケットの待ち受けからメッセージを受け取る。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_read_udomain(uds_fd)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        uds_fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_open_udomain関数で得たファイルディスクリプタ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        受信バッファデータ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    注意：</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        送信元のデータが長い場合、1回のreadで読み切れない場合があるので</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        受信バッファデータが空になるまで読み込む。</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_close_udomain"></a>LUA_close_udomain()<a aria-hidden="true" class="hash-link" href="#lua_close_udomain" title="Direct link to heading">#</a></h5><p>ユニックスドメインソケットの待ち受けをクローズする。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_close_udomain(uds_fd)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        uds_fd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LUA_open_udomain関数で得たファイルディスクリプタ</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_dump_byte"></a>LUA_dump_byte()<a aria-hidden="true" class="hash-link" href="#lua_dump_byte" title="Direct link to heading">#</a></h5><p>バイナリーのバイト列をダンプする。（デバッグメッセージとして出力）<br>
※デバッグのために用意された関数です。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_dump_byte (buffer, size)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        buffer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ダンプするバイナリーデータ(data ※ポインタではなく実体)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ダンプするバイナリデータの長さ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_usleep"></a>LUA_usleep()<a aria-hidden="true" class="hash-link" href="#lua_usleep" title="Direct link to heading">#</a></h5><p>プロセスを指定の時間停止させる。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_usleep (microsec)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        microsec(int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            マイクロ秒単位で停止させる時間を設定。(互換性のためなるべく1000000未満(1秒)を設定)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_sleep"></a>LUA_sleep()<a aria-hidden="true" class="hash-link" href="#lua_sleep" title="Direct link to heading">#</a></h5><p>プロセスを指定の時間停止させる。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_sleep (sec)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        microsec(int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            秒単位で停止させる時間を設定。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        無し</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_sys_log"></a>LUA_sys_log()<a aria-hidden="true" class="hash-link" href="#lua_sys_log" title="Direct link to heading">#</a></h5><p>シスログにメッセージを送る。フォアグランドでは標準出力も一緒に行われる。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_sys_log (level, message)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        level(int)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ログのレベル。(0～7) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        message(string)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            出力されるメッセージ。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ※printf的に使う場合 string.format関数 を使います。(サンプル参照)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="lua_get_iso_datetime"></a>LUA_get_iso_datetime()<a aria-hidden="true" class="hash-link" href="#lua_get_iso_datetime" title="Direct link to heading">#</a></h5><p>IoTクラウドに基本的に用いられるISO8601形式の日付時間を得ます。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LUA_get_iso_datetime (order_msec)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    引数</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        order_msec(bool)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            時間をミリ秒単位まで欲しい時trueにします。それ以外はfalse</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    戻り値</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ISO8601形式の日付時間文字列</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="アップロードダウンロード操作-2"></a>アップロード/ダウンロード操作<a aria-hidden="true" class="hash-link" href="#アップロードダウンロード操作-2" title="Direct link to heading">#</a></h3><p>SERIAL Luaのスクリプトファイルは<strong>IoTデータ⇒SERIAL Lua</strong>タブの操作画面からアップロードやダウンロードすることができます。 </p><p><img src="/assets/images/SERIAL_Lua-608d598efd973be53dd5cf28805183f3.png"></p><table><thead><tr><th>設定項目</th><th>説明</th></tr></thead><tbody><tr><td>更新</td><td>Luaファイルのアップロード先のファイル一覧表示を更新します。</td></tr><tr><td>削除</td><td>ファイルを選択後<code>削除</code>ボタンで削除します。</td></tr><tr><td>ダウンロード</td><td>ファイルを選択後<code>ダウンロード</code>ボタンでクライアントパソコンのダウンロードフォルダにファイルをダウンロードします。</td></tr><tr><td>実行権付与</td><td>ファイルを選択後<code>実行権付与</code>ボタンで実行権を付与します。通常では不要です。</td></tr><tr><td>アップロード</td><td><code>ファイルを選択</code>ボタンを押すと、クライアントパソコンのファイル一覧から指定のファイルを選択してアップロードできます。<sup>*1</sup></td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>アップロード後に、プロセスの再起動が必要となります。</li><li>別名のファイルでアップロード指定した場合、<strong>IoTデータ⇒モジュール設定</strong>タブのPD Handler RS-SERIALの<strong>指定Luaファイル</strong>にて使用するLuaファイルを変更して下さい。</li></ol></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="bルートlua"></a>BルートLua<a aria-hidden="true" class="hash-link" href="#bルートlua" title="Direct link to heading">#</a></h2><p>低圧・高圧スマートメーター用のLuaハンドラのファイルです。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="アップロードダウンロード操作-3"></a>アップロード/ダウンロード操作<a aria-hidden="true" class="hash-link" href="#アップロードダウンロード操作-3" title="Direct link to heading">#</a></h3><p>作成したLuaハンドラのアップロードや、参考にするLuaハンドラのダウンロード操作は以下の通りです。  </p><p><img src="/assets/images/broute_lua-306bee8d3e371a61a13f1296bbb3460e.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="bルートlua-メニューの操作項目"></a>BルートLua メニューの操作項目<a aria-hidden="true" class="hash-link" href="#bルートlua-メニューの操作項目" title="Direct link to heading">#</a></h4><table><thead><tr><th>設定項目</th><th>説明</th></tr></thead><tbody><tr><td>更新</td><td>Luaファイルのアップロード先のファイル一覧表示を更新します。</td></tr><tr><td>削除</td><td>ファイルを選択後<code>削除</code>ボタンで削除します。<br>削除可能なファイルはカスタム用ディレクトリ配下のファイルです。</td></tr><tr><td>ダウンロード</td><td>ファイルを選択後<code>ダウンロード</code>ボタンでクライアントパソコンのダウンロードフォルダにファイルをダウンロードします。</td></tr><tr><td>実行権付与</td><td>ファイルを選択後<code>実行権付与</code>ボタンで実行権を付与します。通常では不要です。</td></tr><tr><td>アップロード先</td><td>アップロードしたいディレクトリをプルダウンから選択して下さい。<br> 対象ディレクトリ配下がプルダウン対象です。<br> パスの最初のディレクトリが以下の場合、各対応するハンドラの配置場所となります。 <ul> <li>bidirec_hvsmc : 双方向対応高圧スマートメーター対応ハンドラ(PD Handler Bidirection HVSMC)用配置場所</li> <li>hvsmc : 高圧スマートメーター対応ハンドラ(PD Handler HVSMC)用配置場所</li> <li>lvsmc : 低圧スマートメーター対応ハンドラ(PD Handler LVSMC)用配置場所</li> </ul></td></tr><tr><td>アップロード</td><td><code>ファイルを選択</code>ボタンを押すと、クライアントパソコンのファイル一覧から指定のファイルを選択してアップロードできます。<sup>*1</sup></td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>アップロード後にプロセスの再起動が必要なので、<a href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a>から停止・起動の操作を行って下さい。</li></ol></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>アップロード先にLuaファイル以外が存在している場合には正常に動作しません。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="hvsmc-lua"></a>HVSMC Lua<a aria-hidden="true" class="hash-link" href="#hvsmc-lua" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>FW5.0.5までのタブとなります。FW5.0.6からはBルートLuaタブへ統合されております。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="アップロードダウンロード操作-4"></a>アップロード/ダウンロード操作<a aria-hidden="true" class="hash-link" href="#アップロードダウンロード操作-4" title="Direct link to heading">#</a></h3><p>作成したLuaハンドラのアップロードや、参考にするLuaハンドラのダウンロード操作は以下の通りです。</p><p><img src="/assets/images/hvsmc_lua-17c2699316125756ae30d17316ab7cd3.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="hvsmc-lua-メニューの操作項目"></a>HVSMC Lua メニューの操作項目<a aria-hidden="true" class="hash-link" href="#hvsmc-lua-メニューの操作項目" title="Direct link to heading">#</a></h4><table><thead><tr><th>設定項目</th><th>説明</th></tr></thead><tbody><tr><td>更新</td><td>Luaファイルのアップロード先のファイル一覧表示を更新します。</td></tr><tr><td>削除</td><td>ファイルを選択後<code>削除</code>ボタンで削除します。<br>削除可能なファイルはカスタム用ディレクトリ配下のファイルです。</td></tr><tr><td>ダウンロード</td><td>ファイルを選択後<code>ダウンロード</code>ボタンでクライアントパソコンのダウンロードフォルダにファイルをダウンロードします。</td></tr><tr><td>実行権付与</td><td>ファイルを選択後<code>実行権付与</code>ボタンで実行権を付与します。通常では不要です。</td></tr><tr><td>アップロード先</td><td>アップロードしたいディレクトリをプルダウンから選択して下さい。<br> 対象ディレクトリ配下がプルダウン対象です。</td></tr><tr><td>アップロード</td><td><code>ファイルを選択</code>ボタンを押すと、クライアントパソコンのファイル一覧から指定のファイルを選択してアップロードできます。<sup>*1</sup></td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>アップロード後にプロセスの再起動が必要なので、<a href="/docs/openblocks/fw5/webui/reference/dashboard">ダッシュボード</a>から停止・起動の操作を行って下さい。</li></ol></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>アップロード先にLuaファイル以外が存在している場合には正常に動作しません。</p></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/openblocks/fw5/data_handling/pd_broker"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« PD Broker</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/openblocks/fw5/data_handling/adjust"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PDHMSの調整 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#luaソースコードの配置" class="table-of-contents__link">Luaソースコードの配置</a></li><li><a href="#ble-lua" class="table-of-contents__link">BLE Lua</a><ul><li><a href="#bleのluaハンドラの関数構成" class="table-of-contents__link">BLEのLuaハンドラの関数構成</a></li><li><a href="#bleアドバタイジング対応のlua" class="table-of-contents__link">BLEアドバタイジング対応のLua</a></li><li><a href="#gatt通信（双方向通信）" class="table-of-contents__link">GATT通信（双方向通信）</a></li><li><a href="#アップロードダウンロード操作" class="table-of-contents__link">アップロード/ダウンロード操作</a></li></ul></li><li><a href="#enocean-lua" class="table-of-contents__link">EnOcean Lua</a><ul><li><a href="#enocean登録とlua関数の関係" class="table-of-contents__link">EnOcean登録とLua関数の関係</a></li><li><a href="#アップロードダウンロード操作-1" class="table-of-contents__link">アップロード/ダウンロード操作</a></li><li><a href="#標準登録センサーのluaハンドラ編集" class="table-of-contents__link">標準登録センサーのLuaハンドラ編集</a></li><li><a href="#新規センサーのluaハンドラ作成" class="table-of-contents__link">新規センサーのLuaハンドラ作成</a></li></ul></li><li><a href="#rs-serial-lua" class="table-of-contents__link">RS-SERIAL Lua</a><ul><li><a href="#rs-serial-lua-のカスタマイズ（シリアルポート側）" class="table-of-contents__link">RS-SERIAL Lua のカスタマイズ（シリアルポート側）</a></li><li><a href="#rs-serial-lua-のカスタマイズ（クラウドとの通信側）" class="table-of-contents__link">RS-SERIAL Lua のカスタマイズ（クラウドとの通信側）</a></li><li><a href="#rs-serial-lua-で-device-shadow-を使う" class="table-of-contents__link">RS-SERIAL Lua で Device Shadow を使う</a></li><li><a href="#rs485半二重通信での注意点" class="table-of-contents__link">RS485半二重通信での注意点</a></li><li><a href="#rs-serialのlua用関数" class="table-of-contents__link">RS-SERIALのLua用関数</a></li><li><a href="#アップロードダウンロード操作-2" class="table-of-contents__link">アップロード/ダウンロード操作</a></li></ul></li><li><a href="#bルートlua" class="table-of-contents__link">BルートLua</a><ul><li><a href="#アップロードダウンロード操作-3" class="table-of-contents__link">アップロード/ダウンロード操作</a></li></ul></li><li><a href="#hvsmc-lua" class="table-of-contents__link">HVSMC Lua</a><ul><li><a href="#アップロードダウンロード操作-4" class="table-of-contents__link">アップロード/ダウンロード操作</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">製品情報</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks-iot/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks IoT</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks - MicroServer</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/easyblocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">EasyBlocksシリーズ</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/airmanage2/" target="_blank" rel="noopener noreferrer" class="footer__link-item">AirManage2</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks-idm/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks IDMシリーズ</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">SNS</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://x.com/openblocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">X - OpenBlocks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">サポート</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.plathome.co.jp/contact/" target="_blank" rel="noopener noreferrer" class="footer__link-item">お問い合わせ</a></li><li class="footer__item"><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQ</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 - 2025 Plat'Home Co., Ltd. All rights reserved.</div></div></div></footer></div>
<script src="/styles.c6d5988d.js"></script>
<script src="/runtime~main.3c6ecc41.js"></script>
<script src="/main.40f297ea.js"></script>
<script src="/1.7d91b6d9.js"></script>
<script src="/1a4e3797.96891e2b.js"></script>
<script src="/1be78505.6b22e6e7.js"></script>
<script src="/c4f5d8e4.e3deaf6d.js"></script>
<script src="/423.bf325f44.js"></script>
<script src="/422.7c8e2ca8.js"></script>
<script src="/935f2afb.c062de1d.js"></script>
<script src="/421.015e3d13.js"></script>
<script src="/3b8484a0.3bb861b3.js"></script>
</body>
</html>