<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<title data-react-helmet="true">PD Agent for AWS IoT | ぷらっとホームどきゅめんと</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="PD Agent for AWS IoT | ぷらっとホームどきゅめんと"><meta data-react-helmet="true" name="description" content="OpenBlocksに用いているIoTゲートウェイソフトウェア「FW5」のデータハンドリング設定リファレンスガイドに関するドキュメントの「PD Agent for AWS IoT」のページです。"><meta data-react-helmet="true" property="og:description" content="OpenBlocksに用いているIoTゲートウェイソフトウェア「FW5」のデータハンドリング設定リファレンスガイドに関するドキュメントの「PD Agent for AWS IoT」のページです。"><meta data-react-helmet="true" name="keywords" content="IoT,Data Handling,PD Agent for AWS IoT,agent,awsiot,reference"><meta data-react-helmet="true" property="og:url" content="https://docs.plathome.co.jp/docs/openblocks/fw5/data_handling_ref/pd_agent_awsiot"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.plathome.co.jp/docs/openblocks/fw5/data_handling_ref/pd_agent_awsiot"><link rel="stylesheet" href="/styles.6a7f28c3.css">
<link rel="preload" href="/styles.7630729b.js" as="script">
<link rel="preload" href="/runtime~main.184c6265.js" as="script">
<link rel="preload" href="/main.bebca1b1.js" as="script">
<link rel="preload" href="/1.fd206da0.js" as="script">
<link rel="preload" href="/1a4e3797.dac89970.js" as="script">
<link rel="preload" href="/1be78505.a916c989.js" as="script">
<link rel="preload" href="/c4f5d8e4.99b25c1c.js" as="script">
<link rel="preload" href="/367.b4e7bc0d.js" as="script">
<link rel="preload" href="/366.bfc2d4a0.js" as="script">
<link rel="preload" href="/935f2afb.c5e3a9d9.js" as="script">
<link rel="preload" href="/365.c7c3a2cd.js" as="script">
<link rel="preload" href="/b6a09d5b.b550137e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_3046 navbarHidden_1Uo_"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">ぷらっとホームどきゅめんと</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a target="_self" rel="noopener noreferrer" class="navbar__item navbar__link" href="/search/">検索</a></div><div class="navbar__items navbar__items--right"><a href="https://www.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">会社トップ</a><a href="https://www.plathome.co.jp/support/topix-software-update/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">アップデート情報</a><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">FAQ</a><a href="https://blog.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">ブログ</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search searchBarContainer_1-U_"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_18Th searchBarLoadingRing_zYFK"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo_plathome_white.png" alt="ぷらっとホーム" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">ぷらっとホームどきゅめんと</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a target="_self" rel="noopener noreferrer" class="menu__link" href="/search/">検索</a></li><li class="menu__list-item"><a href="https://www.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="menu__link">会社トップ</a></li><li class="menu__list-item"><a href="https://www.plathome.co.jp/support/topix-software-update/" target="_blank" rel="noopener noreferrer" class="menu__link">アップデート情報</a></li><li class="menu__list-item"><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="menu__link">FAQ</a></li><li class="menu__list-item"><a href="https://blog.plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="menu__link">ブログ</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">PD Agent for AWS IoT</h1></header><div class="markdown"><span id="path"></span><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="デフォルトパス"></a>デフォルトパス<a aria-hidden="true" class="hash-link" href="#デフォルトパス" title="Direct link to heading">#</a></h2><p>PD agent for AWS IoT に関連するファイルのデフォルトパスは次の通りです。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="pd-agent-for-aws-iot-に関連するファイルのデフォルトパス"></a>PD agent for AWS IoT に関連するファイルのデフォルトパス<a aria-hidden="true" class="hash-link" href="#pd-agent-for-aws-iot-に関連するファイルのデフォルトパス" title="Direct link to heading">#</a></h4><table><thead><tr><th>パス名</th><th>説明</th></tr></thead><tbody><tr><td>/usr/sbin/pd_agent_awsiot</td><td>常駐実行オブジェクト（デーモン）</td></tr><tr><td>/lib/systemd/system/pd_agent_awsiot.service</td><td>Systemd Service ファイル</td></tr><tr><td>/etc/init.d/pd_agent_awsiot</td><td>RC ファイル</td></tr><tr><td>/var/webui/config/pd_agent_awsiot.conf</td><td>設定ファイル</td></tr><tr><td>/var/run/pd_agent_awsiot.pid</td><td>PID ファイル</td></tr></tbody></table><span id="conf"></span><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="設定ファイルの書式"></a>設定ファイルの書式<a aria-hidden="true" class="hash-link" href="#設定ファイルの書式" title="Direct link to heading">#</a></h2><span id="syntax"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="構文"></a>構文<a aria-hidden="true" class="hash-link" href="#構文" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json:pd_agent_awsiot.conf codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;enable&quot;: &lt;bool値&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;res_memory&quot;: &lt;常駐メモリの増加分の上限値&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;debug&quot;: &lt;デバッグレベル&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;buffer_size&quot;: &lt;バッファサイズ&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;things&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;Thing Name&gt;&quot;: {    /* Thing オブジェクト */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;enable&quot;: &lt;bool値&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;localname&quot;: &quot;&lt;デバイス番号&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;bind&quot;: &quot;&lt;受信ソケット名&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;push_to&quot;: &quot;&lt;送信先ソケット名&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;prefix&quot;: &quot;&lt;リポートを受け取るソケット名のプレフィックス&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;timeout&quot;: &lt;クラウドからの応答待ち時間&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;interval&quot;: &lt;メッセージ間の待ち時間&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;idel&quot;: &lt;&#x27;state&#x27;オブジェクトを再取得する間隔&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;shadows&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;&lt;Shadow Name&gt;&quot;: {    /* Shadow オブジェクト */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;enable&quot;: &lt;bool値&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;script&quot;: &quot;&lt;実行オブジェクト&gt; &lt;引数&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;function&quot;: &quot;&lt;Lua言語スクリプトの関数名&gt;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;timeout&quot;: &lt;リポートの待ち時間&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;behalf&quot;: &lt;bool値&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;Shadow オブジェクト&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;Thing オブジェクト&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><span id="root_obj"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="root-オブジェクト"></a>Root オブジェクト<a aria-hidden="true" class="hash-link" href="#root-オブジェクト" title="Direct link to heading">#</a></h3><table><thead><tr><th>キー</th><th>データ型</th><th>説明</th></tr></thead><tbody><tr><td>enable</td><td>論理値</td><td>デフォルト値は false.</td></tr><tr><td>res_memory</td><td>整数値</td><td>常駐メモリの増加分の上限値(Mbyte). 上限を越えると基幹プロセスを再起動する. デフォルト値は16.</td></tr><tr><td>debug</td><td>整数値</td><td>デバックレベル 0 ～ 4. デフォルト値は0.</td></tr><tr><td>buffer_size</td><td>整数値</td><td>ペイロードのバッファサイズ(byte). デフォルト値は 4096.</td></tr><tr><td>things</td><td>JSON obj</td><td>Thing を定義するThing オブジェクトの並び. 32 個まで指定可能.</td></tr></tbody></table><span id="thing_obj"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="thing-オブジェクト"></a>Thing オブジェクト<a aria-hidden="true" class="hash-link" href="#thing-オブジェクト" title="Direct link to heading">#</a></h3><table><thead><tr><th>キー</th><th>データ型</th><th>説明</th></tr></thead><tbody><tr><td>&lt;JSON Key&gt;</td><td>文字列</td><td>Device Shadow の Thing name.</td></tr><tr><td>enable</td><td>論理値</td><td>デフォルト値は false.</td></tr><tr><td>localname</td><td>文字列</td><td>デバイスのローカル名(デバイス番号). (32byte)</td></tr><tr><td>bind</td><td>文字列</td><td>制御メッセージを受け取るソケット名. 文字列の先頭が &#x27;@&#x27; の場合は abstract　namespace と解釈する. 空の場合は、デフォルト値 &#x27;@/pd_handler/&lt;localname&gt;.sock&#x27; が設定される.</td></tr><tr><td>push_to</td><td>文字列</td><td>応答メッセージの送り先ソケット名. 文字列の先頭が &#x27;@&#x27; の場合は abstract　namespace と解釈する. 空の場合は、デフォルト値 &#x27;@/pd_repeater/&lt;localname&gt;.sock&#x27; が設定される.</td></tr><tr><td>prefix</td><td>文字列</td><td>デバイスから&#x27;reported&#x27; オブジェクト文字列を受け取るソケット名のプレフィックス. 文字列の先頭が&#x27;@&#x27; の場合は abstract namespace と解釈する. デフォルト値は &#x27;@/pd_agent_awsiot/&lt;localname&gt;&#x27;. なお、ソケット名は Shadow オブジェクトに定義する Shadow name を加えて &#x27;&lt;prefix&gt;/&lt;sadow name&gt;.sock&#x27; となる.</td></tr><tr><td>timeout</td><td>整数値</td><td>&#x27;update&#x27; 又は &#x27;get&#x27; メッセージに対する応答の待ち時間(sec). タイムアウトの場合、メッセージを再送する. デフォルト値は 30.</td></tr><tr><td>interval</td><td>整数値</td><td>&#x27;update/delta&#x27;, &#x27;update/documents&#x27;, &#x27;update/accepted&#x27; のメッセージ間の待ち時間(sec). タイムアウトの場合はアイドル状態に戻る. デフォルト値は 5.</td></tr><tr><td>idel</td><td>整数値</td><td>&#x27;get&#x27; メッセージを送り&#x27;state&#x27; オブジェクトを再取得する間隔(sec). 0 の場合は、再取得を行わない. デフォルト値は 0.</td></tr><tr><td>shadows</td><td>JSON obj</td><td>Shadow を定義するShadow オブジェクトの並び. 32 個まで指定可能.</td></tr></tbody></table><span id="shadow_obj"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="shadow-オブジェクト"></a>Shadow オブジェクト<a aria-hidden="true" class="hash-link" href="#shadow-オブジェクト" title="Direct link to heading">#</a></h3><table><thead><tr><th>キー</th><th>データ型</th><th>説明</th></tr></thead><tbody><tr><td>&lt;JSON Key&gt;</td><td>文字列</td><td>Device Shadow の Shadow name.</td></tr><tr><td>enable</td><td>論理値</td><td>デフォルト値は false.</td></tr><tr><td>script</td><td>文字列</td><td>実行オブェクトもしくは Dynamic Link モジュール又はLua 言語スクリプトのパス名. ファイル記述子が.so の場合は Dynamic Link モジュール、.lua の場合はLua 言語スクリプト、それ以外の場合は実行オブェクトと見なされる. 実行オブェクトについては引数の記載が可能.</td></tr><tr><td>function</td><td>文字列</td><td>実行される Lua 言語スクリプト内の関数名.</td></tr><tr><td>behalf</td><td>論理値</td><td>&#x27;reported&#x27; オブジェクトを&#x27;delta&#x27; オブジェクトで更新し、実行オブェクトもしくは Dynamic Link モジュール又は Lua 言語スクリプトの戻り値と置き換える. デフォルト値は false.</td></tr><tr><td>timeout</td><td>整数値</td><td>実行オブェクトについて Unix ドメインソケット入力の戻り値を待つ時間 (sec). タイムアウトの場合は、実行オブェクトを再実行する. なお、&#x27;behalf&#x27; が true の場合は戻り値を待たない.</td></tr></tbody></table><span id="exec_obj"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="実行オブジェクト"></a>実行オブジェクト<a aria-hidden="true" class="hash-link" href="#実行オブジェクト" title="Direct link to heading">#</a></h3><p>実行オブジェクト(シェルスクリプト) のサンプルコードを示します。</p><p>実行オブジェクトはShadow オブジェクトの&#x27;script&#x27; に設定され、execv() によって実行されます。<br>
Shadow オブジェクトの&#x27;script&#x27; には、execv() に渡される引数も設定することが可能です。<br>
Thing name, Shadow name と&#x27;desired&#x27;, &#x27;reported&#x27;, &#x27;delta&#x27; の各オブジェクトはexecv() の引数ではなく環境変数($thingName, $shadowName, $desired, $reported, $delta) で与えられます。<br>
PD Agent for AWS IoT に対する戻り値(&#x27;update&#x27; メッセージでDevice Shadow に送る&#x27;reported&#x27;オブジェクト) は、socat やnetcat などを用いて、Things オブジェクトの&#x27;prefix&#x27; に設定される文字
列とShadow name から構成されるUnix ドメインソケット( &#x27;&lt;prefix&gt;/&lt;sadow name&gt;.sock&#x27;) へ書き込みます。<br>
Shadow オブジェクトの&#x27;behalf&#x27; をtrue に設定している場合は、戻り値を返す必要はありません。
本サンプルコードは、/usr/share/pdhms/agent＿awsiot/example.sh としてインストールされています。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="examplesh"></a>example.sh<a aria-hidden="true" class="hash-link" href="#examplesh" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-shell:example.sh codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The following environment variables are inherited from PD Agent for AWS IoT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># thingName, shadowName, desired, reported, delta</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">file=/tmp/example_sh.txt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">socket=/pd_agent_awsiot/userdev_000000${1}/${shadowName}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo ${thingName}&#x27;/&#x27;${shadowName}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &#x27;desired:&#x27; ${desired}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &#x27;reported:&#x27; ${reported}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &#x27;delta:&#x27; ${delta}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} &gt;&gt; ${file}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">echo -n ${desired} | socat stdin abstract-connect:/pd_repeater/userdev_0000001.sock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><span id="dlm"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dynamic-link-モジュール"></a>Dynamic Link モジュール<a aria-hidden="true" class="hash-link" href="#dynamic-link-モジュール" title="Direct link to heading">#</a></h3><p>Dynamic Link モジュールのサンプルコードを示します。  </p><p>Dynamic Link モジュールはShadow オブジェクトの&#x27;script&#x27; に設定され、dlopen() によってPD Agent for AWS IoT に取り込まれます。<br>
Dynamic Link モジュールには、dl init(), dl main(), dl fini() の三つの関数を定義することができます。 dl init() は起動時に、dl main() はメッセージが出力される都度(UNIX ドメインソケットへ出力
する直前)、dl fini() は停止時に、呼び出されます。<br>
dl main() の引数には、Thing name と Shadow name が &#x27;const char <em>&#x27; で、&#x27;desired&#x27;, &#x27;reported&#x27;, &#x27;delta&#x27; の各オブジェクトが jansson C library の &#x27;json t </em>&#x27; で与えられます。
&#x27;void <em>context&#x27; は、dl init() で定義され dl main(), dl fini() に継承することのできるコンテキストです。<br>戻り値には　&#x27;update&#x27; メッセージでDevice Shadow に送る　&#x27;reported&#x27; オブジェクトを　&#x27;json t </em>&#x27; で与えます。
戻り値が NULL の場合はエラーとして扱われるため、Shadow オブジェクトの&#x27;behalf&#x27; をtrue に設定している場合でも空のオブジェクトなどのダミーを返す必要があります。
本サンプルコードは、/usr/share/pdhms/agent＿awsiot/dl_module_skelton.c としてインストールされています。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="dl_module_skeltonc"></a>dl_module_skelton.c<a aria-hidden="true" class="hash-link" href="#dl_module_skeltonc" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-c:dl_module_skelton.c codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *  Copyright (c) 2021</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *       Plat&#x27;Home CO., LTD. &lt;support@plathome.co.jp&gt;. All rights reserved.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Redistribution and use in source and binary forms, with or without</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * modification, are permitted provided that the following conditions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * are met:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *    notice, this list of conditions and the following disclaimer in the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *    documentation and/or other materials provided with the distribution.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * 3. Neither the name of the Plat&#x27;Home CO., LTD. nor the names of</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *    its contributors may be used to endorse or promote products derived</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *    from this software without specific prior written permission.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#x27;&#x27; AND ANY EXPRESS OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * SUCH DAMAGE.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;stdio.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;time.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;jansson.h&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Your own initialize function : int dl_init()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      It is called only once at startup.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      void **context : pointer for context.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Return value : 0 for normal. -1 for error.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int dl_init(void **context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return(0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Your own finalize function : int dl_fini()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      It is called only once at termination.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      void *context : pointer for context.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Return value : none.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void dl_fini(void *context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Your own exec function : dl_main()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        void *context : pointer for context.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        const char *thingName : Thing name for Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        const char *shadowName : Shadow name for Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        json_t *desired  : desired JSON object for the current Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        json_t *reported : reported JSON object for the Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        json_t *delta    : delta JSON object for the Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Return value : JSON object (json_t *) to be report by update. NULL for error.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">json_t *dl_main(void *context, const char *thingName, const char *shadowName, json_t *desired, json_t *reported, json_t *delta)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    FILE *fp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_t *obj;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    time_t current;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!(fp = fopen(&quot;/tmp/my_func1.txt&quot;, &quot;a&quot;))) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return((json_t *)NULL);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fprintf(fp, &quot;%s/%s\n&quot;, thingName, shadowName);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    obj = json_object();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    time(&amp;current);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_object_set(obj, &quot;desired&quot;, desired);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_object_set(obj, &quot;reported&quot;, reported);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_object_set(obj, &quot;delte&quot;, delta);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_object_set(obj, &quot;timestamp&quot;, json_integer(current));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fprintf(fp, &quot;%s\n\n&quot;, json_dumps(obj, JSON_INDENT(4)));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fclose(fp);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_decref(obj);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    json_object_update(reported, delta);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return(reported);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><span id="lua"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="lua-言語スクリプト"></a>Lua 言語スクリプト<a aria-hidden="true" class="hash-link" href="#lua-言語スクリプト" title="Direct link to heading">#</a></h3><p>Lua 言語スクリプトのサンプルコードを示します。</p><p>Lua 言語スクリプトはShadow オブジェクトの&#x27;script&#x27; に設定され、luaL dofile() によってPD　Agent for AWS IoT に取り込まれます。<br>
my_lua_func1() もしくはmy_lua_func2() が、Shadow オブジェクトの &#x27;function&#x27; に設定され、lua_getglobal() とlua_pcall() によって実行される関数です。<br>
関数名は Shadow オブジェクトの&#x27;function&#x27; で設定できるため、任意の文字列を与えることができ、また1 つのモジュールに Shadow name 毎に複数の関数を記載することも可能です。<br>
my_func1() もしくは my_func2() の引数には、Thing name, Shadow name と &#x27;desired&#x27;, &#x27;reported&#x27;, &#x27;delta&#x27; の各オブジェクトが文字列で与えられます。<br>
戻り値には &#x27;update&#x27; メッセージで Device Shadow に送る &#x27;reported&#x27; オブジェクトを文字列で与えます。(本サンプルコードでは、&#x27;desired&#x27; オブジェクトをそのまま返しています。)<br>
戻り値が nil もしくは無い場合はエラーとして扱われるため、Shadow オブジェクトの &#x27;behalf&#x27; を　true に設定している場合でも空の文字列などのダミーを返す必要があります。<br>
本サンプルコードは、/usr/share/pdhms/agent_awsiot/example.lua としてインストールされています。  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="examplelua"></a>example.lua<a aria-hidden="true" class="hash-link" href="#examplelua" title="Direct link to heading">#</a></h5><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-lua:example.lua codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--  Copyright (c) 2021</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--       Plat&#x27;Home CO., LTD. &lt;support@plathome.co.jp&gt;. All rights reserved.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- Redistribution and use in source and binary forms, with or without</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- modification, are permitted provided that the following conditions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- are met:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- 1. Redistributions of source code must retain the above copyright</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--    notice, this list of conditions and the following disclaimer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--    notice, this list of conditions and the following disclaimer in the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--    documentation and/or other materials provided with the distribution.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- 3. Neither the name of the Plat&#x27;Home CO., LTD. nor the names of</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--    its contributors may be used to endorse or promote products derived</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--    from this software without specific prior written permission.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#x27;&#x27; AND ANY EXPRESS OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- SUCH DAMAGE.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- Argument for lua function</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--      string thingName  : Thing name for Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--      string shadowName : Shadow name for Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--  string desired    : desired JSON string for the current  Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--  string reported   : reported JSON string for the current  Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--  string delt   : delta JSON string for the current  Device Shadow.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- Return value of lua function</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--  Stack 1 : JSON string to be report by update.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function my_lua_func1(thingName, shadowName,desired, reported, delta)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp = io.open(&quot;/tmp/my_lua_func1.txt&quot;, &quot;w&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;thingName : %s\n&quot;, thingName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;shadowName : %s\n&quot;, shadowName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;desired : %s\n&quot;, desired)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;reported : %s\n&quot;, reported)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;delta : %s\n\n&quot;, delta)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:close()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return desired</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function my_lua_func2(thingName, shadowName,desired, reported, delta)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp = io.open(&quot;/tmp/my_lua_func2.txt&quot;, &quot;w&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;thingName : %s\n&quot;, thingName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;shadowName : %s\n&quot;, shadowName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;desired : %s\n&quot;, desired)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;reported : %s\n&quot;, reported)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    s = string.format(&quot;delta : %s\n\n&quot;, delta)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:write(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fp:close()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return desired</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><span id="initialize"></span><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="初期化について"></a>初期化について<a aria-hidden="true" class="hash-link" href="#初期化について" title="Direct link to heading">#</a></h3><p>PD Agent for AWS IoT は、起動時にDevice Shadow に対し&#x27;get&#x27; トピックを送り、&#x27;state&#x27; オブジェクト(&#x27;desired&#x27;, &#x27;reported&#x27;, &#x27;delta&#x27;) を得て、これを引数として、Shadow Name 毎に予め設定された実行オブジェクトもしくは Dynamic Link モジュール又は Lua 言語スクリプトを実行する事でデバイスの初期化を図ります。<br>
Device Shadow に &#x27;state&#x27; オブジェクトが存在しない場合、即ちDevice Shadow が &#x27;get/rejected&#x27;を返した場合の引数は、全て空(文字列としては&#x27;&#x27;) となります。
従って、デバイスには次の処理が想定されます。</p><ul><li>引数が全て空の場合<br>デバイスの現在の状態を戻り値として返します。</li><li>引数に&#x27;desired&#x27; が在る場合<br>デバイスの状態を&#x27;desired&#x27; に更新し&#x27;desired&#x27; を戻り値として返します。</li><li>引数に&#x27;desired&#x27; が無く、&#x27;reported&#x27; が在る場合<br>デバイスの状態を&#x27;reported&#x27; に更新し&#x27;reported&#x27; を戻り値として返します。</li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#デフォルトパス" class="table-of-contents__link">デフォルトパス</a></li><li><a href="#設定ファイルの書式" class="table-of-contents__link">設定ファイルの書式</a><ul><li><a href="#構文" class="table-of-contents__link">構文</a></li><li><a href="#root-オブジェクト" class="table-of-contents__link">Root オブジェクト</a></li><li><a href="#thing-オブジェクト" class="table-of-contents__link">Thing オブジェクト</a></li><li><a href="#shadow-オブジェクト" class="table-of-contents__link">Shadow オブジェクト</a></li><li><a href="#実行オブジェクト" class="table-of-contents__link">実行オブジェクト</a></li><li><a href="#dynamic-link-モジュール" class="table-of-contents__link">Dynamic Link モジュール</a></li><li><a href="#lua-言語スクリプト" class="table-of-contents__link">Lua 言語スクリプト</a></li><li><a href="#初期化について" class="table-of-contents__link">初期化について</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">製品情報</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks-iot/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks IoT</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks - MicroServer</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/easyblocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">EasyBlocksシリーズ</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/airmanage2/" target="_blank" rel="noopener noreferrer" class="footer__link-item">AirManage2</a></li><li class="footer__item"><a href="https://www.plathome.co.jp/product/openblocks-idm/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenBlocks IDMシリーズ</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">SNS</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/plathome.co.jp/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://twitter.com/openblocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - OpenBlocks</a></li><li class="footer__item"><a href="https://twitter.com/OBSDEV" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - OpenBlocks開発の人</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">サポート</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.plathome.co.jp/contact/" target="_blank" rel="noopener noreferrer" class="footer__link-item">お問い合わせ</a></li><li class="footer__item"><a href="https://kb.plathome.co.jp/knowledge/" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQ</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 - 2023 Plat'Home Co., Ltd. All rights reserved.</div></div></div></footer></div>
<script src="/styles.7630729b.js"></script>
<script src="/runtime~main.184c6265.js"></script>
<script src="/main.bebca1b1.js"></script>
<script src="/1.fd206da0.js"></script>
<script src="/1a4e3797.dac89970.js"></script>
<script src="/1be78505.a916c989.js"></script>
<script src="/c4f5d8e4.99b25c1c.js"></script>
<script src="/367.b4e7bc0d.js"></script>
<script src="/366.bfc2d4a0.js"></script>
<script src="/935f2afb.c5e3a9d9.js"></script>
<script src="/365.c7c3a2cd.js"></script>
<script src="/b6a09d5b.b550137e.js"></script>
</body>
</html>