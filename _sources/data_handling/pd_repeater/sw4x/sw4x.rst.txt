.. _pd_handler_sw4x:

SW4xデバイス設定
================================

| PD Handler SW4xは、セイコーインスツル社製無線センサーネットワーク「ミスター省エネ」のベースノードとして機能し、
  無線センサーネットワークに接続される各種センサーノードからデータを取得し、PD Repeater を介してクラウドに送ります。
| また、PD Repeaterを介してクラウドから送られる制御メッセージ(JSON文字列)に基づきModbus RTUノードに
  接続されたPLC機器の制御を行うこともできます。
| WEB UIの「IoTデータ」→「送受信設定」タブの「SW4xデバイス設定」メニューより、
  SW4xデバイスの設定を行うことが出来ます。
| 「SW4xデバイス設定」メニューが表示されていない場合は、:ref:`data_handler_application` を参照し、
  PD Handler SW4xを「使用する」に設定して下さい。
| Modbus RTUノードを介したPLC機器からのデータ取得は、PD　Handler　Modbus2と同様にModbusモデリングファイルに基づき行われます。
| ModbusモデリングファイルにPLC機器のモデリング定義を追加したい場合は、
  :ref:`data_handler_reference` の :ref:`data_handler_reference_sw4x` を参照して下さい。

.. figure:: sw4x_init.png
  :scale: 100%

初期状態では上図のようになっています。

「送信する」を選択すると各設定項目が下図のように表示されます。

.. figure:: sw4x.png
  :scale: 100%

.. list-table:: SW4xデバイスの設定項目
    :widths: 30 70
    :header-rows: 1

    * - 設定項目
      - 説明
    * - デバイス番号
      - OpenBlocksシリーズのWEB UI内で管理している番号です。変更はできません。
    * - データ間引間隔
      - データを間引くための入力データを受け取らない時間をmsec単位で設定します。　
        0の場合、間引きは行われません。
    * - バッファーサイズ
      - データの最大サイズを設定します。単位はバイトです。
    * - 受信設定
      - PD Repeaterを介してクラウドからの制御メッセージを受けるか否かを選択します。
    * - 生データモード
      - 取得したデータを変換せずにPD Repeaterへ送ります。
    * - デバイスファイル
      - ベースノード（SB4020アドオンモジュール、SW4500 RS232ベース又はSW4000USBベース）を接続する
        シリアルポートのデバイスファイル名を設定します。 \*1
    * - 無線グループID
      - 無線センサーネットワークのグループIDを設定します。
        SB4020アドオンモジュール使用時のみ有効となります。
    * - 無線電力/チャンネル
      - 無線センサーネットワークの無線電力とチャンネルを選択します。
        SB4020アドオンモジュール使用時のみ有効となります。
    * - RTT
      - 通常は500(msec)に設定します。Modbus RTUノード使用時にタイムアウトが頻発する場合は、値を大きくします。
    * - 固定情報付与(JSON)
      - データに付加する静的情報をJSON文字列で設定します。
    * - 送信先設定
      - "使用する"を選択した送信先に対してチェックボックスが選択できるようになります。 
        チェックを付けた送信先に対して、送信を行います。　
        チェックをつけると送信先固有の設定項目が表示されます。　
        送信先固有の設定については、:ref:`pd_repeater_device` を参照して下さい。

.. note::
  1. ベースノードを接続するシリアルポートの通信パラメータは、次の値に固定されています。
     SW4500 RS232ベース又はSW4000USBベースを用いる場合は、
     セイコーインスツル社が提供する設定用アプリケーションで設定して下さい。

     ボー・レート:
        115200 bps
     パリティビット:
        none
     データビット:
         8bit
     ストップビット:
         1bit
 
.. raw:: html

   <br><br>

.. raw:: latex

   \clearpage

■ Modbus RTUノード

| Modbus RTUノードを介してPLC機器からデータを取得する場合は、
  RTUモデリングファイル(/var/webui/config/pd_handler_sw4x_rtu.conf)を用意する必要があります。
| RTUモデリングファイルの例を示します。

.. code-block:: none

   {
       "polls": [
          {
              "enable":  true,
              "maker": "Toukou Toushiba", "product": "SmaMe Series",
              "model": "S2MS-RNS22", "sku": "0001",
              "rid": "0xFB",
              "unitId": 1,
              "interval": 300, "time_sync": true, "base_time": "00:01"
          },
          {
              "enable":  true,
              "maker": "Toukou Toushiba", "product": "SmaMe Series",
              "model": "S2MS-RNS22", "sku": "0001",
              "rid": "0xFB",
              "unitId": 2,
              "interval": 300, "time_sync": true, "base_time": "00:01"
          }
       ]
   }


RTUモデリングファイルの詳細については、
:ref:`data_handler_reference` の :ref:`data_handler_reference_sw4x` を参照して下さい。

.. raw:: latex

   \clearpage
