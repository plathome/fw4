.. _pd_repeater_iothub:

MS Azure IoT Hub(iothub)
------------------------------

■ 送受信設定メニューにおける設定

.. figure:: iothub.png
  :scale: 100%

.. list-table:: 送受信設定メニューにおける設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - インターバル[sec]
      - 送信完了後～送信開始までの時間間隔を秒単位で設定します。
    * - 有効時間[sec]
      - PD Reperterがデータ送信できない場合において、保持する時間を設定します。　
        0 を指定した場合、データ送信が完了するまで保持し続けます。
    * - サブプロセス再起動間隔[sec]
      - サブプロセスを再起動する間隔を設定します。　
        通常デォルト値（86400秒）から変更する必要はありません。　
        0を指定した場合、再起動は行いません。
    * - ドメイン名
      - 接続先のIoT Hubのドメイン名を設定します。
    * - IoT Hub名
      - 接続先のIoT Hub名を設定します。
    * - QoS
      - IoT Hubへデータを送信する際のMQTTプロトコルのQoSを設定します。
    * - 受信QoS
      - IoT Hubから制御メッセージを受信する際のMQTTプロトコルのQoSを設定します。
    * - X.509ルート証明書
      - X.509認証を用いる場合のルート証明書ファイルのパス名を設定します。
    * - IoT Edgeとの通信
      - IoT Edgeの使用／不使用を選択します。
    * - トピック末尾への/挿入
      - IoT Edgeへデータを送信する際のMQTTトピックの末尾に'/'を挿入するか選択します。
        (IoT Hubとの通信時には影響はありません) \*1
    * - GWホスト
      - IoT Edgeのゲートウェイホスト名を設定します。（IoT Edge使用時のみ）
        尚、別ホストにて稼働しているIoT Edgeデータ送信する場合、
        IPアドレスまたはFQDNを指定してください。
    * - 詳細設定
      - MQTTプロトコルの詳細値を設定します。
    * - キープアライブ間隔[sec]
      - MQTTプロトコルのキープアライブインターバルを設定します。
    * - クリーンセッション
      - MQTTプロトコルのクリーンセッションの使用／不使用を選択します。
    * - Retain機能
      - MQTTプロトコルのRetain機能の使用／不使用を選択します。
    * - WILL機能
      - MQTTプロトコルのLWT(LastWill and Testament)機能の使用／不使用を選択します。
    * - WILL QoS機能
      - MQTTプロトコルがWILLメッセージを送出する際のQoSを設定します。
    * - WILL Retain機能
      - MQTTプロトコルのWILL Retain機能の使用／不使用を選択します。
    * - WELLプロパティ要素
      - MQTTプロトコルのWILLトピックに用いられるAzure IoT Hubのプロパティ・バッグを設定します。
    * - WLLメッセージ
      - MQTTプロトコルのWILLメッセージを設定します。
    * - デバイス一括設定
      - 各デバイス設定メニューにおいて送信対象設定が「送信する」となっている各対象の送信先設定を一括で有効/無効を選択できます。

.. raw:: latex

   \clearpage

■ 各デバイス設定メニューにおける設定

.. figure:: iothub_device.png
  :scale: 100%

.. list-table:: 各デバイス設定メニューにおける設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - デバイスID(iothub)
      - IoT HubのデバイスIDを設定します。
    * - モジュールID(iothub)
      - IoT Edgeを使用する場合のモジュールIDを設定します。
    * - トランスペアレント(iothub)
      - IoT Edgeの透過モードを用いるか否かを選択します。 \*2
    * - デバイスキー(iothub)
      - IoT Hubのデバイスキーを設定します。
    * - X.509認証設定(iothub)
      - X.509認証を使用する場合は”有効”を選択します。
    * - 証明書(iothub)
      - X.509認証のための証明書ファイルのパス名を設定します。
    * - プライベートキー(iothub)
      - X.509認証のためのプライベートキーのパス名を設定します。

.. note::
  1. 2018/09/14現在、トピック末尾に'/'ある場合、IoT Edge経由IoT Hubへのデータ送信に失敗します。
     そのため、トピック末尾'/'に挿入しないでください。
  2. IoT Edgeのトランスペアレント（透過モード）を用いる場合、モジュールIDは無視されまます。
  
  * IoT Edgeを使用しない場合のデバイスIDと使用する場合のデバイスIDは、
    Azure ポータルサイト上での登録方法が異なります。
    前者はIoT Hubのデバイスエクスプローラから、後者はIoT HubのIoT Edgeから登録します。
  * IoT Edgeを使用する場合のゲートウェイホスト名(GWホスト)とモジュールIDは、
    WEB　UIの「サービス」→「Azure IoT Edge」→「Edge環境変数」タブにて表示されるIoT Edge の環境変数に与えられている値を用います。
  * OpenBlocksシリーズ BXシリーズとOpenBlocksシリーズ EXシリーズについては、
    Docker もしくは Mody が動作しないため、IoT Edge のGWホストとしてローカルホストを使うことは出来ません。
  * X.509ルート証明書・証明書・プライベートキーはWEB UIの「システム」→「ファイル管理」タブにてアップロードしてください。

.. raw:: latex

   \clearpage
