.. _pd_repeater_web:

WEBサーバー(web)
-------------------------------------

■ 送受信設定メニューにおける設定

.. figure:: web.png
  :scale: 100%

.. list-table:: 送受信設定メニューにおける設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - インターバル[sec]
      - 送信完了後～送信開始までの時間間隔を秒単位で設定します。
    * - 有効時間[sec]
      - PD Reperterがデータ送信できない場合において、保持する時間を設定します。　
        0 を指定した場合、データ送信が完了するまで保持し続けます。
    * - サブプロセス再起動間隔[sec]
      - サブプロセスを再起動する間隔を設定します。　
        通常デォルト値（86400秒）から変更する必要はありません。　
        0を指定した場合、再起動は行いません。
    * - 接続先URL
      - 接続先の汎用WEBサーバーのURLを設定します。
    * - 最大POSTデータサーズ
      - 1回のPOSTメソッドで送信する最大データサイズを選択します。1~4Mbyteの中で選択します。
    * - コンテンツタイプ
      - WEBサーバーのコンテンツタイプ（WEBフォーム形式 \*1／プレーンテキスト形式 \*2／JSON 形式 \*3）を選択します。 
    * - ユーザー名
      - WEBサーバーのBASIC認証に用いるユーザー名を設定します。
    * - パスワード
      - WEBサーバーのBASIC認証に用いるユーザー名を設定します。
    * - デバイス一括設定
      - 各デバイス設定メニューにおいて送信対象設定が「送信する」となっている各対象の送信先設定を一括で有効/無効を選択できます。

■ 各デバイス設定メニューにおける設定

.. figure:: web_device.png
  :scale: 100%

.. list-table:: 各デバイス設定メニューにおける設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - 
      - 「送受信設定」をチェックする以外の設定項目はありません。

.. note::
  * WEB サーバに対しては、データを POST メソッドにて送信します。
  
  1. 送信形式設定が"WEBフォーム形式"の場合、
     Content-Typeは "application/x-www-form-urlencoded"となります。
     ペイロード（送信データ本体）は、"Records" という x-www-form-urlencoded 変数に複数データをまとめて送信します。
  2. 送信形式設定が"プレーンテキスト形式"の場合、Content-Typeは "text/plain"となります。
     ペイロード（送信データ本体）のURLセーフエンコードは行われず、複数データ(JSON前提)をまとめて送信します。
  3. 送信形式設定が"JSON形式"の場合、Content-Typeは "application/json"となります。
     ペイロード（送信データ本体）のURLセーフエンコードは行われず、
     複数データ(JSON前提)をまとめて送信します。

1. 送信形式設定 : WEBフォーム形式

  * データ書式 ::

      Records＝[{DATA1},{DATA2},{DATA3},…{DATAn}]

  * 送信サンプル ::

      POST / HTTP/1.0
      Content-Length: 422
      Content-Type: application/x-www-form-urlencoded
      
      Records=[
      {
       "deviceId": "b0b448b81105", "memo": "cc2650-1", "objectTemp": 20, "ambientTemp": 24.84375,
       "humidity":4 7.91259765625, "temperature": 25.32928466796875, "pressure": 1016.37,
       "time":"2016-11-24T16:50:23.431+0900"
       },
       {
        "deviceId": "b0b448b81105", "memo": "cc2650-1", "objectTemp": 19.75, "ambientTemp":24.875,
        "humidity": 47.91259765625, "temperature": 25.3594970703125, "pressure":1016.31,
        "time": "2016-11-24T16:50:26.459+0900", "lux": 427.68
       }
      ]

.. raw:: latex

   \clearpage

2. 送信形式設定 : プレーンテキスト形式

  * データ書式 ::

     [{DATA1}, {DATA2}, {DATA3}, … {DATAn}]

  * 送信サンプル ::

      POST / HTTP/1.0
      Content-Type: text/plain
      Content-Length: 209
  
      [
       { 
        "deviceId": "6d4adcb7133f", "appendixInfo": "G8H00010", "rssi": -90,
        "time": "2017-12-04T14:07:18.157+09:00"
       },
       {
        "deviceId": "e135535f61e4", "appendixInfo": "G8H00010", "rssi": -74,
        "time": "2017-12-04T14:07:18.762+09:00"
       }
      ]

3. 送信形式設定 : JSON形式

  * データ書式 ::

     [{DATA1}, {DATA2}, {DATA3}, … {DATAn}]

  * 送信サンプル ::

      POST / HTTP/1.0
      Content-Type: application/json
      Content-Length: 209

      [
       {
        "deviceId": "6d4adcb7133f", "appendixInfo": "G8H00010", "rssi": -90,
        "time": "2017-12-04T14:07:18.157+09:00"
       },
       {
        "deviceId": "e135535f61e4", "appendixInfo": "G8H00010", "rssi": -74,
        "time": "2017-12-04T14:07:18.762+09:00"
       }
      ]

.. raw:: latex

   \clearpage
