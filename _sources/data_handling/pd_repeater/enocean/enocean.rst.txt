.. _pd_handler_enocean:

EnOceanデバイス設定
==============================

| OpenBlocksシリーズにEnOceanモジュール（拡張追加モジュール）を搭載する、
  もしくはEnOcean 受信用USBドングルを装着することで、
  PD Handler UARTを用いてEnOceanデバイスから情報を取得することができます。
| WEB UIの「IoTデータ」→「送受信設定」タブの「EnOceanデバイス設定」メニューより、
  EnOceanデバイスから情報を取得し送信する設定を行うことが出来ます。
| EnOceanデバイスから情報を取得するためには、WEB UIの「サービス」→「基本」→「EnOcean登録」タブより、
  サービス機能の基本設定としてEnOceanデバイスが登録されている必要があります。
| サービス機能の基本設定については、:ref:`webui` の :ref:`webui_service` を参照して下さい。
| 「EnOceanデバイス設定」メニューが表示されていない場合は、:ref:`data_handler_application` を参照し、
  PD Handler UARTを「使用する」に設定し「使用対象」として「EnOcean」を選択して下さい。

.. figure:: enocean_init.png
  :scale: 100%

登録済のEnOceanデバイスが存在している場合、初期状態では上図のようになっています。(デバイスが１個登録されている場合です。)

.. list-table:: EnOceanデバイス設定の初期設定項目
    :widths: 30 70
    :header-rows: 1

    * - 設定項目
      - 説明
    * - デバイスファイル
      - 拡張追加モジュールを使用する場合は「/dev/ttyEX2」、
        USBドングルを使用する場合は対応するデバイスファイルを選択して下さい。 \*1

        * USBドングルの場合、USBデバイスの認識順によってデバイスファイル名が異なります。
    * - データ送信モード
      - PD Repeateへ送信するデータのモードを設定します。
        データ変換モードは対応しているEEPの場合は解析したデータをPD Repeaterへ送信します。
        対応していないEEPの場合は、受信データを16進数文字列へ変換したデータをPD Repeaterへ送信します。
        また、生データモードは対応EEPを問わず、受信データを16進数文字列へ変換したデータをPD Repeaterへ送信します。

| デバイス毎に送信対象項目にて「送信する」を選択すると各設定項目が表示されます。
| 送信対象一括有効、送信対象一括無効ボタンにて全ての登録済のデバイスの送信対象を制御できます。
   
.. raw:: latex

   \clearpage

.. figure:: enocean.png
  :scale: 100%

「送信する」を選択すると各設定項目が上図のように表示されます。

.. list-table:: EnOceanデバイス設定の設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - デバイス番号
      - OpenBlocksシリーズのWEB UI内で管理している番号です。変更はできません。
    * - データ間引間隔
      - データを間引くための入力データを受け取らない時間をmsec単位で設定します。　
        0の場合、間引きは行われません。
    * - バッファーサイズ
      - データの最大サイズを設定します。単位はバイトです。
    * - デバイスID
      - 登録されたEnOceanデバイスのIDを表示します。
    * - EEP（機器情報プロファイル）
      - 登録されたEnOceanデバイスの機器情報プロファイルを表示します。
    * - ユーザーメモ
      - 登録されたデバイスにて設定されたメモ情報を表示します。
    * - 固定情報付与(JSON)
      - データに付加する静的情報をJSON文字列で設定します。
    * - 送信先設定
      - "使用する”を選択した送信先に対してチェックボックスが選択できるようになります。 
        チェックを付けた送信先に対して、送信を行います。　
        チェックをつけると送信先固有の設定項目が表示されます。　
        送信先固有の設定については、:ref:`pd_repeater_device` を参照して下さい。

.. note::
  1. USBドングルの場合、USBデバイスの認識順によってデバイスファイル名が異なります。

  * 既存のデバイス不良等の差し替え時に以前のものと同様に扱う為に設定を同一にすることを推奨します。（不良となったデバイスは送信対象設定を「送信しない」へ変更してください。）
  * 未対応の EnOcean デバイスについては、:ref:`data_handler_custum_lua_extention` 機能で対応することが可能です。

.. raw:: latex

   \clearpage
