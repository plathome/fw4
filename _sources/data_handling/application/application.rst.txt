.. _data_handler_application:

******************************
IoTデータ制御のアプリ設定
******************************

IoTデータ制御パッケージがインストールされているとWEB UIの「サービス」→「基本」タブに「IoTデータ」が表示されます。

.. figure:: service_basic.png
  :scale: 100%

「サービス」→「基本」タブより「IoTデータ」リンクをクリックすると、
ルートタブがIoTデータ制御の設定を行う「ダッシュボード」／「基本」／「IoTデータ」に切り替わります。

.. note::
  * 「サービス」→「基本」タブに表示されるリンクは、
    「メンテナンス」→「機能拡張」タブよりインストールされたパッケージにより異なります。

アプリ起動制御
==============================

WEB UIの「IoTデータ」→「アプリ設定」タブより、
使用するアプリケーションの起動制御とコンフィグ設定モードの設定を行います。

.. figure:: iotdata_basic.png
  :scale: 100%

  「デフォルト使用アプリモード表示」チック時の表示例 

| 「デフォルト使用アプリモード表示」をチェックすると、「デフォルトアプリ起動制御」の設定メニューを表示します。
| 各アプリケーションの起動制御を「使用する」に設定するためには、デフォルト側の設定が「使用する」に設定されている必要があります。

.. figure:: iotdata_basic_config.png
  :scale: 100%

  「コンフィグ設定モード表示」チック時の表示例

| 「コンフィグ設定モード表示」をチェックすると本WEB UIにより設定されるコンフィグを使用するか、
  ユーザー定義のコンフィグを使用するか切り替える「コンフィグ設定」メニューを表示します。
| 「一括有効」「一括無効」は、全ての設定を一括して「使用する」もしくは「使用しない」に設定します。

.. list-table:: アプリ起動制御の設定項目
    :widths: 33 67
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - PD Repeater
      - クラウドに対しデータもしくは制御メッセージを送受するアプリケーションです。
    * - PD Agent
      - PD Reperterを介しクラウドから制御メッセージを受け設定されたシェルスクリプトもしくは実行オブジェクトを実行するアプリケーションです。
    * - PD Broker
      - データもしくは制御メッセージを複数のアプリケーションに分配するアプリケーションです。
    * - PD Handler BLE
      - BTデバイスセンサーもしくはビーコンからデータを受け取るアプリケーションです。
        「使用対象」としてC言語版とJavaスクリプト版のいずれかを選択できます。
        C言語版の方がハイパフォーマンスですがビーコン及び非コネクション型BLEセンサーのみの対応となります。
        C言語版で対応していない非コネクション型BLEセンサーについては、:ref:`data_handler_custum_lua_extention` 機能で対応することが可能です。
    * - PD Handler UART
      - URAT接続のデバイスからデータを受け取るアプリケーションです。
        「使用対象」として次のモジュールを選択することができます。

        * EnOcean
        * Wi-SUN (Bルート)
    * - PD Handler MODBUS2 Client
      - モデリングに基づきMODBUSプロトコルを用いてPLC機器のレジスタを読み書きするアプリケーションです。 \*1
    * - PD Handler MODBUS2 Server
      - モデリングに基づきPLC機器からMODBUSプロトコルによる接続を待ち受けるアプリケーションです。 \*1
    * - PD Handler MODBUS Client
      - MODBUSプロトコルを用いてPLC機器のレジスタを読み書きするアプリケーションです。 \*1
    * - PD Handler MODBUS Server
      - PLC機器からMODBUSプロトコルによる接続を待ち受けるアプリケーションです。 \*1
    * - PD Handler SW4x
      - SII社製ミスター省エネ無線ネットワークに接続し無線センサーのデータを取得する。アプリケーションです。
    * - PD Handler HVSMC
      - 高圧スマート電力量メータ(Bルート)からECHONET LiteとAIFの仕様に基きデータを取得するアプリケーションです。 \*2

.. note::
  1. PD Handler MODBUSの1系と2系のアプリケーションを、同時に使用することはできません。
  2. PD Handler HVSMCのラジオボタンはECHONET Liteの認定を受けた同アプリケーションが使用可能な機種(Open Blocks IoT EX1,VX2)でのみ表示されます。

.. raw:: html

   <br><br>

.. raw:: latex

   \clearpage

■ IP フィルタの開放について

PD Handler HVSMC機能を「使用する」に設定し保存した場合、フィルタ開放確認のウィンドウが表示されます。　ウィンドウ画面にて適用する旨を選択した場合、
自動でフィルタが恒久的に反映されます。

.. figure:: dialog_open_filter.png
  :scale: 70%

| PD Handler MODBUS ServerまたはPD Handler MODBUS2 Server機能を「使用する」に設定し保存した場合、
  上記のフィルタ開放確認のウィンドウに続き、フィルタ開放ポリシー設定[Modbus]のウィンドが表示されます。
| 「ローカルエリアネットワークのみ」もしくは「全て」のいずれかを選択して下さい。

.. figure:: dialog_filter_policy.png
  :scale: 70%

| 一旦、開放されたフィルタは、これらの機能を「使用しない」に設定し保存しても開放されたままとなります。
| 開放されたフィルタを閉じたい場合、もしくはフィルタ開放ポリシーを変更したい場合は、
  WEB UIの「システム」→「フィルター」タブの「フィルター開放設定」メニューから設定することができます。

.. raw:: latex

   \clearpage
   
アプリ自動再起動設定
==============================

| 「アプリ自動再起動設定」は、アプリケーションを定期的に自動再起動する機能です。　
| ユーザーが独自に開発したアプリケーション等で使用メモリー量が徐々に増加してしまう場合等に用います。

.. figure:: auto_restart_daily.png
  :scale: 100%

  「アプリ自動再起動設定」「再起動トリガー」を「毎日」とした場合の表示例

.. figure:: auto_restart_weekly.png
  :scale: 100%

  「アプリ自動再起動設定」「再起動トリガー」を「曜日指定」とした場合の表示例

.. figure:: auto_restart.png
  :scale: 100%

  「アプリ自動再起動設定」「再起動トリガー」を「日にち指定」とした場合の表示例

.. list-table:: アプリ自動再起動設定の設定項目
    :widths: 30 70
    :header-rows: 1
    
    * - 設定項目
      - 説明
    * - アプリ自動再起動設定
      - 「使用する」もしくは「使用しない」に設定します。
    * - 再起動トリガー
      - 「毎日」、「曜日指定」、「日にち指定」のいずれかを選択します。
    * - 曜日指定
      - 再起動させる曜日を指定します。複数日指定することができます。
    * - 日にち指定
      - 再起動させる日にちを指定します。複数日指定することができます。
    * - 再起動実施時間
      - 再起動させる時刻を指定します。
