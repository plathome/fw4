.. _data_handler_custom_deb_package:

********************************************
debパッケージ
********************************************

| :ref:`data_handler_custom_rc_app` に示すアプリケーション登録処理や:ref:`data_handler_custom_rc_script` に示すファイルは、アプリケーションとその起動／停止スクリプトを含めてdebパッケージ（Debian GNU Linuxのソフトウェアパッケージ）としてまとめておくことを推奨します。
| debパッケージの作成方法についてはDebian公式ページをご確認ください。

debパッケージの作成においては次の点に注意して下さい。

* :ref:`data_handler_custom_rc_app` に示すアプリケーション登録ファイル(/etc/default/obsiot-webui-ext-handler)は、
  複数の deb パッケージの postinstall または postrm スクリプトによって編集されるものです。

* ログファイルをsyslog経由で吐きだすアプリケーションの場合には、postinstall にて rsyslog をリスタートしてください。
  ( OpenBlocks シリーズで用いている syslog サービスは rsyslog です。)

* WEB UIで起動制御等が実施されますが、アプリケーションに用いるコンフィグファイルは生成されません。
  そのため、debパッケージにひな形となるコンフィグファイルを入れておくことを推奨します。

* syslog 経由にてログを出力する設定等のコンフィグファイルが必要となります。
  また、出力先については通常の実ストレージ領域ではなくtmpfs領域を推奨します。
  WEB UIにて "/var/webui/pd-logs" に tmpfs 領域を用意していますので、
  こちらに書き込んでください。尚、この領域に拡張子を ".log" として用意したファイルはログ確認タブから閲覧できます。
  | ログを大量に吐き続けた場合、ファイルサイズが大きくなり tmpfs 領域を圧迫します。
  | そのため、ログのローテーション設定を追加してください。tmpfs 溢れの観点からローテーション設定はファイルサイズでのトリガーを推奨とします。
  